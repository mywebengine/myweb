<!doctype html>
<html data-debug="">
	<head>
		<title>todo list - myweb/tpl</title>
		<meta charset="utf-8" />
		<script src="../main.js" type="module" async="async"></script>
		<link href="todo/style.css" rel="stylesheet" />
		<script>
			data = {};//Object data is default proxy, initing then load "tpl"
			function addTodo(todo, form = document.forms.addForm) {
				console.info("This is REST was fake. And then request is fake todo object, becouse request will be replaced.", todo);
				data.todos.push({name: document.forms.addForm.elements.name.value});
				form.reset();
			}
		</script>
	</head>
	<body>
		<h1>todo list - example</h1>
		<!--getChanel-->
		<link _fetch.u="todo/todos.json"
			data-_onok="this.json().then(j => {data.todos = j})"
			data-_onerror="alert(err)" />
		<!--addChanel-->
		<link _fetch.u="todo/submit.json"
			data-method="post"
			data-type="form"
			data-_body="data.addData"
			data-_onok="this.json().then(addTodo)"
			data-_onerror="addTodo()"
			data-_onerror1="alert(this)" />
		<form name="addForm" onsubmit="data.addData = new FormData(this); return false">
			<fieldset>
				<label for="name">New todo</label>
				<input id="name" name="name" required="" />
				<button>Add</button>
			</fieldset>
		</form>
		<div class="todos-filter">
			<div>{{data.todos && data.todos.filter(todo => !todo.ok).length}} item left</div>
			<button onclick="delete data.filter" _attr.style="!data.filter && `font-weight: bold`">All</button>
			<button onclick="data.filter = `active`" _attr.style="data.filter === `active` && `font-weight: bold`">Active</button>
			<button onclick="data.filter = `complited`" _attr.style="data.filter === `complited` && `font-weight: bold`">Complited</button>
			<button onclick="data.todos = data.todos.filter(todo => !todo.ok)">Clear complited</button>
		</div>
		<div _if.arr="data.todos && data.todos.filter(todo => !data.filter || !!todo.ok === (data.filter === `complited`))"
			_if="arr.length" class="todos">
			<label class="todos-item">
				<input type="checkbox" _on.change="!console.log(this.checked) && arr.forEach(todo => {todo.ok = this.checked})" />
				<i>Select all</i>
			</label>
			<div _for.todo.idx2="arr" _var.idx="data.todos.indexOf(todo)" _attr.title="idx + `-`" _attr.class="todo.ok ? `todos-item todos-item-ok` : `todos-item`">
				<input type="checkbox" _attr.checked="todo.ok" _attr.onchange="`data.todos[${idx}].ok = this.checked`" />
				<div contenteditable="true" _on.blur="todo.name = this.textContent" _html.text="todo.name"></div>
				<button _on.click="console.log(idx, data.todos[idx]); data.todos.splice(idx, 1)">Ã—</button>
			</div>
		</div>
	</body>
</html>