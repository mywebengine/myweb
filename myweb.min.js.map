{"version":3,"file":"myweb.min.js","sources":["config/config.js","descr/descr.js","render/type.js","cache/type.js","cmd/type.js","cmd/cmd.js","proxy/proxy.js","render/algo.js","descr/type.js","descr/create.js","err/err.js","loading/loading.js","loading/type.js","dom/type.js","dom/dom.js","oset/oset.js","render/render.js","addons/addons.js","eval2/eval2.js","cache/cache.js","url/url.js","cmd/inc/inc.js","evt/evt.js","loc/loc.js","loc/type.js","str/str.js","typedef/typedef.js","view/view.js","api/api.js","cmd/attr/attr.js","cmd/exec/exec.js","cmd/fetch/fetch.js","cmd/foreach/foreach.js","cmd/html/html.js","cmd/if/if.js","cmd/on/on.js","cmd/scope/scope.js","cmd/filling/filling.js","cmd/watch/watch.js","myweb.js","env/type.js"],"sourcesContent":["﻿/*\r\nimport {addCommand} from \"../cmd/cmd.js\";\r\nimport attrCmd from \"../cmd/attr/attr.js\";\r\nimport execCmd from \"../cmd/exec/exec.js\";\r\nimport fetchCmd from \"../cmd/fetch/fetch.js\";\r\nimport foreachCmd from \"../cmd/foreach/foreach.js\";\r\nimport htmlCmd from \"../cmd/html/html.js\";\r\nimport {ifCmd, switchCmd} from \"../cmd/if/if.js\";\r\nimport incCmd from \"../cmd/inc/inc.js\";\r\nimport onCmd from \"../cmd/on/on.js\";\r\nimport scopeCmd from \"../cmd/scope/scope.js\";\r\nimport fillingCmd from \"./cmd/filling/filling.js\";\r\nimport watchCmd from \"./cmd/watch/watch.js\";*/\r\n/*\r\n//!!instance\r\nexport const mw_doc = document;\r\nexport const mw_$src = mw_doc.documentElement;\r\n\r\nexport const mw_cmd = new Map();//self.mw_cmd || {};\r\nexport const reqCmd = my.reqCmd || new Map();*/\r\n\r\nexport const p_target = Symbol();\r\nexport const p_topUrl = Symbol();\r\n\r\nexport const visibleScreenSize = 3;\r\nexport const renderPackSize = 100;\r\nexport const defIdleCallbackOpt = {\r\n\ttimeout: 1000\r\n};\r\n\r\nexport const globVarName = \"glob\";\r\nexport const locVarName = \"loc\";\r\nexport const viewVarName = \"view\";\r\n\r\n//export const renderStartEventName = \"renderstart\";\r\nexport const mountEventName = \"mount\";\r\nexport const renderEventName = \"render\";\r\nexport const removeEventName = \"remove\";\r\n\r\nexport const loadEventName = \"load\";\r\nexport const okEventName = \"ok\";\r\nexport const errorEventName = \"error\";\r\n\texport const defEventInit = {\r\n\t\tbubbles: true,\r\n\t\tcancelable: true,\r\n\t\tcomposed: false\r\n\t};\r\n\r\nexport const lazyRenderName = \"lazyrender\";\r\n\r\nexport const cmdPref = \"\";\r\nexport const cmdArgsDiv = \".\";\r\nexport const cmdArgsDivLen = cmdArgsDiv.length;\r\nexport const descrIdName = \"_did\" + cmdArgsDiv;\r\nexport const hideName = \"_hide\";\r\nexport const asOneIdxName = \"_aidx\" + cmdArgsDiv;\r\nexport const idxName = \"_idx\" + cmdArgsDiv;\r\nexport const isFillingName = \"is_filling\";\r\nexport const isFillingDiv = \"-\";\r\n\r\nexport const attrCmdName = cmdPref + \"attr\";\r\n\texport const pushModName = \"push\";//.toLowerCase();\r\n\texport const replaceModName = \"replace\";//.toLowerCase();\r\n\r\nexport const execCmdName = cmdPref + \"exec\";\r\nexport const fillingCmdName = cmdPref + \"filling\";\r\n\r\nexport const foreachCmdName = cmdPref + \"foreach\";\r\nexport const fetchCmdName = cmdPref + \"fetch\";\r\n\texport const defRequestInit = {\r\n\t\theaders: {\r\n\t\t\t\"x-requested-with\": \"XMLHttpRequest\"\r\n\t\t}\r\n\t};\r\n\texport const resultDetailName = \"res\";\r\n\texport const errorDetailName = \"err\";\r\n\r\nexport const htmlCmdName = cmdPref + \"html\";\r\n\texport const textCmdName = htmlCmdName + cmdArgsDiv + \"t\";\r\n\r\nexport const ifCmdName = cmdPref + \"if\";\r\nexport const elseifCmdName = cmdPref + \"elseif\";\r\nexport const elseCmdName = cmdPref + \"else\";\r\n\texport const switchCmdName = cmdPref + \"switch\";\r\n\texport const caseCmdName = cmdPref + \"case\";\r\n\texport const defaultCmdName = cmdPref + \"default\";\r\n\r\nexport const incCmdName = cmdPref + \"inc\";\r\n\r\nexport const onCmdName = cmdPref + \"on\";\r\n\texport const preventDefaultModName = \"prevent\";//.toLowerCase();\r\n\texport const stopModName = \"stop\";//.toLowerCase();\r\n\texport const selfModName = \"self\";//.toLowerCase();\r\n\texport const exactModName = \"exact\";//.toLowerCase();\r\n\texport const eventScopeName = \"evt\";\r\n\r\nexport const scopeCmdName = cmdPref + \"scope\";\r\nexport const watchCmdName = cmdPref + \"watch\";\r\n\r\n//if (FormData.prototype[p_target] !== null) {\r\n\tFormData.prototype[p_target] = null;\r\n\tDocument.prototype[p_target] = null;\r\n\tDocumentFragment.prototype[p_target] = null;\r\n\tHTMLElement.prototype[p_target] = null;\r\n\tText.prototype[p_target] = null;\r\n\tPromise.prototype[p_target] = null;\r\n\tDate.prototype[p_target] = null;\r\n\tRequest.prototype[p_target] = null;\r\n\tResponse.prototype[p_target] = null;\r\n//}\r\n","/*\r\n//!!instance\r\nexport const $srcById = new Map();\r\nexport const srcById = new Map();\r\nexport const srcBy$src = new WeakMap();\r\nexport const descrById = my.descrById || new Map();\r\nexport let idCurVal = my.idCurVal || 0;\r\n\r\nself.m$srcById = $srcById;\r\nself.mSrcById = srcById;\r\nself.mSrcBy$src = srcBy$src;\r\n//self.mDescrById = descrById;*/\r\n\r\nexport function getNewId() {\r\n\treturn ++my.env.idCurVal;\r\n}\r\nexport function getSrcId(local, sId) {\r\n\tif (my.env.srcById.has(sId)) {\r\n\t\treturn sId;\r\n\t}\r\n\tfor (let l = local.get(sId); l !== undefined && l.newSrcId !== 0; l = local.get(sId)) {\r\n\t\tsId = l.newSrcId;\r\n\t}\r\n\treturn sId;\r\n}\r\nexport function get$els($e, get$elsByStr, str) {\r\n\tconst attrIt = my.env.srcBy$src.get($e).descr.attr.keys();\r\n\tlet i = attrIt.next();\r\n\tif (str !== \"\") {\r\n\t\tfor (; !i.done; i = attrIt.next()) {\r\n\t\t\tif (i.value === str) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\twhile (!i.done) {\r\n\t\tconst n = i.value,\r\n\t\t\tget$e = get$elsByStr.get(n);\r\n\t\tif (get$e !== undefined) {\r\n\t\t\treturn my.env.reqCmd.get(n).cmd.get$els($e, n, get$e.expr, get$e.pos);\r\n\t\t}\r\n\t\ti = attrIt.next();\r\n\t}\r\n\treturn [$e];\r\n}\r\nexport function get$first($e, get$elsByStr, str) {\r\n\tconst attrIt = my.env.srcBy$src.get($e).descr.attr.keys();\r\n\tlet i = attrIt.next();\r\n\tif (str !== \"\") {\r\n\t\tfor (; !i.done; i = attrIt.next()) {\r\n\t\t\tif (i.value === str) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\twhile (!i.done) {\r\n\t\tconst n = i.value,\r\n\t\t\tget$e = get$elsByStr.get(str);\r\n\t\tif (get$e !== undefined) {\r\n\t\t\treturn my.env.reqCmd.get(str).cmd.get$first($e, str, get$e.expr, get$e.pos);\r\n\t\t}\r\n\t\ti = attrIt.next();\r\n\t}\r\n\treturn $e;\r\n}\r\nexport function getNextStr(src, str) {\r\n//todo есть много вызовов в корых уже вчеслен src\r\n\tconst attrIt = src.descr.attr.keys();\r\n\tfor (let i = attrIt.next(); !i.done; i = attrIt.next()) {\r\n\t\tif (i.value !== str) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\ti = attrIt.next();\r\n\t\tif (i.done) {\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\t\treturn i.value;\r\n\t}\r\n\treturn \"\";\r\n}\r\nexport function getAttrAfter(attr, name) {\r\n\tconst a = new Map(),\r\n\t\tattrIt = getAttrItAfter(attr.entries(), name, true);\r\n\tfor (let i = attrIt.next(); !i.done; i = attrIt.next()) {\r\n\t\ta.set(i.value[0], i.value[1]);\r\n\t}\r\n\treturn a;\r\n}\r\nexport function getAttrItAfter(attrIt, name, isValues) {\r\n\tif (name === \"\") {\r\n\t\treturn attrIt;\r\n\t}\r\n\tif (isValues) {\r\n\t\tfor (let i = attrIt.next(); !i.done; i = attrIt.next()) {\r\n\t\t\tif (i.value[0] === name) {\r\n\t\t\t\treturn attrIt;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn attrIt;\r\n\t}\r\n\tfor (let i = attrIt.next(); !i.done; i = attrIt.next()) {\r\n\t\tif (i.value === name) {\r\n\t\t\treturn attrIt;\r\n\t\t}\r\n\t}\r\n\treturn attrIt;\r\n}\r\n","export function type_req($src, str, expr, scope, sync) {\n\treturn {\n\t\treqCmd: my.env.reqCmd.get(str),// || null,//<- in createAttr\n\t\t$src,\n\t\tstr,\n\t\texpr,\n\t\tscope,\n\t\tsync\n\t};\n}\nexport function type_q_renderCtx() {\n\treturn {\n\t\tlastCount: 0,\n\t\tafterByDescrByAttr: new Map(),\n\t\tstrByAttrKey: new Map()\n\t};\n}\nexport function type_isLast() {\n\treturn new Set();\n}\nexport function type_q_arr($src, scope) {\n\treturn {\n\t\t$src,\n\t\tscope\n\t};\n}\nexport function type_localCounter() {\n\treturn {\n\t\tanimationsCount: 0,\n\t\tnewSrcId: 0\n\t};\n}\nexport function type_animation(handler, local, viewedSrcId) {\n\tfor (const p of local.values()) {\n\t\tp.animationsCount++;\n\t}\n\treturn {\n\t\thandler: () => {\n\t\t\tfor (const p of local.values()) {\n\t\t\t\tif (p.animationsCount > 0) {\n\t\t\t\t\tp.animationsCount--;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn handler();\n\t\t},\n\t\tlocal,\n\t\tviewedSrcId\n\t};\n}\nexport function type_renderRes(isLast, $src = null, $last = null, $attr = null, attrStr = \"\") {\n\treturn {\n\t\tisLast,\n\t\t$src,\n\t\t$last,\n\t\t$attr,\n\t\tattrStr\n\t};\n}\n\nexport function type_delayParam(sId, resolve, reject) {\n\treturn {\n\t\tsId,\n\t\tresolve,\n\t\treject\n\t};\n}\nexport function type_renderParam(sId, scope, str, isLinking) {\n\treturn {\n\t\tsId,\n\t\tscope,\n\t\tstr,\n\t\tisLinking,\n\t\tisLazyRender: false,\n\t\tsrcIds: new Set(),\n\t\t$els: null\n\t};\n}\nexport function type_prepareMerge(len, firstAsOneIdx) {\n\treturn {\n\t\tlen,\n\t\tdescrId: new Set(),\n\t\tfirstAsOneIdx\n//\t\tasOneIdx: new Set()\n\t};\n}\nexport function type_sync(syncId, renderParam) {\n\tlet resolve;\n\tconst promise = new Promise(res => resolve = res);\n\treturn {\n\t\tsyncId,\n\t\trenderParam,\n\t\tlocal: new Map(),\n\n\t\tbeforeAnimations: new Set(),\n\t\tanimations: new Set(),\n\t\tafterAnimations: new Set(),\n\t\tscrollAnimations: new Set(),\n\t\tonreadies: new Set(),\n\n\t\tidleCallback: new Map(),\n\t\tanimationFrame: new Map(),\n\t\tstat: 0,\n\t\tpromise,\n\t\tresolve\n\t};\n}\n","export function type_cache() {\n\treturn {\n\t\tisInits: type_cacheInit(),\n\t\tcurrent: type_cacheCurrent(),\n\t\tvalue: type_cacheValue(),\n\t\tattrSyncCur: type_cacheAttrSyncCur()\n\t};\n}\nfunction type_cacheInit() {\n\treturn new Set();\n}\nexport function type_cacheCurrent() {\n\treturn new Map();\n}\nexport function type_cacheValue() {\n\treturn new Map();\n}\nfunction type_cacheAttrSyncCur() {\n\treturn new Map();\n}\nexport function type_cacheAttrSyncCurI(syncId, value) {\n\treturn {\n\t\tsyncId,\n\t\tvalue\n\t};\n}\n","export function type_cmd(render, q_render, get$first, get$els, isCustomHtml, isAsOne) {\n\treturn {\n\t\trender,\n\t\tq_render,\n\t\tget$first,\n\t\tget$els,\n\t\tisCustomHtml,\n\t\tisAsOne\n\t};\n}\nexport function type_reqCmd(cmdName, cmd, args) {\n\treturn {\n\t\tcmdName,\n\t\tcmd,\n\t\targs\n\t};\n}\n","import {cmdArgsDivLen, cmdArgsDiv} from \"../config/config.js\";\nimport {type_reqCmd} from \"./type.js\";\n\nexport function addCommand(cmdName, cmd) {\n\tmy.env.cmd.set(cmdName, cmd);\n}\nexport function setReqCmd(str) {\n\tconst already = my.env.reqCmd.get(str);\n//\tif (already) {\n\tif (already !== undefined && already !== null) {\n\t\treturn true;\n\t}\n\tconst i = str.indexOf(cmdArgsDiv),\n\t\tcmdName = i === -1 ? str : str.substr(0, i),\n\t\tcmd = my.env.cmd.get(cmdName);\n\tif (cmd === undefined) {\n\t\tmy.env.reqCmd.set(str, null);\n\t\treturn false;\n\t}\n\tmy.env.reqCmd.set(str, type_reqCmd(cmdName, cmd, i !== -1 ? str.substr(i + cmdArgsDivLen).split(cmdArgsDiv) : []));\n\treturn true;\n}\n","import {renderBySrcIds} from \"../render/algo.js\";\r\nimport {type_cacheValue} from \"../cache/type.js\";\r\nimport {p_target, defIdleCallbackOpt} from \"../config/config.js\";\r\nimport {getNewId, get$els} from \"../descr/descr.js\";\r\n/*\r\n//!!instance\r\nexport const varIdByVar = new Map();\r\nexport const varById = new Map();\r\nexport const varIdByVarIdByProp = new Map();\r\nexport const srcIdsByVarId = new Map();\r\n\r\n//self.mVarIdByVar = varIdByVar;\r\n//self.mVarById = varById;\r\n//self.mVarIdByVarIdByProp = varIdByVarIdByProp;\r\n//self.mSrcIdsByVarId = srcIdsByVarId;*/\r\n\r\n//todo--\r\nself._testVars = function() {\r\n\tconst v = new Set(Array.from(my.env.varIdByVar.values()));\r\n\tfor (const [vId, srcIds] of my.env.srcIdsByVarId) {\r\n\t\tlet fv;\r\n\t\tif (!v.has(vId)) {\r\n\t\t\tlet f;\r\n\t\t\tfor (const vvId of v) {\r\n\t\t\t\tconst vIdByProp = my.env.varIdByVarIdByProp.get(vvId);\r\n\t\t\t\tif (vIdByProp === undefined) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfor (const pId of vIdByProp.values()) {\r\n\t\t\t\t\tif (pId === vId) {\r\n\t\t\t\t\t\tfor (const sId of srcIds) {\r\n\t\t\t\t\t\t\tif (!my.env.$srcById.has(sId)) {\r\n\t\t\t\t\t\t\t\tconsole.log(111222, vId, sId);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tf = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (f) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!f) {\r\n\t\t\t\tconsole.log(0, vId, srcIds);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor (const sId of srcIds) {\r\n\t\t\t\tif (!my.env.$srcById.has(sId)) {\r\n\t\t\t\t\tconsole.log(11111, vId, sId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tfor (const vId of my.env.varIdByVar.keys()) {\r\n\t\tconst s = my.env.srcIdsByVarId.get(vId);\r\n\t\tif (!s) {// || !s.has(sId)) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tfor (const sId of s) {\r\n\t\t\tif (!my.env.$srcById.has(sId)) {\r\n\t\t\t\tconsole.log(1, sId);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst vIdByProp = my.env.varIdByVarIdByProp.get(vId);\r\n\t\tif (vIdByProp !== undefined) {\r\n\t\t\tfor (const pId of vIdByProp.values()) {\r\n\t\t\t\tconst propS = my.env.srcIdsByVarId.get(pId);\r\n\t\t\t\tif (propS) {// && propS.has(sId)) {\r\n//\t\t\t\t\t_del(pId, propS, sId);//, d, dId);\r\n\t\t\t\t\tfor (const sId of propS) {\r\n\t\t\t\t\t\tif (!my.env.$srcById.has(sId)) {\r\n\t\t\t\t\t\t\tconsole.log(2, sId);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nconst isSkipNameType = new Set([/*todo \"undefined\", */\"symbol\"]),\r\n\tisSkipValueType = new Set([\"function\"]),\r\n\tisScalarType = new Set([\"boolean\", \"number\", \"string\", \"undefined\"]);\r\nlet cur$src = null;\r\nexport function setCur$src($src) {\r\n\tcur$src = $src;\r\n}\r\nexport const proxyStat = {\r\n\tvalue: 1\r\n};\r\nexport function getProxy(v) {\r\n\tif (typeof v === \"object\" && v !== null) {\r\n\t\tconst t = v[p_target];\r\n\t\tif (t === null || t !== undefined) {\r\n//\t\tif (t || t === null) {\r\n\t\t\treturn v;\r\n\t\t}\r\n\t} else {\r\n\t\treturn v;\r\n\t}\r\n\tif (Array.isArray(v)) {\r\n\t\tconst len = v.length;\r\n\t\tfor (let i = 0; i < len; i++) {\r\n\t\t\tv[i] = getProxy(v[i]);\r\n\t\t}\r\n\t\tv.push = new Proxy(v.push, changeArrFuncHandler);\r\n\t\tv.unshift = new Proxy(v.unshift, changeArrFuncHandler);\r\n\t\tv.shift = new Proxy(v.shift, changeArrFuncHandler);\r\n\t\tv.pop = new Proxy(v.pop, changeArrFuncHandler);\r\n\t\tv.splice = new Proxy(v.splice, changeArrFuncHandler);\r\n\t\tv.sort = new Proxy(v.sort, changeArrFuncHandler);\r\n\t\tv.reverse = new Proxy(v.reverse, changeArrFuncHandler);\r\n\t\treturn new Proxy(v, proxyHandler);\r\n\t}\r\n\tif (v instanceof Set) {\r\n\t\tconst s = new Set(v);\r\n\t\tv.clear();\r\n\t\tfor (const vv of s) {\r\n\t\t\tv.add(getProxy(vv));\r\n\t\t}\r\n\t\tv.entries = new Proxy(v.entries, getEntriesFuncHandler(true));\r\n\t\tv.values = new Proxy(v.values, getEntriesFuncHandler(false));\r\n\t\tv.keys = new Proxy(v.keys, getEntriesFuncHandler(false));\r\n\t\tv.add = new Proxy(v.add, addFuncHandler);\r\n\t\tv.has = new Proxy(v.has, hasFuncHandler);\r\n\t\tv.delete = new Proxy(v.delete, deleteSetMapFuncHandler(true));\r\n\t\tv.clear = new Proxy(v.clear, clearFuncHandler);\r\n\t\treturn new Proxy(v, proxyHandler);\r\n\t}\r\n\tif (v instanceof Map) {\r\n\t\tconst s = new Map(v);\r\n\t\tv.clear();\r\n\t\tfor (const [kk, vv] of s) {\r\n\t\t\tv.set(getProxy(kk), getProxy(vv));\r\n\t\t}\r\n\t\tv.entries = new Proxy(v.entries, getEntriesFuncHandler(true));\r\n\t\tv.values = new Proxy(v.values, getEntriesFuncHandler(false));\r\n\t\tv.keys = new Proxy(v.keys, getEntriesFuncHandler(false));\r\n\t\tv.get = new Proxy(v.get, getFuncHandler);\r\n\t\tv.set = new Proxy(v.set, setFuncHandler);\r\n\t\tv.delete = new Proxy(v.delete, deleteSetMapFuncHandler(false));\r\n\t\tv.has = new Proxy(v.has, hasFuncHandler);\r\n\t\tv.clear = new Proxy(v.clear, clearFuncHandler);\r\n\t\treturn new Proxy(v, proxyHandler);\r\n\t}\r\n\tfor (const i in v) {\r\n\t\tconst val = v[i];\r\n\t\tif (typeof val !== \"object\" || val === null || val === v) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst d = Object.getOwnPropertyDescriptor(v, i);\r\n\t\tif (d !== undefined && d.writable) {\r\n\t\t\tv[i] = getProxy(val);\r\n\t\t}\r\n\t}\r\n\treturn new Proxy(v, proxyHandler);\r\n}\r\nconst proxyHandler = {\r\n\tget(t, n) {\r\n//if (n == \"then\") {\r\n//console.error(\"get\", t, n, t[n], cur$src, typeof t[n] === \"object\");\r\n//}\r\n\t\tif (proxyStat.value === 0) {\r\n\t\t\tproxyStat.value = 1;\r\n\t\t}\r\n\t\tif (n === p_target) {\r\n\t\t\treturn t;\r\n\t\t}\r\n\t\tconst v = t[n],\r\n\t\t\tvType = typeof v;\r\n//\t\tif (cur$src !== null && !isSkipNameType.has(typeof n) && (Array.isArray(t) || !isSkipValueType.has(vType))) {\r\n\t\tif (cur$src !== null && !isSkipNameType.has(typeof n) && !isSkipValueType.has(vType)) {\r\n\t\t\taddVar(t, n, getTarget(v), cur$src);\r\n\t\t\treturn v;\r\n\t\t}\r\n\t\treturn n !== Symbol.iterator ? v : (t instanceof Map ? t.entries : t.values);\r\n\t},\r\n\tset(t, n, v, r) {\r\n//console.log(\"set\", n, v, \"old=>\", t[n], t, v === p_target);//, Object.getOwnPropertyDescriptor(t, n) && Object.getOwnPropertyDescriptor(t, n).value);\r\n//todo ---\r\n/*\r\n\t\tif (Array.isArray(t) && n === \"length\") {\r\n\t\t\tconst oVal = t[n];\r\n\t\t\tt[n] = v;\r\n//\t\t\tif (v !== oVal && !Reflect.set(t, n, v)) {//todo проверить: push и ... изменяю длину в фоне - это условие не сработает, а вот splice на удаление вроде бы выдает разные значения\r\n//\t\t\t\treturn false;\r\n//\t\t\t}\r\n\t\t\tsetVal(t, n, v, oVal);\r\n\t\t\treturn true;\r\n\t\t}*/\r\n\t\tconst vTarget = getTarget(v);\r\n\t\tif (n in t) {\r\n\t\t\tconst oldVTarget = getTarget(t[n]);\r\n//связоно с тем что обновить элемент стоит даже если значение такое же та как он может быть изменен как то оначе например через this.value = 1111\r\n\t\t\tif (vTarget === oldVTarget) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tt[n] = getProxy(v);\r\n//\t\t\tif (Reflect.set(t, n, getProxy(v))) {\r\n\t\t\t\tsetVal(t, n, vTarget, oldVTarget);\r\n\t\t\t\treturn true;\r\n//\t\t\t}\r\n//\t\t\treturn false;\r\n\t\t}\r\n\t\tt[n] = getProxy(v);\r\n//\t\tif (Reflect.set(t, n, getProxy(v))) {\r\n\t\t\tsetVal(t, n, vTarget, undefined);\r\n\t\t\treturn true;\r\n//\t\t}\r\n//\t\treturn false;\r\n\t},\r\n\tdeleteProperty(t, n, r) {\r\n//console.log(\"del\", t, n, \"old=>\", getTarget(t[n]));\r\n\t\tif (n in t) {\r\n\t\t\tconst oldV = getTarget(t[n]);\r\n\t\t\tdelete t[n];\r\n//\t\t\tif (Reflect.deleteProperty(t, n)) {\r\n\t\t\t\tsetVal(t, n, undefined, oldV);\r\n\t\t\t\treturn true;\r\n//\t\t\t}\r\n//\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n};\r\nconst changeArrFuncHandler = {\r\n\tapply(f, thisValue, args) {\r\n\t\tconst t = thisValue[p_target];\r\n\t\tif (t === undefined) {\r\nconsole.warn(1111111111, f, thisValue, args);\r\n\t\t\treturn f.apply(thisValue, args);\r\n\t\t}\r\n\t\tfor (let i = args.length - 1; i > -1; i--) {\r\n\t\t\targs[i] = getProxy(args[i]);\r\n\t\t}\r\n\t\tconst oldLen = t.length,\r\n\t\t\tres = f.apply(t, args);\r\n\t\tsetVal(t, \"length\", t.length, oldLen);\r\n\t\treturn res;\r\n\t}\r\n};\r\nfunction getEntriesFuncHandler(isEntries) {\r\n\tconst iteratorFuncHandler = getIteratorFuncHandler(isEntries);\r\n\treturn {\r\n\t\tapply(f, thisValue, args) {\r\n//console.log(22222222, thisValue, thisValue[p_target], args);\r\n\t\t\tconst t = thisValue[p_target];\r\n\t\t\tif (t === undefined) {\r\n//console.warn(1111111111, f, thisValue, args);\r\n\t\t\t\treturn f.apply(thisValue, args);\r\n\t\t\t}\r\n\t\t\tconst i = f.apply(t, args);\r\n\t\t\tif (cur$src !== null) {\r\n\t\t\t\ti.next = new Proxy(i.next, iteratorFuncHandler);\r\n\t\t\t\ti[p_target] = thisValue;\r\n\t\t\t}\r\n\t\t\treturn i;\r\n\t\t}\r\n\t};\r\n};\r\nfunction getIteratorFuncHandler(isEntries) {\r\n\treturn {\r\n\t\tapply(f, thisValue, args) {\r\n//console.log(\"next\", thisValue, thisValue[p_target], f, args, cur$src);\r\n\t\t\tconst val = f.apply(thisValue, args);\r\n//-- ?\r\n//\t\t\tif (!cur$src !== null) {\r\n\t\t\tif (!cur$src !== null || val.done) {\r\n\t\t\t\treturn val;\r\n\t\t\t}\r\n//\t\t\tif (val.done) {\r\n//\t\t\t\treturn val;\r\n//\t\t\t}\r\n\t\t\tconst t = thisValue[p_target][p_target];\r\n\t\t\tif (isEntries) {\r\n\t\t\t\tconst [k, v] = val.value;\r\n\t\t\t\taddVar(t, getTarget(k), getTarget(v), cur$src);\r\n\t\t\t\treturn val;\r\n\t\t\t}\r\n\t\t\tconst vTarget = getTarget(val.value);\r\n\t\t\taddVar(t, vTarget, vTarget, cur$src);\r\n\t\t\treturn val;\r\n\t\t}\r\n\t};\r\n};\r\nconst getFuncHandler = {\r\n\tapply(f, thisValue, args) {\r\n//console.log(\"getF\", cur$src, thisValue, thisValue[p_target], args);\r\n\t\tconst t = thisValue[p_target];\r\n\t\tif (t === undefined) {\r\n\t\t\treturn f.apply(thisValue, args);\r\n\t\t}\r\n\t\tconst v = f.apply(t, args);\r\n\t\tif (cur$src !== null) {\r\n\t\t\taddVar(t, getTarget(args[0]), getTarget(v), cur$src);\r\n\t\t}\r\n\t\treturn v;\r\n\t}\r\n};\r\nconst addFuncHandler = {\r\n\tapply(f, thisValue, args) {\r\n\t\tconst t = thisValue[p_target];\r\n\t\tif (t === undefined) {\r\n//todo\r\nconsole.warn(8888, f, thisValue, args);\r\n\t\t\treturn f.apply(thisValue, args);\r\n\t\t}\r\n\t\tconst v = args[0],\r\n\t\t\tvTarget = getTarget(v);\r\n//console.log(\"addF\", t, f, args);\r\n\t\tif (t.has(vTarget)) {\r\n//\t\tif (t.has(v)) {\r\n//\t\t\tconst oldVTarget = getTarget(t.get(v));\r\n//связоно с тем что обновить элемент стоит даже если значение такое же та как он может быть изменен как то оначе например через this.value = 1111\r\n//\t\t\tif (vTarget === oldVTarget) {\r\n\t\t\t\treturn thisValue;\r\n//\t\t\t}\r\n\t\t}\r\n\t\tf.apply(t, [getProxy(v)]);\r\n\t\tsetVal(t, vTarget, vTarget, undefined);\r\n\t\treturn thisValue;\r\n\t}\r\n};\r\nconst setFuncHandler = {\r\n\tapply(f, thisValue, args) {\r\n\t\tconst t = thisValue[p_target];\r\n\t\tif (t === undefined) {\r\n//todo\r\nconsole.warn(8888, f, thisValue, args);\r\n\t\t\treturn f.apply(thisValue, args);\r\n\t\t}\r\n                const [k, v] = args,\r\n\t\t\tvTarget = getTarget(v);\r\n//console.log(\"setF\", t, f, args);\r\n\t\tif (t.has(k)) {\r\n\t\t\tconst oldVTarget = getTarget(t.get(k));\r\n//связоно с тем что обновить элемент стоит даже если значение такое же та как он может быть изменен как то оначе например через this.value = 1111\r\n\t\t\tif (vTarget === oldVTarget) {\r\n\t\t\t\treturn thisValue;\r\n\t\t\t}\r\n\t\t\tf.apply(t, [k, getProxy(v)]);\r\n\t\t\tsetVal(t, getTarget(k), vTarget, oldVTarget);\r\n\t\t\treturn thisValue;\r\n\t\t}\r\n\t\tconst kk = getProxy(k);\r\n\t\tf.apply(t, [kk, getProxy(v)]);\r\n\t\tsetVal(t, getTarget(k), vTarget, undefined);\r\n\t\treturn thisValue;\r\n\t}\r\n};\r\nfunction deleteSetMapFuncHandler(isSet) {\r\n\treturn {\r\n\t\tapply(f, thisValue, args) {\r\n\t\t\tconst t = thisValue[p_target];\r\n\t\t\tif (t === undefined) {\r\n//todo\r\nconsole.warn(8888, f, thisValue, args);\r\n\t\t\t\treturn f.apply(thisValue, args);\r\n\t\t\t}\r\n\t\t\tconst k = args[0];\r\n\t\t\tif (!t.has(k) || !f.apply(t, args)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (isSet) {\r\n\t\t\t\tsetVal(t, getTarget(k), undefined, k);\r\n\t\t\t} else {\r\n\t\t\t\tsetVal(t, getTarget(k), undefined, getTarget(t.get(k)));\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t};\r\n};\r\nconst hasFuncHandler = {\r\n\tapply(f, thisValue, args) {\r\n//console.log(\"hasF\", cur$src, thisValue, thisValue[p_target], args);\r\n\t\treturn f.apply(thisValue[p_target] || thisValue, args);\r\n\t}\r\n};\r\nconst clearFuncHandler = {\r\n\tapply(f, thisValue, args) {\r\n//console.log(\"clearF\", thisValue, thisValue[p_target], args);\r\n\t\tconst t = thisValue[p_target];\r\n\t\tif (t === undefined) {\r\nconsole.warn(8888, f, thisValue, args);\r\n\t\t\treturn f.apply(thisValue, args);\r\n\t\t}\r\n\t\tconst oldSize = t.size;\r\n\t\tf.apply(t, args);\r\n\t\tsetVal(t, \"size\", 0, oldSize);\r\n\t}\r\n};\r\nfunction getTarget(v) {\r\n\treturn typeof v === \"object\" && v !== null ? v[p_target] || v : v;\r\n}\r\n//export \r\nfunction addVar(t, n, v, $src) {\r\n\tconst tId = my.env.varIdByVar.get(t),\r\n\t\tsrc = my.env.srcBy$src.get($src),\r\n\t\tsId = src.id,\r\n\t\tdescr = src.descr;\r\n//\tif (!sId) {\r\n//\t\tconsole.warn(\"2323 всё норм, но нужно последить - сейчас такое бываес с _loading -> _inc\");\r\n//debugger;\r\n//\t\treturn;\r\n//\t}\r\n\tif (isScalarType.has(typeof v) || v === null) {\r\n/*todo может быть нужно так делать\r\n\t\tif (Array.isArray(t) && !isNaN(n)) {\r\nconsole.warn(445435345, n, typeof n, t, n, v, $src);\r\n\t\t\tn = Number(n);\r\n\t\t}*/\r\n\t\tif (tId) {\r\n\t\t\tconst s = my.env.srcIdsByVarId.get(tId);\r\n\t\t\tif (s !== undefined) {\r\n\t\t\t\ts.add(sId);\r\n\t\t\t} else {\r\n\t\t\t\tmy.env.srcIdsByVarId.set(tId, new Set([sId]));\r\n//todo\r\n//console.warn(-1, tId);\r\n\t\t\t}\r\n//1\r\n\t\t\tdescr.varIds.add(tId);\r\n\r\n\t\t\tconst vIdByProp = my.env.varIdByVarIdByProp.get(tId);\r\n\t\t\tif (vIdByProp !== undefined) {\r\n\t\t\t\tconst propId = vIdByProp.get(n);\r\n\t\t\t\tif (propId !== undefined) {\r\n//1\r\n\t\t\t\t\tdescr.varIds.add(propId);//<--100%\r\n\r\n\t\t\t\t\tconst s = my.env.srcIdsByVarId.get(propId);\r\n\t\t\t\t\tif (s !== undefined) {\r\n\t\t\t\t\t\ts.add(sId);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmy.env.srcIdsByVarId.set(propId, new Set([sId]));\r\n//console.log(-2, propId, tId, n, v);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tconst newPropId = getNewId();\r\n//console.log(-33, my.env.varIdByVarIdByProp.get(tId));\r\n//console.log(-3, newPropId, tId, n, v);\r\n//alert(1);\r\n//1\r\n\t\t\t\tvIdByProp.set(n, newPropId);\r\n\t\t\t\tmy.env.srcIdsByVarId.set(newPropId, new Set([sId]));\r\n\t\t\t\tdescr.varIds.add(newPropId);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst newPropId = getNewId();\r\n\t\t\tmy.env.varIdByVarIdByProp.set(tId, new Map([[n, newPropId]]));\r\n\t\t\tmy.env.srcIdsByVarId.set(newPropId, new Set([sId]));\r\n//console.log(-44, new Set(my.env.varIdByVarIdByProp.get(tId)));\r\n//console.log(-4, newPropId, tId, n, v);\r\n//1\r\n\t\t\tdescr.varIds.add(newPropId);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst nId = getNewId();\r\n\t\tmy.env.varIdByVar.set(t, nId);\r\n\t\tmy.env.varById.set(nId, t);\r\n\t\tmy.env.srcIdsByVarId.set(nId, new Set([sId]));\r\n//console.log(-5, nId);\r\n//1\r\n\t\tdescr.varIds.add(nId);\r\n\r\n\t\tconst newPropId = getNewId();\r\n\t\tmy.env.varIdByVarIdByProp.set(nId, new Map([[n, newPropId]]));\r\n\t\tmy.env.srcIdsByVarId.set(newPropId, new Set([sId]));\r\n//console.log(-6, newPropId, nId, t, n, v, $src);\r\n//alert(1)\r\n//1\r\n\t\tdescr.varIds.add(newPropId);\r\n\t\treturn;\r\n\t}\r\n\tif (tId) {\r\n\t\tconst s = my.env.srcIdsByVarId.get(tId);\r\n\t\tif (s !== undefined) {\r\n\t\t\ts.add(sId);\r\n\t\t} else {\r\n\t\t\tmy.env.srcIdsByVarId.set(tId, new Set([sId]));\r\n//console.log(-7, tId);\r\n\t\t}\r\n//1\r\n\t\tdescr.varIds.add(tId);\r\n\t} else {\r\n\t\tconst nId = getNewId();\r\n\t\tmy.env.varIdByVar.set(t, nId);\r\n\t\tmy.env.varById.set(nId, t);\r\n\t\tmy.env.srcIdsByVarId.set(nId, new Set([sId]));\r\n//console.log(-8, sId);\r\n//1\r\n\t\tdescr.varIds.add(nId);\r\n\t}\r\n\tconst vId = my.env.varIdByVar.get(v);\r\n\tif (vId) {\r\n\t\tconst s = my.env.srcIdsByVarId.get(vId);\r\n\t\tif (s !== undefined) {\r\n\t\t\ts.add(sId);\r\n\t\t} else {\r\n\t\t\tmy.env.srcIdsByVarId.set(vId, new Set([sId]));\r\n//console.log(-9, sId);\r\n\t\t}\r\n//1\r\n\t\tdescr.varIds.add(vId);\r\n\t\treturn;\r\n\t}\r\n\tconst newValId = getNewId();\r\n\tmy.env.varIdByVar.set(v, newValId);\r\n\tmy.env.varById.set(newValId, v);\r\n\tmy.env.srcIdsByVarId.set(newValId, new Set([sId]));\r\n//console.log(-10, sId);\r\n//1\r\n\tdescr.varIds.add(newValId);\r\n}\r\nfunction setVal(t, n, v, oldV) {//!! data.arr.unshift(1); data.arr.unshift(2); - если так сделалть, то после первого - будут удалены my.env.varIdByVar.get(oldId), что приведет к тому что все пойдет по ветке !oldId - непонятно нужно ли что-то с этим делать??\r\n\tconst tId = my.env.varIdByVar.get(t);\r\n//console.info(\"setVar\", \"name=>\", n, typeof n, \"\\nvalue=>\", v, \"\\ntarget=>\", t, \"\\ntId=>\", tId, \"\\noldVal=>\", oldV);\r\n\tif (!tId) {//!tId - такое получается когда данные изменяются, а отрисовки ещё небыло - первая загрузка странцы и добавление данных на старте - это корректно\r\n\t\treturn;\r\n\t}\r\n/*todo может быть нужно так делать\r\n\tif (Array.isArray(t) && !isNaN(n)) {\r\n//todo\r\nconsole.warn(423423, n, typeof n, t, n, v, oldV)\r\n\t\tn = Number(n);\r\n\t}*/\r\n\tconst vIdByProp = my.env.varIdByVarIdByProp.get(tId),\r\n//\t\toldScalarId = vIdByProp !== undefined ? vIdByProp.get(n) : 0,\r\n//\t\toId = oldScalarId ? my.env.varIdByVar.get(oldV) : 0;\r\n\t\toldScalarId = vIdByProp !== undefined && vIdByProp.get(n) || 0,\r\n\t\toId = oldScalarId !== 0 && my.env.varIdByVar.get(oldV) || 0;\r\n\tif (my.envdebugLevel === 2) {\r\n\t\tconsole.info(\"my.proxy => setVar\", \"\\n\\tname=>\", n, \"\\n\\tvalue=>\", v, \"\\n\\toldVal=>\", oldV, \"\\n\\ttId=>\", tId, \"\\n\\ttarget=>\", t, \"\\n\\toldId=>\", oId, \"\\n\\toldScalarId=>\", oldScalarId);//, \"\\n\\t$current=>\", cur$src);\r\n\t}\r\n//console.error(\"setVar\", n, v, tId, oId, oldV, oldScalarId, cur$src);\r\n\tif (cur$src !== null) {\r\n//\t\tproxyStat.value = 2;\r\n\t\taddVar(t, n, v, cur$src);\r\n\t}\r\n/*!!нет в этом смысла\r\n\tif (!oId) {//если в разметке нет этого свойства, а оно используется в расчётах - для того чтобы на следующем круге понять что оно уже использовалось и не нужно чистить кэш по условию !oId\r\n\t\tif (isScalarType.has(typeof v) || v === null) {\r\n\t\t\tconst newPropId = getNewId();\r\n\t\t\tif (vIdByProp) {\r\n\t\t\t\tvIdByProp.set(n, newPropId);\r\n\t\t\t} else {\r\n\t\t\t\tmy.env.varIdByVarIdByProp.set(tId, new Map([[n, newPropId]]));\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst newId = getNewId();\r\n\t\t\tmy.env.varIdByVar.set(v, newId);\r\n\t\t\tmy.env.varById.set(newId, v);\r\n\t\t}\r\n\t}*/\r\n/*--\r\n\tif (!oId) {\r\n\t\tconst s = my.env.srcIdsByVarId.get(tId);//для push - нового элемента нет, а обновить надо - это актуально когда нет if .length\r\n\t\tif (s) {\r\n//\t\t\tfor (const sId of s) {//\r\n//console.log(sId, cache[sId]);\r\n//\t\t\t\tdelete cache[sId];\r\n////\t\t\t\tdelete currentCache[sId];\r\n//\t\t\t}\r\n\t\t\trenderBySrcIds(s);\r\n\t\t}\r\n\t\treturn;\r\n\t}*/\r\n\tif (oldScalarId && !isScalarType.has(typeof v) && v !== null) {//это нужно для того: Изначально data.filter в proxy.get (при рендере) установится как скаляр (undef), - если новое значение объект, то нужно удалить ид из свойств\r\n\t\tvIdByProp.delete(n);\r\n//!!todo GC\r\n\t\tif (vIdByProp.size === 0) {\r\n\t\t\tmy.env.varIdByVarIdByProp.delete(tId);\r\n\t\t}\r\n\t}\r\n//\t_setVal(t, n, oldV, my.env.srcIdsByVarId.get(oId || tId), oId);\r\n//}\r\n//function _setVal(t, n, oldV, s, oId) {\r\n\tconst s = my.env.srcIdsByVarId.get(oId || tId);\r\n\tif (s === undefined) {\r\n//!!todo\r\n//console.error(\"!S!\", t, n, oldV, s, oId);\r\n//alert(1);\r\n\t\treturn;\r\n\t}\r\n//console.error(\"_setVal\", t, n, oldV, s, oId);\r\n\tconst toRender = new Set(s),\r\n\t\ttoClear = new Set(),\r\n\t\tsrcBy$src = my.env.srcBy$src;//s);\r\n\tfor (const sId of s) {\r\n\t\tconst $i = my.env.$srcById.get(sId);\r\n\t\tif ($i === undefined || toClear.has(sId)) {//похоже это при удалении элементов\r\n//\t\t\tconsole.warn(2, sId);\r\n\t\t\tcontinue;\r\n\t\t}\r\n//2021-07-20 - data.arr[2] = 1111 - не очитит data.arr, но и не нужно - так как в кэше ссылка на arr\r\n\t\tconst iDescr = srcBy$src.get($i).descr;\r\n\t\tif (iDescr.asOnes === null) {\r\n\t\t\ttoClear.add(sId);\r\n\t\t\tsetInnerSrcIdSetBy$src(toClear, $i);\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst $els = get$els($i, iDescr.get$elsByStr, \"\");\r\n\t\tfor (let j = $els.length - 1; j > -1; j--) {\r\n\t\t\tconst $j = $els[j],\r\n\t\t\t\tjSrc = srcBy$src.get($j);\r\n\t\t\tif (jSrc !== undefined) {\r\n\t\t\t\ttoClear.add(jSrc.id);\r\n\t\t\t\tsetInnerSrcIdSetBy$src(toClear, $j);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n//console.log(1, toClear, n);\r\n/*\r\nfor (const sId of toClear) {\r\n\tconsole.log(2, sId, my.env.$srcById[sId]);\r\n}*/\r\n\tif (oId !== 0) {\r\n\t\tconst deletedVarId = new Set();\r\n\t\tfor (const sId of toClear) {\r\n\t\t\tconst c = my.env.srcById.get(sId).cache;\r\n//\t\t\tif (c === null) {\r\n//\t\t\t\tcontinue;\r\n//\t\t\t}\r\n\t\t\tc.value = type_cacheValue();\r\n//console.log(61, sId)\r\n/*todo\r\n\t\t\tif (!t[p_isUnshift]) {\r\n\t\t\t\tc.current = type_cacheCurrent();\r\nconsole.log(11111111, sId);\r\n\t\t\t}*/\r\n\t\t\tdecVar(t, n, oldV, sId, oId, deletedVarId);\r\n\t\t}\r\n\t\tif (deletedVarId.size !== 0) {\r\n//todo\r\n\t\t\trequestIdleCallback(() => {\r\n\t\t\t\tfor (const d of my.env.descrById.values()) {\r\n\t\t\t\t\tif (d.varIds === null) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (const vId of deletedVarId) {\r\n//\t\t\t\t\t\tif (d.varIds.has(vId)) {\r\n\t\t\t\t\t\t\td.varIds.delete(vId);\r\n//\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, defIdleCallbackOpt);\r\n\t\t}\r\n\t} else {\r\n//console.log(1111, n, oldV, toClear);\r\n\t\tfor (const sId of toClear) {\r\n\t\t\tconst c = my.env.srcById.get(sId).cache;\r\n//\t\t\tif (c === null) {\r\n//\t\t\t\tcontinue;\r\n//\t\t\t}\r\n\t\t\tc.value = type_cacheValue();//<-если это новый элемент массива\r\n//console.log(62, sId)\r\n//todo c.current нужен для храниения текущего значения команды, удаляя его мы нарушаем идею его использования\r\n//\t\t\tc.current = type_cacheCurrent();\r\n//--\t\t\tdecVar(t, n, oldV, sId, oId);\r\n\t\t}\r\n\t}\r\n//console.error(\"renderBySrcIds => \", t, n, t[n], oldV, toRender, cur$src);\r\n\trenderBySrcIds(toRender);\r\n}\r\nfunction setInnerSrcIdSetBy$src(toClear, $i) {\r\n\tconst srcBy$src = my.env.srcBy$src,\r\n\t\t$parent = $i.parentNode;\r\n\tdo {\r\n\t\tconst iSrc = srcBy$src.get($i);\r\n\t\tif (iSrc !== undefined && iSrc.isCmd) {\r\n\t\t\ttoClear.add(iSrc.id);\r\n\t\t}\r\n//////////////////////\r\n\t\tif ($i.firstChild !== null) {\r\n\t\t\t$i = $i.firstChild;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif ($i.parentNode === $parent) {//если мы не ушли вглубь - значит и вправо двигаться нельзя\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif ($i.nextSibling !== null) {\r\n\t\t\t$i = $i.nextSibling;\r\n\t\t\tcontinue;\r\n\t\t}\r\n//\t\twhile ($i = $i.parentNode) {\r\n\t\tdo {\r\n\t\t\t$i = $i.parentNode;\r\n\t\t\tif ($i.parentNode === $parent) {\r\n\t\t\t\t$i = null;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif ($i.nextSibling !== null) {\r\n\t\t\t\t$i = $i.nextSibling;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} while (true);\r\n\t} while ($i !== null);\r\n}\r\nfunction decVar(t, n, v, sId, vId, deletedVarId) {\r\n\tif (vId === 0) {\r\n\t\tif (isScalarType.has(typeof v) || v === null) {\r\n\t\t\tconst vIdByProp = my.env.varIdByVarIdByProp.get(my.env.varIdByVar.get(t));\r\n\t\t\tif (vIdByProp !== undefined) {\r\n\t\t\t\tvId = vIdByProp.get(n);\r\n\t\t\t\tif (vId === undefined) {\r\n\t\t\t\t\tvId = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvId = my.env.varIdByVar.get(v);\r\n\t\t\tif (vId === undefined) {\r\n\t\t\t\tvId = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (vId !== 0) {\r\n\t\tconst s = my.env.srcIdsByVarId.get(vId);\r\n\t\tif (s === undefined || !s.has(sId)) {\r\n\t\t\tdelVar(vId, v, t, n, deletedVarId);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\ts.delete(sId);\r\n\t\tif (s.size === 0) {\r\n\t\t\tdelVar(vId, v, t, n, deletedVarId);\r\n\t\t}\r\n\t}\r\n\tif (Array.isArray(v)) {\r\n\t\tconst len = v.length;\r\n\t\tfor (let i = 0; i < len; i++) {\r\n\t\t\tdecVar(v, i, getTarget(v[i]), sId, 0, deletedVarId);\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n//todo Set and Map\r\n\tif (typeof v !== \"object\" || v === null) {\r\n\t\treturn;\r\n\t}\r\n\tfor (const i in v) {\r\n\t\tdecVar(v, i, getTarget(v[i]), sId, 0, deletedVarId);\r\n\t}\r\n}\r\nfunction delVar(vId, v, t, n, deletedVarId) {\r\n//console.log(\"DEL\", vId);\r\n\tdeletedVarId.add(vId);\r\n\tmy.env.srcIdsByVarId.delete(vId);\r\n\tif (isScalarType.has(typeof v) || v === null) {\r\n\t\tconst vIdByProp = my.env.varIdByVarIdByProp.get(vId = my.env.varIdByVar.get(t));\r\n\t\tif (vIdByProp === undefined) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvIdByProp.delete(n);\r\n\t\tif (vIdByProp.size === 0) {\r\n\t\t\tmy.env.varIdByVarIdByProp.delete(vId);\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\t//пробегать по свойствам объекта и удалять их - не нужно, так как свойства могут быть (объекты и скаляры) использоваться где-нибудь ещё\r\n\tmy.env.varIdByVar.delete(v);\r\n\tmy.env.varById.delete(vId);\r\n//!!\tmy.env.varIdByVarIdByProp.delete(vId);\r\n\tconst vIdByProp = my.env.varIdByVarIdByProp.get(vId);\r\n//!! не надо - там должно быть песто, но если нет - то можно будет заметить\r\n//!! сейчас там то что не используется, - по какойто причине в get прокси запрашивается \"then\" - хотя в шаблоне нет такого запроса\r\n\tif (vIdByProp !== undefined) {\r\n\t\tmy.env.varIdByVarIdByProp.delete(vId);\r\n\t\tfor (const pId of vIdByProp.values()) {\r\n\t\t\tmy.env.srcIdsByVarId.delete(pId);\r\n\t\t}\r\n\t}\r\n}\r\n","import {renderPackSize, lazyRenderName, defIdleCallbackOpt} from \"../config/config.js\";\r\nimport {getSrcId, get$els} from \"../descr/descr.js\";\r\nimport {preRender, is$hide, is$visible, isAnimationVisible} from \"../dom/dom.js\";\r\nimport {loadingCount} from \"../loading/loading.js\";\r\nimport {renderTag, q_renderTag, dispatchLocalEvents} from \"./render.js\";\r\nimport {type_isLast, type_q_arr, type_animation,\r\n\ttype_delayParam, type_renderParam, type_prepareMerge, type_sync} from \"./type.js\";\r\n//!!instance\r\nconst renderParams = new Set();\r\nlet mw_delay = 0,\r\n\tmw_delayId = 0,\r\n\tmw_syncId = 0,\r\n\t__oldLocHash = \"\";\r\nconst delayParams = new Set();\r\nexport const syncInRender = new Set();\r\nlet curRender = Promise.resolve();\r\nexport function getCurRender() {\r\n\treturn curRender;\r\n}\r\nexport function render($src = my.rootElement, delay, scope, isLinking = false) {\r\n\tif (!my.env.srcBy$src.has($src)) {\r\n\t\tpreRender($src, isLinking);\r\n\t}\r\n\tconst sId = my.env.srcBy$src.get($src).id;\r\n\trenderParams.add(type_renderParam(sId, scope || null, \"\", isLinking));\r\n\treturn tryRender(delay, sId);\r\n}\r\nexport function renderBySrcIds(srcs) {\r\n\tfor (const sId of srcs) {\r\n\t\tif (my.env.$srcById.has(sId)) {//!! это тогда, когда мы удалили элемент, но еще не успели очистить его ссылки\r\n\t\t\trenderParams.add(type_renderParam(sId, null, \"\", false));\r\n\t\t}\r\n\t}\r\n\ttryRender(mw_delay, 0);\r\n}\r\nexport function setDelay(t, cb) {\r\n\tif (!cb) {\r\n\t\tmw_delay = t;\r\n\t\treturn;\r\n\t}\r\n\tconst old = mw_delay;\r\n\tmw_delay = t;\r\n\tcb();\r\n\tmw_delay = old;\r\n}\r\nfunction tryRender(delay = mw_delay, sId) {\r\n\tconst delayId = ++mw_delayId;\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tsetTimeout(() => {//по этому отмена не идёт сразу\r\n\t\t\tif (sId !== 0) {\r\n\t\t\t\tdelayParams.add(type_delayParam(sId, resolve, reject));\r\n\t\t\t}\r\n\t\t\tif (delayId !== mw_delayId || renderParams.size === 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst delayP = new Set(delayParams);\r\n\t\t\tdelayParams.clear();\r\n\t\t\t_tryRender(delayP)\r\n\t\t\t\t.then(resolve)\r\n\t\t\t\t.catch(err => {\r\n//todo нужно подумать что еще надо почистить\r\n\t\t\t\t\tfor (const sync of syncInRender) {\r\n\t\t\t\t\t\tsync.resolve();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsyncInRender.clear();\r\n\t\t\t\t\tcurRender = Promise.resolve();\r\n\t\t\t\t\tloadingCount.clear();\r\n//\t\t\t\t\tthrow err;\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t});\r\n\t\t}, delay);\r\n\t});\r\n}\r\nfunction _tryRender(delayP) {\r\n\tconst toCancleSync = new Set(),\r\n\t\tbyD = prepareRenderParam(toCancleSync),\r\n\t\trepeatByD = new Map();\r\n\tif (syncInRender.size !== 0) {\r\n\t\tconst toRemByD = new Set(),\r\n\t\t\ts = new Set();//для того: если были уже отменены синки и мы их пустим на проверку то полдучится, что новые параметры будут удалены из-за условия curStat !== 0\r\n\t\tfor (const sync of syncInRender) {\r\n\t\t\tif (sync.stat === 0) {//могут отмениться в prepareRenderParam\r\n\t\t\t\ts.add(sync);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (const sync of s) {\r\n\t\t\tfor (const [dId, r] of byD) {\r\n\t\t\t\tconst curStat = sync.stat,\r\n\t\t\t\t\tstat = curStat === 0 ? checkSync(sync, r) : curStat;\r\n//console.log(\"1repeat\", stat, curStat, sync.renderParam.sId, r.sId, dId);\r\n\t\t\t\tif (stat === 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (curStat !== 0) {\r\n\t\t\t\t\tif (stat === 3) {\r\n\t\t\t\t\t\ttoRemByD.add(dId);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\ttoCancleSync.add(sync);\r\n\t\t\t\ttoRemByD.add(dId);//чтобы для следующих синков иметь возможнасть отменить их - для случая если этот ниже\r\n\t\t\t\tif (sync.renderParam.isLinking) {\r\n\t\t\t\t\tsync.renderParam.isLinking = false;\r\n\t\t\t\t}\r\n\t\t\t\tif (stat === 2) {//eq\r\n\t\t\t\t\t//повторить + новый\r\n\t\t\t\t\trenderParams.add(sync.renderParam);\r\n\t\t\t\t\tfor (const sId of r.srcIds) {\r\n\t\t\t\t\t\trenderParams.add(type_renderParam(sId, null, \"\", false));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (stat === 3) {//below\r\n\t\t\t\t\trepeatByD.set(my.env.srcById.get(sync.renderParam.sId).descr.id, sync.renderParam);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\t//above\r\n\t\t\t\tif (r.isLinking) {\r\n\t\t\t\t\tr.isLinking = false;\r\n\t\t\t\t}\r\n\t\t\t\trepeatByD.set(dId, r);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (toRemByD.size !== 0) {\r\n\t\t\tfor (const dId of toRemByD) {\r\n\t\t\t\tbyD.delete(dId);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (renderParams.size !== 0) {\r\n\t\t\tfor (const [dId, r] of prepareRenderParam(toCancleSync)) {\r\n\t\t\t\trepeatByD.set(dId, r);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n//console.log(\"_R\", byD, repeatByD, toCancleSync);\r\n//\tif (toCancleSync.size !== 0) {\r\n//\t\tfor (const sync of toCancleSync) {\r\n//\t\t\tsyncInRender.delete(sync);\r\n//\t\t\tsync.resolve();\r\n//\t\t}\r\n//\t}\r\n\tif (byD.size !== 0) {\r\n\t\tconst p = _render(byD, delayP);\r\n\t\tif (repeatByD.size === 0) {\r\n\t\t\tcurRender = curRender\r\n\t\t\t\t.then(() => p);\r\n\t\t} else {\r\n\t\t\tcurRender = curRender\r\n\t\t\t\t.then(() => _render(repeatByD, delayP))\r\n\t\t\t\t.then(() => p);\r\n\t\t}\r\n\t} else if (repeatByD.size !== 0) {\r\n\t\tcurRender = curRender\r\n\t\t\t.then(() => _render(repeatByD, delayP));\r\n//\t} else {\r\n//\t\treturn curRender;\r\n\t}\r\n//\tif (delayP.size === 0) {\r\n\t\treturn curRender;\r\n//\t}\r\n//\treturn curRender\r\n//\t\t.then(() => {\r\n//\t\t\tfor (const resolve of delayP) {\r\n//\t\t\t\tresolve();\r\n//\t\t\t}\r\n//\t\t});\r\n}\r\nfunction _render(byD, delayP) {\r\n\tif (my.debugLevel !== 0) {\r\n\t\tconst sIds = new Set();\r\n\t\tfor (const r of byD.values()) {\r\n\t\t\tif (r.srcIds.size === 0) {\r\n\t\t\t\tsIds.add(r.sId);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfor (const iId of r.srcIds) {\r\n\t\t\t\tsIds.add(iId);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.info(\"render =>\", infoBySrcIds(sIds));\r\n//\t\tconsole.info(\"render =>\", infoBySrcIds(new Set(Array.from(byD.values()).map(i => i.srcIds.size === 0 ? i.sId : Array.from(i.srcIds)).flat())));\r\n\t}\r\n\tconst syncInThisRender = new Set(),\r\n//\t\trenderPack = [],\r\n\t\tpSet = new Set();\r\n\tfor (const [dId, r] of byD) {\r\n\t\tconst sync = type_sync(++mw_syncId, r),\r\n\t\t\t$sync = my.env.$srcById.get(r.sId),\r\n\t\t\tarrLen = r.srcIds.size;\r\n\t\tsyncInRender.add(sync);\r\n\t\tsyncInThisRender.add(sync);\r\n//--\t\tif (r.attr === null) {\r\n//--\t\t\tr.attr = my.env.descrById.get(dId).attr;\r\n//--\t\t}\r\n//todo\r\n//if ($sync === undefined) {\r\n//\tconsole.warn(\"_render !\", r.sId, sync);\r\n//\tcontinue;\r\n//}\r\n\t\tif (arrLen === 1) {\r\n//\t\t\trenderPack.push({$src: $sync, renderParam: r, sync});\r\n\t\t\tpSet.add(renderTag($sync, r.scope, r.str, sync));\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst arr = new Array(arrLen);\r\n\t\tlet i = 0;\r\n\t\tfor (const sId of r.srcIds) {\r\n\t\t\tarr[i++] = type_q_arr(my.env.$srcById.get(sId), r.scope);\r\n\t\t}\r\n//todo не могу сообразить, почему этот (1) вариант быстрее! неужелди выполняется в нескольких потоках?\r\n//console.time(111);\r\n\t\tpSet.add(_q_renderPack(r, sync, arr));\r\n//\t\tpSet.add(q_renderTag(arr, \"\", type_isLast(), sync)\r\n//.then(() => console.timeEnd(111)));\r\n//была проблема с с() из-за потери ид для обновлении при отмене\t\t\t\t.then(() => !console.log(123, my.env.srcIdsByVarId.get(my.env.varIdByVarIdByProp[55].get(\"green\")), arr) && q_renderTag(arr, \"\", type_isLast(), sync)));\r\n\t}\r\n//\tif (renderPack.length !== 0) {\r\n//\t\tpSet.add(_renderPack(renderPack));\r\n//\t}\r\n\treturn Promise.all(pSet)\r\n\t\t.then(() => {\r\n\t\t\tconst pSet = new Set();\r\n\t\t\tfor (const sync of syncInThisRender) {\r\n\t\t\t\tpSet.add(sync.promise);\r\n\t\t\t\tif (my.debugLevel === 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tsync.promise\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tif (sync.stat === 0) {\r\n//todo\r\n\t\t\t\t\t\t\tconsole.warn(\"0 0 sdfsdfsd\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst sIds = sync.renderParam.srcIds.size === 0 ? [sync.renderParam.sId] : sync.renderParam.srcIds;\r\n\t\t\t\t\t\tif (sync.stat === 7) {\r\n\t\t\t\t\t\t\tconsole.info(\"ready =>\", infoBySrcIds(sIds));\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconsole.info(\"cancel =>\", infoBySrcIds(sIds));\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t\trenderLoop(syncInThisRender);\r\n\t\t\treturn Promise.all(pSet);\r\n\t\t})\r\n\t\t.then(() => {\r\n\t\t\tfor (const d of delayP) {\r\n\t\t\t\tfor (const sync of syncInThisRender) {\r\n\t\t\t\t\tlet l = sync.local.get(d.sId);\r\n\t\t\t\t\tif (l !== undefined) {\r\n//\t\t\t\t\t\tfor (; l !== undefined && l.newSrcId !== 0; l = sync.local.get(d.sId)) {\r\n//\t\t\t\t\t\t\td.sId = l.newSrcId;\r\n//\t\t\t\t\t\t}\r\n//\t\t\t\t\t\td.sId = getSrcId(sync.local, d.sId);\r\n\t\t\t\t\t\td.resolve(sync);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//todo\r\n\t\t\tconst h = location.hash;\r\n\t\t\tif (h === __oldLocHash) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst $h = document.getElementById(h.substr(1));\r\n\t\t\tif ($h) {\r\n\t\t\t\t__oldLocHash = h;\r\n\t\t\t\t$h.scrollIntoView();\r\n\t\t\t}\r\n\t\t})\r\n\t\t.catch(err => {\r\n\t\t\tfor (const d of delayP) {\r\n\t\t\t\td.reject(err);\r\n\t\t\t}\r\n\t\t\tthrow err;\r\n\t\t});\r\n}\r\n/*\r\nfunction _renderPack(arr) {\r\n\tconst nows = [],\r\n\t\tdeferreds = [],\r\n\t\tarrLen = arr.length;\r\n\tfor (let i = 0; i < arrLen; i++) {\r\n\t\tconst arrI = arr[i];\r\n\t\tif (is$visible(arrI.$src)) {\r\n\t\t\tnows.push(arrI);\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tdeferreds.push(arrI);\r\n\t}\r\n\tif (nows.length !== 0) {\r\nconsole.log(1, nows)\r\n\t\tconst pSet = new Set(),\r\n\t\t\tl = nows.length;\r\n\t\tfor (let i = 0; i < l; i++) {\r\n\t\t\tconst e = nows[i];\r\n\t\t\tpSet.add(renderTag(e.$src, e.renderParam.scope, e.renderParam.str, e.sync));\r\n\t\t}\r\n\t\treturn Promise.all(pSet)\r\n\t\t\t.then(() => deferreds.length !== 0 && _renderPack(deferreds));\r\n//\t\t\t.then(() => deferreds.length !== 0 && sync.afterAnimations.add(type_animation(() => _q_renderPack(renderParam, sync, deferreds), sync.local, 0)));\r\n\t}\r\nconsole.log(2, deferreds)\r\n\tconst pSet = new Set(),\r\n\t\tl = deferreds.length;\r\n\tfor (let i = 0; i < l; i++) {\r\n\t\tconst e = deferreds[i];\r\n\t\tpSet.add(new Promise(ricResolve => {\r\n\t\t\tconst ricId = requestIdleCallback(() => {\r\nalert(1)\r\n\t\t\t\te.sync.idleCallback.delete(ricId);\r\n\t\t\t\trenderTag(e.$src, e.renderParam.scope, e.renderParam.str, e.sync)\r\n\t\t\t\t\t.then(ricResolve);\r\n\t\t\t});\r\n\t\t\te.sync.idleCallback.set(ricId, ricResolve);\r\n\t\t}, defIdleCallbackOpt));\r\n\t}\r\n\treturn Promise.all(pSet);\r\n}*/\r\nfunction _q_renderPack(renderParam, sync, arr) {\r\n\tconst nows = [],\r\n\t\tdeferreds = [],\r\n\t\tarrLen = arr.length;\r\n\tfor (let i = 0; i < arrLen; i++) {\r\n\t\tconst arrI = arr[i];\r\n\t\tif (is$visible(arrI.$src)) {\r\n\t\t\tnows.push(arrI);\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tdeferreds.push(arrI);\r\n\t}\r\n\tif (nows.length !== 0) {\r\n//console.log(1, nows)\r\n\t\treturn q_renderTag(nows, renderParam.str, type_isLast(), sync)\r\n\t\t\t.then(() => deferreds.length !== 0 && sync.afterAnimations.add(type_animation(() => _q_renderPack(renderParam, sync, deferreds), sync.local, 0)));\r\n\t}\r\n//console.log(2, deferreds)\r\n\treturn new Promise(ricResolve => {\r\n\t\tconst ricId = requestIdleCallback(() => {\r\n\t\t\tsync.idleCallback.delete(ricId);\r\n\t\t\tq_renderTag(deferreds.splice(0, renderPackSize), renderParam.str, type_isLast(), sync)\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tif (deferreds.length !== 0) {\r\n\t\t\t\t\t\treturn _q_renderPack(renderParam, sync, deferreds)\r\n\t\t\t\t\t\t\t.then(ricResolve);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tricResolve();\r\n\t\t\t\t});\r\n\t\t});\r\n\t\tsync.idleCallback.set(ricId, ricResolve);\r\n\t}, defIdleCallbackOpt);\r\n}\r\nexport async function renderLoop(syncInThisRender) {\r\n//console.log(1111111111111111111)\r\n\tconst pSet = new Set();\r\n//before\r\n\tfor (const sync of syncInThisRender) {\r\n\t\tif (sync.stat !== 0 || sync.beforeAnimations.size === 0) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst animation = new Set(sync.beforeAnimations),\r\n\t\t\taArr = new Array(animation.size);\r\n\t\tsync.beforeAnimations.clear();\r\n\t\tlet i = 0;\r\n\t\tfor (const a of animation) {\r\n\t\t\taArr[i++] = a.handler();\r\n\t\t}\r\n\t\tpSet.add(Promise.all(aArr)\r\n\t\t\t.then(() => dispatchLocalEvents(sync.local)));\r\n\t}\r\n\tif (pSet.size !== 0) {\r\n\t\tawait Promise.all(pSet);\r\n\t}\r\n//amination\r\n\tfor (const sync of syncInThisRender) {\r\n\t\tif (sync.stat !== 0 || sync.animations.size === 0) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst animation = new Set(sync.animations);\r\n\t\tsync.animations.clear();\r\n\t\tconst p = addAnimation(sync, animation, false);\r\n\t\tif (p !== null) {\r\n\t\t\tpSet.add(p);\r\n\t\t}\r\n\t}\r\n\tif (pSet.size !== 0) {\r\n\t\tawait Promise.all(pSet);\r\n\t}\r\n//after\r\n\tfor (const sync of syncInThisRender) {\r\n\t\tif (sync.stat !== 0 || sync.afterAnimations.size === 0) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst animation = new Set(sync.afterAnimations),\r\n\t\t\taArr = new Array(animation.size);\r\n\t\tsync.afterAnimations.clear();\r\n\t\tlet i = 0;\r\n\t\tfor (const a of animation) {\r\n\t\t\taArr[i++] = a.handler();\r\n\t\t}\r\n\t\tpSet.add(Promise.all(aArr)\r\n\t\t\t.then(() => dispatchLocalEvents(sync.local)));\r\n\t}\r\n\tif (pSet.size !== 0) {\r\n\t\tawait Promise.all(pSet);\r\n\t}\r\n\tconst repeatSyncs = new Set();\r\n//scroll\r\n\tfor (const sync of syncInThisRender) {\r\n//console.log(sync, sync.stat, sync.beforeAnimations.size, sync.animations.size, sync.afterAnimations.size, sync.scrollAnimations.size, sync.idleCallback.size, sync.animationFrame.size)\r\n\t\tif (sync.stat === 0) {\r\n\t\t\tif (sync.beforeAnimations.size !== 0 || sync.animations.size !== 0 || sync.afterAnimations.size !== 0) {\r\n\t\t\t\trepeatSyncs.add(sync);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (sync.scrollAnimations.size !== 0 || sync.idleCallback.size !== 0 || sync.animationFrame.size !== 0) {//если ктьо-то работает в с этим, то он сам ответственен за запуск рендерЛупа\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (sync.stat !== 0) {\r\n//console.warn(23423423423);\r\n\t\t\tsyncInRender.delete(sync);\r\n\t\t\tsync.resolve();\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\t//todo подумать - наверное есть другой способ - слишком жирно для одного вотч-а\r\n\t\tif (sync.onreadies.size !== 0) {\r\n\t\t\tfor (const h of sync.onreadies) {\r\n\t\t\t\th();\r\n\t\t\t}\r\n\t\t}\r\n\t\tsync.stat = 7;//ready\r\n\t\tsyncInRender.delete(sync);\r\n\t\tsync.resolve();\r\n/*\r\n\t\tfor (const [iId, l] of sync.local) {\r\n\t\t\tif (l.animationsCount !== 0) {\r\n\t\t\t\tconsole.log(222222, iId, l);\r\n\t\t\t}\r\n\t\t}*/\r\n\t}\r\n\tif (repeatSyncs.size !== 0) {\r\n//todo\r\n//console.warn(\"repeatSyncs\", repeatSyncs);\r\n\t\treturn renderLoop(repeatSyncs);\r\n\t}\r\n}\r\nexport function addAnimation(sync, animation, isSet) {\r\n//todo\r\nif (sync.stat !== 0) {\r\nconsole.warn(1111111111);\r\n\treturn null;\r\n}\r\n//\tconst isSet = syncInThisRender === null,\r\n\tconst nows = isSet ? animation : new Set(),\r\n\t\tdeferreds = new Set();\r\n\tif (!isSet) {\r\n\t\tfor (const a of animation) {\r\n//todo\r\nif (a.promise) {\r\n\tconsole.warn(\"a.promise !== null\");\r\n\talert(1)\r\n\tcontinue;\r\n}\r\n\t\t\tif (isAnimationVisible(a)) {\r\n\t\t\t\tnows.add(a);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (!sync.renderParam.isLazyRender) {\r\n\t\t\t\tdeferreds.add(a);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tsync.scrollAnimations.add(a);\r\n//todo\r\na.promise = 1;\r\n\t\t}\r\n\t}\r\n//console.error(nows.size, deferreds.size, sync.scrollAnimations.size, isSet);\r\n//alert(1);\r\n\tif (nows.size !== 0) {\r\n\t\treturn new Promise(rafResolve => {\r\n\t\t\tconst rafId = requestAnimationFrame(() => {\r\n\t\t\t\tsync.animationFrame.delete(rafId);\r\n/*!!!!!\r\n\t\t\t\tif (sync.stat !== 0) {\r\n\t\t\t\t\trafResolve();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}*/\r\n\t\t\t\tfor (const a of nows) {\r\n\t\t\t\t\ta.handler();\r\n\t\t\t\t}\r\n\t\t\t\tdispatchLocalEvents(sync.local);\r\n\t\t\t\tif (deferreds.size === 0) {\r\n\t\t\t\t\trafResolve();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n/*\r\n\t\t\t\trequestIdleCallback(() => {\r\n\t\t\t\t\tif (sync.stat !== 0) {\r\n\t\t\t\t\t\trafResolve();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}*/\r\n\t\t\t\tconst ricId = requestIdleCallback(() => {\r\n\t\t\t\t\tsync.idleCallback.delete(ricId);\r\n\t\t\t\t\taddAnimation(sync, deferreds, false)\r\n\t\t\t\t\t\t.then(rafResolve);\r\n\t\t\t\t}, defIdleCallbackOpt);\r\n\t\t\t\tsync.idleCallback.set(ricId, rafResolve);\r\n\t\t\t});\r\n\t\t\tsync.animationFrame.set(rafId, rafResolve);\r\n\t\t});\r\n\t}\r\n\tif (deferreds.size === 0) {\r\n\t\treturn null;\r\n\t}\r\n\treturn new Promise(ricResolve => {\r\n\t\tconst ricId = requestIdleCallback(() => {\r\n\t\t\tsync.idleCallback.delete(ricId);\r\n\t\t\tconst rafId = requestAnimationFrame(() => {\r\n\t\t\t\tsync.animationFrame.delete(rafId);\r\n/*!!!!!\r\n\t\t\t\tif (sync.stat !== 0) {\r\n\t\t\t\t\tricResolve();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}*/\r\n\t\t\t\tfor (const a of deferreds) {\r\n\t\t\t\t\ta.handler();\r\n\t\t\t\t}\r\n\t\t\t\tdispatchLocalEvents(sync.local);\r\n\t\t\t\tricResolve();\r\n\t\t\t\treturn;\r\n\t\t\t});\r\n\t\t\tsync.animationFrame.set(rafId, ricResolve);\r\n\t\t}, defIdleCallbackOpt);\r\n\t\tsync.idleCallback.set(ricId, ricResolve);\r\n\t});\r\n}\r\nexport function checkScrollAnimations() {\r\n\tconst pSet = new Set(),\r\n\t\tscrollSync = new Set(),\r\n\t\t$srcById = my.env.$srcById;\r\n\tfor (const sync of syncInRender) {\r\n\t\tif (sync.stat !== 0 || sync.scrollAnimations.size === 0) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst animation = new Set();\r\n\t\tfor (const a of sync.scrollAnimations) {\r\n\t\t\tif (!$srcById.has(a.viewedSrcId)) {\r\n\t\t\t\tsync.scrollAnimations.delete(a);\r\n\t\t\t\tif (sync.scrollAnimations.size === 0) {\r\n\t\t\t\t\tscrollSync.add(sync);\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (isAnimationVisible(a)) {\r\n\t\t\t\tsync.scrollAnimations.delete(a);\r\n\t\t\t\tanimation.add(a);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (animation.size !== 0) {\r\n\t\t\tpSet.add(addAnimation(sync, animation, true));\r\n\t\t\tscrollSync.add(sync);\r\n\t\t}\r\n\t}\r\n\tif (pSet.size !== 0) {\r\n//console.log(\"animation\")\r\n\t\tPromise.all(pSet)\r\n\t\t\t.then(() => renderLoop(scrollSync));\r\n\t\treturn;\r\n\t}\r\n//todo--\r\n\tif (scrollSync.size !== 0) {\r\nconsole.warn(\"2animation\")\r\n\t\trenderLoop(scrollSync);\r\n\t}\r\n}\r\nexport function addScrollAnimationsEvent($e) {\r\n\t$e.addEventListener(\"scroll\", checkScrollAnimations, {\r\n\t\tpassive: true\r\n\t});\r\n}\r\nfunction prepareRenderParam(toCancleSync) {\r\n//\tconst renderParamByDescrId = new Map(),\r\n\tconst srcById = my.env.srcById,\r\n\t\tdescrById = my.env.descrById,\r\n\t\tsrcBy$src = my.env.srcBy$src,\r\n\t\t$srcById = my.env.$srcById,\r\n\t\tbyD = new Map();\r\n//console.log(\"prepareRenderParam\", new Set(renderParams));\r\n//console.time(\"p1\")\r\n\tfor (const r of renderParams) {\r\n\t\tconst sId = r.sId,\r\n\t\t\tsrc = srcById.get(sId);\r\n\t\tif (src === undefined) {//удалённые элементы, ссылки на переменные еще могут остаться так как они удаляются в фоне\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst descr = src.descr,\r\n\t\t\tdId = descr.id,\r\n\t\t\trr = byD.get(dId);\r\n\t\tif (rr !== undefined) {\r\n\t\t\tif (descr.asOnes === null) {//!!если в byD уже есть для этого описания, то это должен быть ку алгоритм\r\n\t\t\t\trr.srcIds.add(sId);\r\n\t\t\t}\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tbyD.set(dId, r);\r\n\t\tif (descr.asOnes === null) {\r\n\t\t\tr.srcIds.add(sId);\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\t//<div foreach.1><div foreach.2<-если мы здесь, т.е во всех 1 собраем все 2\r\n\t\tconst $parents = new Set();\r\n\t\tfor (const jId of descr.srcIds) {\r\n\t\t\tconst $p = $srcById.get(jId).parentNode;\r\n\t\t\tif ($parents.has($p)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t$parents.add($p);\r\n\t\t\tr.srcIds.add(jId);\r\n\t\t}\r\n\t}\r\n//console.timeEnd(\"p1\")\r\n//console.time(\"p2\")\r\n\tfor (const [dId, r] of byD) {//вычисляем когда много элементов типа: if-else or inc и оставляем только первый dId\r\n\t\tconst $i = $srcById.get(r.sId);\r\n\t\tif (is$hide($i)) {//если элеменит скрыт template-ом\r\n\t\t\tprpDeleteDescrId(byD, dId, toCancleSync);\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst descr = descrById.get(dId);\r\n\t\tif (descr.asOnes !== null || descr.get$elsByStr === null) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst $els = get$els($i, descr.get$elsByStr, \"\"),\r\n\t\t\t$elsLen = $els.length;\r\n\t\tif ($elsLen === 1) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\t//if-else, inc\r\n\t\tfor (let f = true, i = 0; i < $elsLen; i++) {\r\n\t\t\tconst iSrc = srcBy$src.get($els[i]);\r\n\t\t\tif (iSrc === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tconst iDId = iSrc.descr.id;\r\n\t\t\tif (iDId !== dId) {// && byD.has(iDId)) {\r\n\t\t\t\tprpDeleteDescrId(byD, iDId, toCancleSync);\r\n\t\t\t}\r\n/*\r\n\t\t\tif (f && iSrc.isCmd) {//!!эта оптимизация не имеет особого приемущества\r\n\t\t\t\tf = false;\r\n\t\t\t\tr.sId = iSrc.id;\r\n\t\t\t\tbyD.set(iSrc.descr.id, r);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tprpDeleteDescrId(byD, iSrc.descr.id, toCancleSync);*/\r\n\t\t}\r\n\t\tr.$els = $els;//нужен для getPosStat() при проверке на отмену\r\n\t}\r\n//console.timeEnd(\"p2\")\r\n//console.time(\"p3\")\r\n\tconst mergeByD = new Map(),\r\n\t\t$top = my.rootElement.parentNode;\r\n\tfor (const [dId, r] of byD) {//размечаем глубины и расширяем для get$els\r\n\t\tlet $i = $srcById.get(r.sId),\r\n\t\t\tiSrc = srcBy$src.get($i);\r\n\t\tconst mI = type_prepareMerge(0, iSrc.asOneIdx !== null ? iSrc.asOneIdx.values().next().value : 0);\r\n\t\tmergeByD.set(dId, mI);\r\n\t\tfor (; $i !== $top; $i = $i.parentNode, iSrc = srcBy$src.get($i)) {\r\n/*\r\n\t\t\tif ($i === $top) {\r\n\t\t\t\tfor (const iId of r.srcIds) {\r\n//todo!!!!!!--\r\n\t\t\t\t\tif (iId !== r.sId && is$hide($srcById[iId])) {//из-за чего может получится что элемент в рендере и его нет в доме?\r\n\t\t\t\t\t\tr.srcIds.delete(iId);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n//\t\t\t\trenderParamByDescrId.set(dId, p);\r\n\t\t\t\tbreak;\r\n\t\t\t}*/\r\n/*\r\n\t\t\tconst iDId = $i[p_descrId];\r\n\t\t\tif (!iDId) {//защита от документФрагмента\r\n//todo--\r\nconsole.warn(2222, $i);\r\nalert(222);\r\n\t\t\t}*/\r\n\r\n\t\t\tmI.len++;\r\n\t\t\tif ($i.getAttribute(lazyRenderName) !== null) {\r\n\t\t\t\tr.isLazyRender = true;\r\n\t\t\t\t//todo, наверное, нужно пробудмать удаление слушателя при изменении атрибута\r\n\t\t\t\taddScrollAnimationsEvent($i);\r\n\t\t\t}\r\n                        const iDescr = iSrc.descr;\r\n\t\t\tif (iSrc.asOneIdx !== null || iDescr.get$elsByStr === null) {\r\n\t\t\t\tmI.descrId.add(iDescr.id);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tconst $els = get$els($i, iDescr.get$elsByStr, \"\");//todo <-- $els - для первого $i мы ранее уже вычисляли $els\r\n//\t\t\tif ($els) {\r\n\t\t\t\tfor (let j = $els.length - 1; j > -1; j--) {\r\n\t\t\t\t\tconst iSrc = srcBy$src.get($els[j]);\r\n\t\t\t\t\tif (iSrc !== undefined) {\r\n\t\t\t\t\t\tmI.descrId.add(iSrc.descr.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n//\t\t\t}\r\n\t\t}\r\n\t}\r\n//console.timeEnd(\"p3\")\r\n//console.time(\"p4\")\r\n\tconst byDArr = Array.from(byD.keys()),\r\n\t\tbyDArrLen = byDArr.length;\r\n\tfor (let $l, l, j, i = 0; i < byDArrLen; i++) {\r\n\t\tconst iDId = byDArr[i];\r\n//\t\tif (!byD.has(iDId)) {\r\n\t\tif (iDId === 0) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst mI = mergeByD.get(iDId);\r\n\t\tfor (j = 0; j < byDArrLen; j++) {\r\n\t\t\tconst jDId = byDArr[j];\r\n\t\t\tif (jDId === 0 || iDId === jDId) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tconst mJ = mergeByD.get(jDId);\r\n\t\t\tif (mI.len > mJ.len) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n//\t\t\tif (mI.len !== mJ.len && mJ.descrId.has(iDId)) {\r\n\t\t\tif (mJ.descrId.has(iDId)) {\r\n/*\r\n\t\t\t\t$l = $srcById.get(byD.get(jDId).sId);\r\n\t\t\t\tfor (l = mJ.len - mI.len; l !== -1; l--) {\r\n\t\t\t\t\t$l = $l.parentNode;\r\n\t\t\t\t}\r\nconsole.log(444, mJ.len - mI.len, $l, $srcById.get(byD.get(iDId).sId), descrById.get(jDId), byD.get(jDId));\r\n\t\t\t\tif ($srcById.get(byD.get(iDId).sId).parentNode === $l) {\r\n\t\t\t\t\tprpDeleteDescrId(byD, jDId, toCancleSync);\r\n\t\t\t\t\tbyDArr[j] = 0;\r\n\t\t\t\t}*/\r\n\t\t\t\tconst $p = $srcById.get(byD.get(iDId).sId).parentNode,\r\n\t\t\t\t\tlLen = mJ.len - mI.len;\r\n\t\t\t\tfor (const lId of descrById.get(jDId).srcIds) {\r\n\t\t\t\t\t$l = $srcById.get(lId);\r\n\t\t\t\t\tfor (l = lLen; $l !== null && l !== -1; l--) {//может быть стрытым\r\n\t\t\t\t\t\t$l = $l.parentNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ($l === $p) {\r\n\t\t\t\t\t\tprpDeleteDescrId(byD, jDId, toCancleSync);\r\n\t\t\t\t\t\tbyDArr[j] = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n//console.log(444, mI.firstAsOneIdx, mJ.firstAsOneIdx, iDId, jDId)\r\n\t\t\tif (mI.firstAsOneIdx !== 0 && mI.firstAsOneIdx === mJ.firstAsOneIdx) {\r\n\t\t\t\tprpDeleteDescrId(byD, jDId, toCancleSync);\r\n\t\t\t\tbyDArr[j] = 0;\r\n\t\t\t}\r\n/*\r\n//change on firstAsOneIdx\r\n\t\t\tif (mI.asOneIdx.size === 0 || mJ.asOneIdx.size === 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfor (const i of mI.asOneIdx) {\r\n\t\t\t\tif (mJ.asOneIdx.has(i)) {\r\n\t\t\t\t\tbyD.delete(jDId);\r\n//console.warn(byD.delete, dId);\r\n\t\t\t\t\tbyDArr[j] = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}*/\r\n/*\r\n\t\t\tconst mJ = mergeByD.get(jDId);\r\n//console.log(2, mI, mJ, iDId, jDId);\r\n\t\t\tif (mI.len < mJ.len) {\r\n\t\t\t\tif (mJ.descrId.has(iDId)) {\r\n\t\t\t\t\tbyD.delete(jDId);\r\n\t\t\t\t\tbyDArr[j] = 0;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (mI.asOneIdx.size === 0 || mJ.asOneIdx.size === 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfor (const i of mI.asOneIdx) {\r\n\t\t\t\t\tif (mJ.asOneIdx.has(i)) {\r\n\t\t\t\t\t\tbyD.delete(jDId);\r\n\t\t\t\t\t\tbyDArr[j] = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n//\t\t\tif (mI.len > mJ.len && mI.descrId.has(jDId)) {\r\n//\t\t\tif (mI.len > mJ.len && mI.descrId[jDId]) {\r\n\t\t\tif (mI.len === mJ.len) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (mI.descrId.has(jDId)) {\r\n\t\t\t\tbyD.delete(iDId);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (mI.asOneIdx.size === 0 || mJ.asOneIdx.size === 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tlet f = false;\r\n\t\t\tfor (const idx of mJ.asOneIdx) {\r\n\t\t\t\tif (mI.asOneIdx.has(idx)) {\r\n\t\t\t\t\tbyD.delete(iDId);\r\n\t\t\t\t\tf = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (f) {\r\n\t\t\t\tbreak;\r\n\t\t\t}*/\r\n\t\t}\r\n\t}\r\n//console.timeEnd(\"p4\")\r\n//console.log(2, new Map(byD), toCancleSync);\r\n//alert(1);\r\n\trenderParams.clear();\r\n\treturn byD;\r\n}\r\nfunction prpDeleteDescrId(byD, dId, toCancleSync) {\r\n\tif (!byD.has(dId)) {\r\n\t\treturn;\r\n\t}\r\n\tconst s = byD.get(dId).srcIds;\r\n//\tlet sId;\r\n\tfor (const sync of syncInRender) {\r\n//\t\tsId = sync.renderParam.sId;\r\n//\t\tfor (let l = sync.local.get(sId); l.newSrcId !== 0; l = sync.local.get(sId)) {\r\n//\t\t\tsId = l.newSrcId;\r\n//\t\t}\r\n//\t\tsId = getSrcId(sync.local, sync.renderParam.sId);\r\n\t\tif (s.has(sync.renderParam.sId)) {\r\n\t\t\tsync.stat = 4;\r\n\t\t\ttoCancleSync.add(sync);\r\n\t\t}\r\n\t}\r\n//console.error(dId);\r\n\tbyD.delete(dId);\r\n}\r\nfunction checkSync(sync, newRenderParam) {\r\n//0 - parallel\r\n//1 - new above\r\n//2 - new eq\r\n//3 - new below\r\n//4 - by prepare\r\n//5 - not found sync.renderParam.sId\r\n//7 - ready\r\n//8 - cancel\r\n//console.log(\"cancel\", sync.stat, sync, p);\r\n\tconst stat = getPosStat(sync, newRenderParam);\r\n\tif (sync.stat !== 0) {\r\n\t\treturn stat;\r\n\t}\r\n\tif (stat !== 0) {\r\n\t\tcancelSync(sync, stat);\r\n\t}\r\n\treturn stat;\r\n}\r\nexport function cancelSync(sync, stat) {\r\n\tsync.stat = stat;\r\n\tfor (const [id, r] of sync.idleCallback) {\r\n\t\tcancelIdleCallback(id);\r\n\t\tr();\r\n\t}\r\n\tfor (const [id, r] of sync.animationFrame) {\r\n\t\tcancelAnimationFrame(id);\r\n\t\tr();\r\n\t}\r\n\tsyncInRender.delete(sync);\r\n\tsync.resolve();\r\n\treturn stat;\r\n}\r\nfunction getPosStat(sync, newRenderParam) {\r\n//\tlet syncSrcId = sync.renderParam.sId;\r\n//\tif (!my.env.srcById.has(syncSrcId)) {\r\n//\t\tfor (let l = sync.local.get(syncSrcId); l.newSrcId !== 0; l = sync.local.get(syncSrcId)) {\r\n//\t\t\tsyncSrcId = l.newSrcId;\r\n//\t\t}\r\n//\t}\r\n\tconst syncSrcId = getSrcId(sync.local, sync.renderParam.sId),\r\n\t\t$sync = my.env.$srcById.get(syncSrcId);\r\n//todo--\r\n\tif ($sync === undefined) {\r\n//\t\tthrow new Error(\"!!! checkSync - hz \" + syncSrcId);\r\n\t\tconsole.warn(\"!!! checkSync - hz \" + syncSrcId);\r\n\t\treturn 5;\r\n\t}\r\n\tconst srcBy$src = my.env.srcBy$src,\r\n\t\t$top = my.rootElement.parentNode;\r\n\tif (newRenderParam.$els === null) {\r\n\t\tfor (let $i = $sync; $i !== $top; $i = $i.parentNode) {\r\n\t\t\tconst iId = srcBy$src.get($i).id;\r\n\t\t\tif (newRenderParam.srcIds.has(iId)) {\r\n\t\t\t\treturn iId === syncSrcId ? 2 : 1;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tconst $els = newRenderParam.$els,\r\n\t\t\t$elsLen = $els.length;\r\n\t\tfor (let j, $i = $sync; $i !== $top; $i = $i.parentNode) {\r\n//\t\t\tconst iId = srcBy$src.get($i).id;\r\n\t\t\tfor (j = 0; j < $elsLen; j++) {\r\n\t\t\t\tconst $j = $els[j];//,\r\n//\t\t\t\t\tjSrc = srcBy$src.get($j);\r\n//\t\t\t\tif (jSrc === undefined) {\r\n//\t\t\t\t\tcontinue;\r\n//\t\t\t\t}\r\n//\t\t\t\tconst jId = jSrc.id;\r\n//\t\t\t\tif (jId === iId) {//если будет большой делаэй, то новый параметр могут скрыть - и поэтому нужнго по ид\r\n//\t\t\t\t\treturn iId === syncSrcId ? 2 : 1;\r\n\t\t\t\tif ($j === $i) {\r\n\t\t\t\t\treturn srcBy$src.get($i).id === syncSrcId ? 2 : 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n//todo think about\r\n\tfor (let $i = my.env.$srcById.get(newRenderParam.sId).parentNode; $i !== $top; $i = $i.parentNode) {\r\n\t\tif (srcBy$src.get($i).id === syncSrcId) {\r\n\t\t\treturn 3;\r\n\t\t}\r\n\t}\r\n\treturn 0;\r\n}\r\nfunction infoBySrcIds(sIds) {\r\n\tconst i = {};\r\n\tfor (const sId of sIds) {\r\n\t\ti[sId] = my.env.$srcById.get(sId);\r\n\t}\r\n\treturn i;\r\n}\r\n","import {getProxy} from \"../proxy/proxy.js\";\n\nexport function type_src(id, descr, isCmd, isHide, asOneIdx, idx, cache) {\n\treturn {\n\t\tid,\n//\t\tdescrId: 0,\n\t\tdescr,\n\t\tisCmd,//: false,\n\t\tisHide,\n\t\tasOneIdx,\n\t\tidx,\n\t\tsave: null,\n\t\tcache,\n\t\tscopeCache: getProxy({}),\n\t\tisMounted: false\n\t};\n}\nexport function type_descr(id, sId, attr, varIds) {\n\treturn {\n\t\tid,\n\t\tsId,\n\t\tattr,\n\t\tvarIds,\n\t\tsrcIds: new Set([sId]),\n\t\tisCustomHtml: false,\n\t\tasOnes: null,\n\t\tget$elsByStr: null\n\t};\n}\nexport function type_get$elsByStr() {\n\treturn new Map();\n}\nexport function type_get$elsByStrI(/*cmd, str, */expr, pos) {\n\treturn {\n//\t\tcmd,\n//\t\tstr,\n\t\texpr,\n\t\tpos\n\t};\n}\nexport function type_asOneIdx(idx) {\n\treturn new Map(idx);\n}\nexport function type_idx(idx) {\n\treturn new Map(idx);\n}\nexport function type_save(save) {\n\tif (save === undefined) {\n\t\treturn new Map();\n\t}\n\tconst s = new Map();\n\tfor (const [n, v] of save) {\n\t\ts.set(n, type_saveI(v));\n\t}\n\treturn s;\n}\nexport function type_saveI(save) {\n\treturn new Map(save);\n}\n","import {type_cache} from \"../cache/type.js\";\nimport {setReqCmd} from \"../cmd/cmd.js\";\nimport {incCmdName, hideName} from \"../config/config.js\";\n//import {setAsOneIdx, getIdx, setIdx} from \"../dom/dom.js\";\n//import {loadingCount} from \"../loading/loading.js\";\nimport {getNewId} from \"./descr.js\";\nimport {type_src, type_descr, type_get$elsByStr, type_get$elsByStrI} from \"./type.js\";\n\nexport function createSrc($e, descr, asOneIdx, idx) {//вызов этой функции должен быть неприменнол на есть документ слева направо, если это фрагмент, то нужно обработать края\n\tconst sId = getNewId(),\n\t\tisHide = $e.getAttribute(hideName) !== null;\n//!!!\n\tif (descr === undefined) {\n//\tif (1) {\n\t\tdescr = createDescr($e, sId);\n\t\tconst src = descr.attr !== null ? type_src(sId, descr, true, isHide, null, null, type_cache()) : type_src(sId, descr, false, isHide, null, null, null);\n//if (descr.asOnes !== null && asOneIdx !== undefined) {src.asOneIdx = asOneIdx;}\n\t\tmy.env.$srcById.set(sId, $e);\n\t\tmy.env.srcById.set(sId, src);\n\t\tmy.env.srcBy$src.set($e, src);\n//!!если мы сделаем это, то в Инке в препаре будет вызыватьс яэто место и мы потеряем старые асОне\n//\t\tif (descr.asOnes !== null) {\n//\t\t\tsrc.asOneIdx = type_asOneIdx();\n//\t\t\tsrc.idx = type_idx();\n//\t\t\tfor (const str of descr.asOnes) {\n//\t\t\t\tsetAsOneIdx(src, str, getNewId());\n//\t\t\t\tsetIdx(src, str, 0);\n//\t\t\t}\n//\t\t}\n\t\treturn src;\n\t}\n\tdescr.srcIds.add(sId);//пока используется для получения .sId при удалении and prepareParam\n\tconst src = descr.attr !== null ? type_src(sId, descr, true, isHide, asOneIdx, idx, type_cache()) : type_src(sId, descr, false, isHide, null, null, null);\n\tmy.env.$srcById.set(sId, $e);\n\tmy.env.srcById.set(sId, src);\n\tmy.env.srcBy$src.set($e, src);\n\tif (!src.isCmd) {\n\t\treturn src;\n\t}\n/*\n\tfor (const [n, v] of descr.attr) {\n\t\tif (n !== incCmdName) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst incKey = getIdx(src, n);\n\t\tif (incKey !== undefined) {\n\t\t\tincCache.get(getIdx(src, n)).counter++;\n\t\t}\n\t}*/\n//\tmoveLoading($e, sId);\n\treturn src;\n}\nexport function createDescr($e, sId) {\n\tconst id = getNewId(),\n\t\tattr = createAttr($e);\n\tif (attr.size === 0) {\n\t\tconst descr = type_descr(id, sId, null, null);\n\t\tmy.env.descrById.set(id, descr);\n\t\treturn descr;\n\t}\n\tconst descr = type_descr(id, sId, attr, new Set());\n\tlet pos = 0;\n\tfor (const [str, expr] of attr) {\n\t\tconst rc = my.env.reqCmd.get(str);\n\t\tif (rc.cmd.get$els !== null) {\n\t\t\tif (descr.get$elsByStr === null) {\n\t\t\t\tdescr.get$elsByStr = type_get$elsByStr();\n\t\t\t}\n\t\t\tdescr.get$elsByStr.set(str, type_get$elsByStrI(/*rc.cmd, str, */expr, pos));\n\t\t}\n\t\tpos++;\n\t\tif (rc.cmd.isCustomHtml === true && descr.isCustomHtml === false) {\n\t\t\tdescr.isCustomHtml = true;\n\t\t}\n\t\tif (rc.cmd.isAsOne === true) {\n\t\t\tif (descr.asOnes === null) {\n\t\t\t\tdescr.asOnes = new Set();\n\t\t\t}\n\t\t\tdescr.asOnes.add(str);\n\t\t}\n\t}\n\tmy.env.descrById.set(id, descr);\n\treturn descr;\n}\n/*\nfunction moveLoading($e, sId) {\n\tconst l = loadingCount.get($e);\n\tif (l === undefined) {\n\t\treturn;\n\t}\n\tloadingCount.set(sId, l);\n\tloadingCount.delete($e);\n}*/\nfunction createAttr($e) {\n\tconst attr = new Map(),\n\t\tattrs = $e.attributes,\n\t\tattrsLen = attrs.length;\n\tfor (let i = 0; i < attrsLen; i++) {\n////\t\tconst a = attrs.item(i);\n\t\tconst a = attrs[i];\n//todo\tfor (const a of $e.attributes) {\n\t\tif (setReqCmd(a.name)) {\n\t\t\tattr.set(a.name, a.value);\n\t\t}\n\t}\n\treturn attr;\n}\n","﻿export function getErr(err, $src, req, scope, fileName, lineNum, colNum) {\r\n        let errMsg = \">>>mw error\";\r\n        if (my.getLineNo !== undefined) {\r\n        \tconst pos = my.getLineNo($src);// || my.getLineNo($src.parentNode);//todo зачем смотреть родителя?\r\n        \tif (pos) {\r\n\t        \terrMsg += ` in ${pos}`;\r\n\t        }\r\n        }\r\n\terrMsg += \"\\n\" + err.toString();\r\n\tconst params = [];\r\n\tparams.push(\"\\n$src =>\", $src, \"\\nsId =>\", my.env.srcBy$src.get($src)?.id);\r\n\tif (req) {\r\n\t\tparams.push(\"\\nreq =>\", req);\r\n\t        params.push(\"\\n\" + req.str + \" =>\", req.expr);\r\n\t}\r\n\tif (scope) {\r\n\t\tparams.push(\"\\nscope =>\", scope);\r\n\t}\r\n\tif (my.debugLevel !== 0) {\r\n\t\tconsole.info(errMsg, ...params);\r\n\t}\r\n\treturn fileName ? new Error(err, fileName, lineNum, colNum) : err;\r\n}\r\n","//import {type_animation} from \"./render/type.js\";\nimport {isFillingName, isFillingDiv} from \"../config/config.js\";\nimport {is$hide} from \"../dom/dom.js\";\nimport {type_loading} from \"./type.js\";\n//!!instance\nexport const loadingCount = new Map();\n\nexport async function showLoading($e, testFunc, type = \"\", waitTime) {\n//--\treq.sync.animations.add(type_animation(async () => {\n//\t\tconst lKey = getLoadingKey($e),\n//\t\t\tl = loadingCount.get(lKey);\n\t\tconst src = my.env.srcBy$src.get($e),\n\t\t\tsId = src.id,\n\t\t\tl = loadingCount.get(sId);\n\t\tif (await testFunc()) {\n\t\t\tif (l !== undefined) {\n\t\t\t\tdecLoading($e, type, l);\n\t\t\t} else {\n\t\t\t\ttoggleLoading($e, type, false, l);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n//\t\tconst ll = l === undefined ? createLoading(lKey) : l;\n\t\tconst ll = l === undefined ? createLoading(sId) : l;\n\t\ttoggleLoading($e, \"\", true, ll);\n\t\tif (type === \"\") {\n\t\t\treturn;\n\t\t}\n\t\tif (waitTime === undefined || waitTime === \"\") {\n\t\t\twaitTime = -1;\n\t\t}\n\t\tif (waitTime < 0) {\n\t\t\ttoggleLoading($e, type, true, ll);\n\t\t\treturn;\n\t\t}\n\t\tsetTimeout(async () => {\n\t\t\tif (is$hide($e)) {//!!так как запуст может быть через таймер - многое могло случится\n//console.warn(43243242);\n//alert(1);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!await testFunc()) {// && loadingCount.has(lKey)) {\n\t\t\t\ttoggleLoading($e, type, true, ll);\n\t\t\t}\n\t\t}, waitTime);\n//\t}, req.sync.local, 0));\n}\nfunction createLoading(sId) {\n\tconst n = type_loading();\n\tloadingCount.set(sId, n);\n\treturn n;\n}\n/*\nfunction createLoading(lKey) {\n\tconst n = type_loading();\n\tloadingCount.set(lKey, n);\n\treturn n;\n}\nfunction getLoadingKey($src) {\n\tconst src = my.env.srcBy$src.get($src);\n\tif (src === undefined) {\n\t\treturn $src;\n\t}\n\tif (loadingCount.has(src.id)) {\n\t\treturn src.id;\n\t}\n\tconst l = loadingCount.get($src);\n\tif (l === undefined) {\n//\t\treturn $src;\n\t\treturn src.id;\n\t}\n\tloadingCount.delete($src);\n\tloadingCount.set(src.id, l);\n\treturn src.id;\n}*/\nfunction decLoading($e, type, l) {\n\tif (type !== \"\") {\n\t\tconst amount = l.get(type) - 1\n\t\tl.set(type, amount);\n//\t\tif (amount <= 0) {\n//\t\t\ttoggleLoading($e, type, false, l);\n//\t\t}\n\t}\n\tconst amount = l.get(\"\") - 1;\n\tl.set(\"\", amount);\n\tif (amount > 0) {\n\t\treturn;\n\t}\n//\ttoggleLoading($e, \"\", false, l);\n//\tfor (const [key, count] of loadingCount) {\n\tfor (const [iId, iL] of loadingCount) {\n\t\tif (iL !== l) {\n\t\t\tcontinue\n\t\t}\n\t\tloadingCount.delete(iId);\n\t\tconst $i = my.env.$srcById.get(iId);\n\t\tif ($i === undefined) {\n\t\t\tcontinue;\n\t\t}\n\t\tfor (const type of l.keys()) {\n\t\t\ttoggleLoading($i, type, false, l);\n\t\t}\n/*\n\t\tfor (const [type, amount] of l) {\n\t\t\tif (amount > 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\ttoggleLoading($e, type, false, l);\n\t\t\tif (type === \"\") {\n//\t\t\t\tloadingCount.delete(key);\n\t\t\t\tloadingCount.delete(sId);\n\t\t\t}\n\t\t}*/\n\t}\n}\nfunction toggleLoading($e, type, f, l) {\n/*\n\tif (is$hide($e)) {//так как запуст может быть через таймер - многое могло случится//!!за это состояние нужно что бы отвечали команды...\nconsole.warn(43243242);\nalert(1);\n\t\treturn;\n\t}*/\n\tconst lName = type === \"\" ? isFillingName : isFillingName + isFillingDiv + type;\n\tif (!f) {\n\t\t$e.removeAttribute(lName, \"\");\n//\t\tif ($e.nodeName === \"TEMPLATE\" && $e.getAttribute(hideName) !== null) {\n\t\tif (my.env.srcBy$src.get($e).isHide) {\n\t\t\t$e.content.firstChild.removeAttribute(lName, \"\");\n\t\t}\n\t\treturn;\n\t}\n\tif (type === \"\") {\n\t\tconst c = l.get(\"\");\n\t\tl.set(\"\", c + 1);\n\t} else {\n\t\tconst c = l.get(type);\n\t\tif (c === undefined) {\n\t\t\tl.set(type, 1);\n\t\t} else {\n\t\t\tl.set(type, c + 1);\n\t\t}\n\t}\n\t$e.setAttribute(lName, \"\");\n//\tif ($e.nodeName === \"TEMPLATE\" && $e.getAttribute(hideName) !== null) {\n\tif (my.env.srcBy$src.get($e).isHide) {\n\t\t$e.content.firstChild.setAttribute(lName, \"\");\n\t}\n}\n","export function type_loading() {\n\treturn new Map([[\"\", 0]]);\n}\n","export function type_q$i($els, idx) {\n\treturn {\n\t\t$els,\n\t\tidx\n\t};\n}\nexport function type_cloneNodeOn(cmd, str, expr) {\n\treturn {\n\t\tcmd,\n\t\tstr,\n\t\texpr\n\t};\n}\n","//import {incCache, incClearByKey} from \"./cmd/inc.js\";\r\nimport {type_req, type_animation} from \"../render/type.js\";\r\nimport {type_cacheValue, type_cacheCurrent} from \"../cache/type.js\";\r\nimport {p_topUrl, visibleScreenSize, defIdleCallbackOpt, incCmdName, onCmdName, textCmdName, descrIdName, asOneIdxName, idxName, hideName, removeEventName, defEventInit} from \"../config/config.js\";\r\nimport {createSrc, createDescr} from \"../descr/create.js\";\r\nimport {getNewId, getSrcId, get$els, getNextStr} from \"../descr/descr.js\";\r\nimport {type_asOneIdx, type_idx} from \"../descr/type.js\";\r\nimport {getErr} from \"../err/err.js\";\r\nimport {loadingCount} from \"../loading/loading.js\";\r\nimport {type_q$i, type_cloneNodeOn} from \"./type.js\";\r\n\r\nexport function preRender($i, isLinking) {// = my.rootElement) {//todo это не будет работать если после фора идет вставка на много тегов\r\n\tconst $parent = $i.parentNode,\r\n\t\t$p = [],\r\n\t\tidAlias = new Map();//todo разнотипный мап!?\r\n\tdo {\r\n//////////////////////\r\n\t\tif ($i.firstChild !== null) {\r\n\t\t\t$i = $i.firstChild;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif ($i.nodeName === \"TEMPLATE\" && $i.getAttribute(hideName) !== null) {\r\n\t\t\t$p.push($i);\r\n\t\t\t$i = $i.content.firstChild;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\t$i = _preRenderCreate($i, idAlias, isLinking);\r\n\t\tif ($i.parentNode === $parent) {//если мы не ушли вглубь - значит и вправо двигаться нельзя\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif ($i.nextSibling !== null) {\r\n\t\t\t$i = $i.nextSibling;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tdo {\r\n\t\t\t$i = $i.parentNode;\r\n\t\t\tif ($i.nodeType === 11) {\r\n\t\t\t\t$i = $p.pop();\r\n\t\t\t}\r\n\t\t\t$i = _preRenderCreate($i, idAlias, isLinking);\r\n\t\t\tif ($i.parentNode === $parent) {\r\n\t\t\t\t$i = null;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif ($i.nextSibling !== null) {\r\n\t\t\t\t$i = $i.nextSibling;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} while (true);\r\n\t} while ($i !== null);\r\n}\r\nfunction _preRenderCreate($e, idAlias, isLinking) {\r\n\tif ($e.nodeType !== 1) {\r\n\t\treturn $e.nodeType === 3 ? replaceTextBlocks($e) : $e;\r\n\t}\r\n\tif (!isLinking) {\r\n\t\tcreateSrc($e);\r\n\t\treturn $e;\r\n\t}\r\n\tconst src = _preRenderGetSrc($e, idAlias);\r\n\tif (!src.isCmd) {\r\n\t\treturn $e;\r\n\t}\r\n\tfor (const str of src.descr.attr.keys()) {\r\n\t\tconst asOneIdx = $e.getAttribute(asOneIdxName + str),\r\n\t\t\tidx = $e.getAttribute(idxName + str);\r\n\t\tif (asOneIdx !== null) {\r\n\t\t\tconst aIdx = idAlias.get(asOneIdx);\r\n\t\t\tif (aIdx === undefined) {\r\n\t\t\t\tconst nIdx = getNewId();\r\n\t\t\t\tidAlias.set(asOneIdx, nIdx);\r\n\t\t\t\tif (src.asOneIdx === null) {\r\n\t\t\t\t\tsrc.asOneIdx = type_asOneIdx([[str, nIdx]]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsrc.asOneIdx.set(str, nIdx);\r\n\t\t\t\t}\r\n\t\t\t} else if (src.asOneIdx === null) {\r\n\t\t\t\tsrc.asOneIdx = type_asOneIdx([[str, aIdx]]);\r\n\t\t\t} else {\r\n\t\t\t\tsrc.asOneIdx.set(str, aIdx);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (idx !== null) {\r\n\t\t\tif (src.idx === null) {\r\n\t\t\t\tsrc.idx = type_idx([[!isNaN(idx) ? Number(idx) : idx]]);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tsrc.idx.set(str, !isNaN(idx) ? Number(idx) : idx);\r\n\t\t}\r\n/*!!!!!!\r\n\t\tif (my.env.reqCmd.get(str).cmd.isAsOne === false) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst $from = $i;\r\n\t\tfor (let $j = $i.nextSibling; $j !== null; $j = $j.nextSibling) {\r\n\t\t\tif ($j.nodeType !== 1) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (get$asOneIdx($j, str) !== asOneIdx && !(get$Idx($j, str) > 0)) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t_preRenderCopy($from, iDescr, $i = $j);\r\n\t\t}\r\n\t\tbreak;*/\r\n\t}\r\n\treturn $e;\r\n}\r\nfunction _preRenderGetSrc($e, idAlias) {\r\n\tconst dId = $e.getAttribute(descrIdName);\r\n\tif (dId === null) {\r\n\t\treturn createSrc($e);\r\n\t}\r\n\tconst descr = idAlias.get(dId);\r\n\tif (descr !== undefined) {\r\n\t\treturn createSrc($e, descr, null, null);\r\n\t}\r\n\tconst src = createSrc($e, createDescr($e, 0), null, null);\r\n\tsrc.descr.sId = src.id;\r\n\tidAlias.set(dId, src.descr);\r\n\treturn src;\r\n}\r\n/*\r\nfunction _preRenderCopy($f, fDescr, $i) {\r\n\tconst $parent = $f.parentNode,\r\n\t\t$p = [],\r\n\t\t$fP = [];\r\n\tdo {\r\n\t\tif ($i.nodeType === 1) {\r\n//console.log($f, $i);\r\n\t\t\tcreateSrc($i, fDescr);\r\n\t\t}\r\n//////////////////////\r\n\t\t//todo команда или нет?\r\n\t\tif ($i.nodeName === \"TEMPLATE\" && $i.content.firstChild.firstChild !== null) {\r\n\t\t\t$p.push($i);\r\n\t\t\t$i = $i.content.firstChild;\r\n\t\t}\r\n\t\tif ($f.nodeName === \"TEMPLATE\" && $f.content.firstChild.firstChild !== null) {\r\n\t\t\t$fP.push($f);\r\n\t\t\t$f = $f.content.firstChild;\r\n\t\t}\r\n\t\tif ($i.firstChild !== null) {\r\n\t\t\t$i = $i.firstChild;\r\n\t\t\t$f = $f.firstChild;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif ($i.parentNode === $parent) {//если мы не ушли вглубь - значит и вправо двигаться нельзя\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif ($i.nextSibling !== null) {\r\n\t\t\t$i = $i.nextSibling;\r\n\t\t\twhile ($f.nextSibling !== null) {\r\n\t\t\t\t$f = $f.nextSibling;\r\n\t\t\t}\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tdo {\r\n\t\t\t$i = $i.parentNode;\r\n\t\t\tif ($i.parentNode === $parent) {\r\n//\t\t\t\t$i = null;\r\n\t\t\t\t$f = null;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif ($i.parentNode.nodeType === 11) {\r\n\t\t\t\t$i = $p.pop();\r\n\t\t\t\tif ($i.parentNode === $parent) {\r\n//\t\t\t\t\t$i = null;\r\n\t\t\t\t\t$f = null;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t$f = $f.parentNode;\r\n\t\t\tif ($f.parentNode.nodeType === 11) {\r\n\t\t\t\t$f = $fP.pop();\r\n\t\t\t}\r\n\t\t\tif ($i.nextSibling !== null) {\r\n\t\t\t\t$i = $i.nextSibling;\r\n\t\t\t\twhile ($f.nextSibling !== null) {\r\n\t\t\t\t\t$f = $f.nextSibling;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} while (true);\r\n\t} while ($f);\r\n}*/\r\nfunction replaceTextBlocks($src) {\r\n\tconst text = $src.textContent;\r\n\tif (text.indexOf(\"${\") === -1 || $src.parentNode.nodeName === \"SCRIPT\") {\r\n\t\treturn $src;\r\n\t}\r\n\tif ($src.nextSibling === null && $src.previousSibling === null) {\r\n\t\t$src.parentNode.setAttribute(textCmdName, \"`\" + text + \"`\");\r\n\t\treturn $src;\r\n\t}\r\n\tconst $t = my.document.createElement(\"span\");\r\n\t$t.setAttribute(textCmdName, \"`\" + text + \"`\");\r\n\t$src.parentNode.replaceChild($t, $src);\r\n\tcreateSrc($t);\r\n\treturn $t;\r\n}\r\nexport function joinText($i) {\r\n\t$i = $i.firstChild;\r\n\tfor (let $next; $i !== null; $i = $i.nextSibling) {\r\n\t\twhile ($i.nodeType === 3 && ($next = $i.nextSibling) !== null && $next.nodeType === 3) {\r\n\t\t\t$i.textContent += $e.removeChild($next).textContent;\r\n\t\t}\r\n\t}\r\n}\r\n/*--\r\nfunction replaceTextBlocks($src) {//, scope) {//когда рендерится - то он делает это в фрагменте и родители выше фрагмента не доступны\r\n//\tif ($src.isTextRendered) {\r\n//\t\treturn $src;\r\n//\t}\r\n\tconst text = $src.textContent,\r\n\t\tblocks = getMustacheBlocks(text),\r\n\t\tblocksLen = blocks.length;\r\n\tif (!blocksLen || (blocksLen === 1 && !blocks[0].expr)) {\r\n//\t\t$src.isTextRendered = true;\r\n\t\treturn $src;\r\n\t}\r\n\tconst $fr = my.document.createDocumentFragment();\r\n\tfor (let i = 0; i < blocksLen; i++) {\r\n\t\tconst b = blocks[i];\r\n\t\tif (b.expr) {\r\n\t\t\tconst $i = $fr.appendChild(my.document.createElement(\"span\"));\r\n\t\t\tsetAttribute($i, textCmdName, text.substring(b.begin, b.end));\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\t$fr.appendChild(my.document.createTextNode(text.substring(b.begin, b.end)));\r\n//\t\t\t.isTextRendered = true;\r\n\t}\r\n\tconst $last = $fr.lastChild;\r\n\t$src.parentNode.replaceChild($fr, $src);\r\n\treturn $last;\r\n}\r\nfunction getMustacheBlocks(text) {\r\n\tconst textLen = text.length,\r\n\t\tblocks = [];\r\n\tfor (let begin = 0, i = 0; i < textLen;) {\r\n\t\ti = text.indexOf(\"{{\", i);\r\n\t\tif (i === -1) {\r\n\t\t\tblocks.push(type_mustacheBlock(begin, textLen, false));\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tlet j = text.indexOf(\"}}\", i);\r\n\t\tif (j === -1) {\r\n\t\t\tblocks.push(type_mustacheBlock(begin, textLen, false));\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\twhile (text.indexOf(\"}}\", j + 1) === j + 1) {\r\n\t\t\tj++;\r\n\t\t}\r\n\t\tif (i !== begin) {\r\n\t\t\tblocks.push(type_mustacheBlock(begin, i, false));\r\n\t\t}\r\n\t\tblocks.push(type_mustacheBlock(i + 2, j, true));\r\n\t\ti = begin = j + 2;\r\n\t}\r\n\treturn blocks;\r\n}\r\nfunction type_mustacheBlock(begin, end, expr) {\r\n\treturn {\r\n\t\tbegin,\r\n\t\tend,\r\n\t\texpr\r\n\t};\r\n}*/\r\nexport function removeChild($e, req) {\r\n//console.error(\"remC\", my.env.srcBy$src.get($e), $e);\r\n/*\r\n//todo\r\nif (!$e.parentNode) {\r\n\tconsole.error(req.sync, $e);\r\n\talert(11)\r\n}*/\r\n\t$e.parentNode.removeChild($e);\r\n\t$e.dispatchEvent(new CustomEvent(removeEventName, defEventInit));\r\n\tconst rem = new Map(),\r\n\t\tsrcBy$src = my.env.srcBy$src;\r\n\tlet $i = $e;\r\n\tconst $parent = null,\r\n\t\t$p = [];\r\n\tdo {\r\n//////////////////////\r\n\t\tconst iSrc = srcBy$src.get($i);\r\n//\t\tif (iSrc !== undefined && !iSrc.descr.isCustomHtml) {\r\n\t\tif (iSrc !== undefined) {\r\n\t\t\tclearTag($i, iSrc, rem);\r\n\t\t\tif (iSrc.descr.isCustomHtml) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif ($i.firstChild !== null) {\r\n\t\t\t\t$i = $i.firstChild;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n//\t\t\tif (iSrc.isCmd && $i.nodeName === \"TEMPLATE\" && $i.getAttribute(hideName) !== null) {\r\n\t\t\tif (iSrc.isHide && iSrc.isCmd && $i.content.firstChild.firstChild !== null) {\r\n\t\t\t\t$p.push($i);\r\n\t\t\t\t$i = $i.content.firstChild.firstChild;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ($i.parentNode === $parent) {//если мы не ушли вглубь - значит и вправо двигаться нельзя\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif ($i.nextSibling !== null) {\r\n\t\t\t$i = $i.nextSibling;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tdo {\r\n\t\t\t$i = $i.parentNode;\r\n\t\t\tif ($i.nodeType === 11) {\r\n\t\t\t\t$i = $p.pop();\r\n\t\t\t}\r\n\t\t\tif ($i.parentNode === $parent) {\r\n\t\t\t\t$i = null;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif ($i.nextSibling !== null) {\r\n\t\t\t\t$i = $i.nextSibling;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} while(true);\r\n\t} while ($i !== null);\r\n\tif (rem.size === 0) {\r\n\t\treturn;\r\n\t}\r\n\trequestIdleCallback(() => {\r\n//console.time(\"rem\");\r\n\t\tclearVars(rem);\r\n//console.timeEnd(\"rem\");\r\n\t}, defIdleCallbackOpt);\r\n}\r\nfunction clearTag($e, src, rem) {\r\n//console.log($e, src.id, rem);\r\n\tconst sId = src.id,\r\n\t\tdescr = src.descr,\r\n\t\tdId = descr.id;\r\n\tmy.env.$srcById.delete(sId);\r\n\tmy.env.srcById.delete(sId);\r\n\tmy.env.srcBy$src.delete($e);\r\n//console.error(\"DEL\", src.id, $e, src.isCmd, descr);\r\n\tif (!src.isCmd) {\r\n//простые теги тоже могут быть с одним описанием\r\n\t\tdescr.srcIds.delete(sId);\r\n\t\tif (descr.srcIds.size === 0) {\r\n\t\t\tmy.env.descrById.delete(dId);\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n/*\r\n\t\tfor (const [n, v] of descr.attr) {\r\n\t\t\tif (n !== incCmdName) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tconst incKey = getIdx(src, n);\r\n\t\t\tif (incKey !== undefined && incCache.has(incKey)) {\r\n\t\t\t\tincClearByKey(incKey);\r\n\t\t\t}\r\n\t\t}\r\n*/\r\n\tloadingCount.delete(sId);\r\n\tdescr.srcIds.delete(sId);\r\n\tif (descr.sId === sId) {\r\n\t\tdescr.sId = descr.srcIds.values().next().value;//todo REM! тут может быть undef - это при условии что все элемены цикла пошли на удаление (это при замене через inc) - и раз undef то в rem есть все элементы и первый изних очистит всё, а остальные нужно пропустить\r\n\t}\r\n\tconst r = rem.get(dId);\r\n\tif (r) {\r\n\t\tr.add(sId);\r\n\t\treturn;\r\n\t}\r\n\trem.set(dId, new Set([sId]));\r\n}\r\nfunction clearVars(rem) {\r\n\tconst varIdByVar = my.env.varIdByVar,\r\n\t\tvarById = my.env.varById,\r\n\t\tvarIdByVarIdByProp = my.env.varIdByVarIdByProp,\r\n\t\tsrcIdsByVarId = my.env.srcIdsByVarId,\r\n\t\tdescrById = my.env.descrById,\r\n\r\n\t\tvIds = new Set(),\r\n\t\tsIds = new Set(),\r\n\t\tdeletedVarId = new Set();//,\r\n//\t\tskipDelBySrcId = {};\r\n\tfor (const [dId, s] of rem) {\r\n\t\tconst d = descrById.get(dId);\r\n\t\tif (d === undefined) {//todo REM!\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tfor (const vId of d.varIds) {\r\n\t\t\tvIds.add(vId);\r\n\t\t}\r\n//}\r\n\t\tfor (const sId of s) {\r\n\t\t\tsIds.add(sId);\r\n//\t\t\tif (d.isAsOne && sId != d.sId) {\r\n//todo\r\n//console.error(123);\r\n//alert(123);\r\n//\t\t\t\tskipDelBySrcId[sId] = true;\r\n//\t\t\t}\r\n\t\t}\r\n\t}\r\n\tfor (const vId of vIds) {\r\n\t\tconst s = srcIdsByVarId.get(vId);\r\n\t\tif (!s) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst vIdByProp = varIdByVarIdByProp.get(vId);\r\n//\t\tlet f = false;\r\n\t\tfor (const sId of sIds) {\r\n//\t\t\tif (skipDelBySrcId[sId]) {\r\n//\t\t\t\tf = true;\r\n//\t\t\t}\r\n\t\t\tif (s.has(sId)) {\r\n//console.log(1, vId, sId, s.has(sId), s);\r\n//alert(1);\r\n\t\t\t\ts.delete(sId);\r\n\t\t\t}\r\n\t\t\tif (vIdByProp === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfor (const [pName, pId] of vIdByProp) {\r\n\t\t\t\tconst propS = srcIdsByVarId.get(pId);\r\n\t\t\t\tif (propS !== undefined && propS.has(sId)) {\r\n//console.log(vIdByProp, sId, pId);\r\n\t\t\t\t\ts.delete(sId);\r\n\t\t\t\t\tpropS.delete(sId);\r\n\t\t\t\t\tif (propS.size === 0) {\r\n\t\t\t\t\t\tdeletedVarId.add(pId);\r\n\t\t\t\t\t\tsrcIdsByVarId.delete(pId);\r\n\t\t\t\t\t\tvIdByProp.delete(pName);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n//\t\tif (f) {\r\n//\t\t\tcontinue;\r\n//\t\t}\r\n//console.log(2, vId, s);\r\n\t\tif (s.size === 0) {\r\n\t\t\tdeletedVarId.add(vId);\r\n\t\t\tsrcIdsByVarId.delete(vId);\r\n\t\t\tvarIdByVar.delete(varById.get(vId));\r\n\t\t\tvarById.delete(vId);\r\n\t\t\tif (vIdByProp !== undefined) {\r\n\t\t\t\tvarIdByVarIdByProp.delete(vId);\r\n//todo\r\n\t\t\t\tif (vIdByProp.size !== 0) {\r\n\t\t\t\t\tconsole.warn(\"должно быть пусто\", vId, vIdByProp);\r\n\t\t\t\t}\r\n//--\t\t\t\tfor (const pId of vIdByProp.values()) {\r\n//\t\t\t\t\tsrcIdsByVarId.delete(pId);\r\n//\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (vIdByProp !== undefined && vIdByProp.size === 0) {\r\n\t\t\tvarIdByVarIdByProp.delete(vId);\r\n\t\t}\r\n\t}\r\n\tfor (const [dId, s] of rem) {\r\n\t\tconst d = descrById.get(dId);\r\n\t\tif (d === undefined) {//todo REM!\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tfor (const vId of deletedVarId) {\r\n\t\t\td.varIds.delete(vId);\r\n\t\t}\r\n\t\tfor (const sId of s) {\r\n\t\t\td.srcIds.delete(sId);\r\n//todo--\r\n\t\t\tif (d.sId === sId) {\r\n\t\t\t\tconsole.warn(22222222);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (d.srcIds.size === 0) {\r\n\t\t\tdescrById.delete(dId);\r\n\t\t}\r\n\t}\r\n}\r\n/*\r\nexport function cloneNode(req, $e) {//во время клонирования описания не будут созданы - предназначен для клогнирования новго элемента (который ранее не рендерился)\r\n\tif ($e.nodeType === 11) {\r\n\t\tconst $fr = my.document.createDocumentFragment();\r\n\t\tfor ($e = $e.firstChild; $e !== null; $e = $e.nextSibling) {\r\n\t\t\t$fr.appendChild(cloneNode(req, $e));\r\n\t\t}\r\n\t\treturn $fr;\r\n\t}\r\n\tif ($e.nodeType !== 1) {\r\n\t\treturn $e.cloneNode();\r\n\t}\r\n\tconst $n = $e.cloneNode(true),\r\n\t\t$on = $n.nodeName !== \"TEMPLATE\" || $n.getAttribute(hideName) === null ? $n : $n.content.firstChild,\r\n\t\tsrc = my.env.srcBy$src.get(req.$src);\r\n\tfor (const [n, v] of src.descr.attr) {\r\n\t\tif (n === req.str) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tconst rc = my.env.reqCmd.get(n);\r\n\t\tif (rc.cmdName === onCmdName) {\r\n//console.log(111111, n, v, $on);\r\n\t\t\trc.cmd.render(type_req($on, n, v, req.scope, req.sync));\r\n\t\t}\r\n\t}\r\n\tconst l = loadingCount.get(src.id);\r\n\tif (l !== undefined) {\r\n\t\tloadingCount.set($n, l);\r\n\t}\r\n\treturn $n;\r\n}*/\r\nexport function q_cloneNode(req, sId, beginIdx, len) {//во время клонирования будут созданы описания\r\n\tsId = getSrcId(req.sync.local, sId);\r\n\tconst srcBy$src = my.env.srcBy$src,\r\n\t\t$src = my.env.$srcById.get(sId),\r\n\t\tsrc = my.env.srcById.get(sId),\r\n\t\tnStr = getNextStr(src, req.str),\r\n\t\t$els = nStr !== \"\" ? get$els($src, src.descr.get$elsByStr, nStr) : [$src],\r\n\t\t$elsLen = $els.length,\r\n\t\tarr = new Array(len),\r\n\t\ton = [];\r\n\tlet fSrc;\r\n\tfor (let i = 0, f; i < $elsLen; i++) {\r\n\t\tconst $i = $els[i];\r\n\t\tfSrc = srcBy$src.get($i);\r\n\t\tif (fSrc === undefined || !fSrc.isCmd) {\r\n//todo--\r\n//console.warn($i)\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tbreak;\r\n\t}\r\n\tif (fSrc === undefined) {\r\n\t\tconsole.warn(\">>>mw dom:q_cloneNode:\", req, $els, beginIdx, len);\r\n\t\tthrow getErr(new Error(`>>>mw dom:q_cloneNode: среди элементов для клонирования нет элемента с командой, такого не должно быть`), req.$src, req);\r\n\t}\r\n\tconst fDescr = fSrc.descr;\r\n\tfor (const [n, v] of fDescr.attr) {\r\n\t\tif (n === req.str) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tconst rc = my.env.reqCmd.get(n);\r\n\t\tif (rc.cmdName === onCmdName) {\r\n\t\t\ton.push(type_cloneNodeOn(rc.cmd, n, v));\r\n\t\t}\r\n\t}\r\n\tconst onLen = on.length,\r\n\t\tl = loadingCount.get(fSrc.id),\r\n\t\tbaseAsOne = new Set(),\r\n\t\tasOneVal = new Array(len),\r\n\t\taIt = fDescr.asOnes.keys();\r\n\tfor (let i = aIt.next(); !i.done; i = aIt.next()) {\r\n\t\tif (i.value !== req.str) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tfor (i = aIt.next(); !i.done; i = aIt.next()) {\r\n\t\t\tbaseAsOne.add(i.value);\r\n\t\t}\r\n\t}\r\n\tfor (let i = 0; i < len; i++) {\r\n\t\tarr[i] = type_q$i(new Array($elsLen), i + beginIdx);\r\n\t\tasOneVal[i] = new Map();\r\n\t}\r\n\tfor (let i, idx, j = 0; j < $elsLen; j++) {\r\n\t\tconst $jArr = new Array(len),\r\n\t\t\t$j = $els[j];\r\n\t\tq_cloneNodeCreate($j, $j.nodeName !== \"TEMPLATE\" || $j.getAttribute(hideName) === null, $jArr, len, asOneVal, 0, baseAsOne);\r\n\t\tq_cloneNodeCreateChildren($j, $jArr, len, asOneVal);\r\n\t\tfor (i = 0; i < len; i++) {\r\n\t\t\tconst arrI = arr[i],\r\n\t\t\t\t$i = arrI.$els[j] = $jArr[i],\r\n\t\t\t\tiSrc = srcBy$src.get($i);\r\n\t\t\tif (iSrc === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tsetIdx(iSrc, req.str, arrI.idx);\r\n\t\t\tif (onLen !== 0) {\r\n\t\t\t\tfor (k = 0; k < onLen; k++) {\r\n\t\t\t\t\tconst o = on[k];\r\n\t\t\t\t\to.cmd.render(type_req($i, o.str, o.expr, req.scope, req.sync));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (l !== undefined) {\r\n//todo заменить $i на iSrc.id\r\n//\t\t\t\tloadingCount.set($i, l);\r\n//todo не понятно как убирать филилинг с новых элементов\r\n\t\t\t\tloadingCount.set(iSrc.id, l);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn arr;\r\n}\r\nfunction q_cloneNodeCreateChildren($i, $arr, $arrLen, asOneVal) {\r\n\tconst $tP = new Array($arrLen),\r\n\t\t$parent = $i.parentNode,\r\n\t\t$p = [];\r\n\tfor (let i = 0; i < $arrLen; i++) {\r\n\t\t$tP[i] = [];\r\n\t}\r\n\tdo {\r\n//////////////////////\r\n\t\tif ($i.firstChild !== null) {\r\n\t\t\tq_cloneNodeCreate($i = $i.firstChild, true, $arr, $arrLen, asOneVal, 1, null);\r\n\t\t\tcontinue;\r\n\t\t}\r\n//\t\tconst iSrc = srcBy$src.get($i);\r\n//\t\tif (iSrc !== undefined && iSrc.isHide) {\r\n\t\tif ($i.nodeName === \"TEMPLATE\" && $i.getAttribute(hideName) !== null) {\r\n\t\t\t$p.push($i);\r\n\t\t\tfor (let i = 0; i < $arrLen; i++) {\r\n\t\t\t\t$tP[i].push($arr[i]);\r\n\t\t\t}\r\n\t\t\tq_cloneNodeCreate($i = $i.content.firstChild, false, $arr, $arrLen, asOneVal, 1, null);\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif ($i.parentNode === $parent) {//если мы не ушли вглубь - значит и вправо двигаться нельзя\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif ($i.nextSibling !== null) {\r\n\t\t\tq_cloneNodeCreate($i = $i.nextSibling, true, $arr, $arrLen, asOneVal, 2, null);\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tdo {\r\n\t\t\t$i = $i.parentNode;\r\n//\t\t\tif ($i.nodeType === 11) {\r\n\t\t\tif ($i.nodeType !== 11) {\r\n\t\t\t\tfor (let i = 0; i < $arrLen; i++) {\r\n\t\t\t\t\t$arr[i] = $arr[i].parentNode;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t$i = $p.pop();\r\n\t\t\t\tfor (let i = 0; i < $arrLen; i++) {\r\n\t\t\t\t\t$arr[i] = $tP[i].pop();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ($i.parentNode === $parent)  {\r\n\t\t\t\t$i = null;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif ($i.nextSibling !== null) {\r\n\t\t\t\tq_cloneNodeCreate($i = $i.nextSibling, true, $arr, $arrLen, asOneVal, 2, null);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} while (true);\r\n\t} while ($i !== null);\r\n}\r\nfunction q_cloneNodeCreate($e, isNotHide, $arr, $arrLen, asOneVal, type, baseAsOne) {\r\n\tconst src = my.env.srcBy$src.get($e);\r\n\tif (src === undefined) {\r\n\t\tif (type === 2) {\r\n\t\t\tfor (let i = 0; i < $arrLen; i++) {\r\n\t\t\t\t$arr[i] = $arr[i].parentNode.appendChild($e.cloneNode());\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (type === 1) {\r\n\t\t\tif (isNotHide) {\r\n\t\t\t\tfor (let i = 0; i < $arrLen; i++) {\r\n\t\t\t\t\t$arr[i] = $arr[i].appendChild($e.cloneNode());\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tfor (let i = 0; i < $arrLen; i++) {\r\n\t\t\t\t$arr[i] = $arr[i].content.appendChild($e.cloneNode());\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (let i = 0; i < $arrLen; i++) {\r\n\t\t\t$arr[i] = $e.cloneNode();\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\tconst descr = src.descr,\r\n\t\tidx = src.idx,\r\n\t\tsave = src.save,\r\n\t\tasOneIdx = src.asOneIdx;\r\n\tif (type === 2) {\r\n\t\tfor (let i = 0; i < $arrLen; i++) {\r\n\t\t\tcreateSrc($arr[i] = $arr[i].parentNode.appendChild($e.cloneNode()), descr, type_asOneIdx(asOneIdx), type_idx(src.idx)).save = save;\r\n\t\t}\r\n\t\tif (asOneIdx !== null) {\r\n\t\t\tq_cloneNodeChangeAsOne($arr, $arrLen, asOneVal, asOneIdx);\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\tif (type === 1) {\r\n\t\tif (isNotHide) {\r\n\t\t\tfor (let i = 0; i < $arrLen; i++) {\r\n\t\t\t\tcreateSrc($arr[i] = $arr[i].appendChild($e.cloneNode()), descr, type_asOneIdx(asOneIdx), type_idx(src.idx)).save = save;\r\n\t\t\t}\r\n\t\t\tif (asOneIdx !== null) {\r\n\t\t\t\tq_cloneNodeChangeAsOne($arr, $arrLen, asOneVal, asOneIdx);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (let i = 0; i < $arrLen; i++) {\r\n\t\t\tcreateSrc($arr[i] = $arr[i].content.appendChild($e.cloneNode()), descr, type_asOneIdx(asOneIdx), type_idx(src.idx)).save = save;\r\n\t\t}\r\n\t\tif (asOneIdx !== null) {\r\n\t\t\tq_cloneNodeChangeAsOne($arr, $arrLen, asOneVal, asOneIdx);\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\tfor (let i = 0; i < $arrLen; i++) {\r\n\t\tcreateSrc($arr[i] = $e.cloneNode(), descr, type_asOneIdx(asOneIdx), type_idx(src.idx)).save = save;\r\n\t}\r\n\tif (asOneIdx !== null) {\r\n\t\tq_cloneNodeChangeAsOne($arr, $arrLen, asOneVal, baseAsOne);\r\n\t}\r\n}\r\nfunction q_cloneNodeChangeAsOne($arr, $arrLen, asOneVal, asOneIdx) {\r\n\tconst srcBy$src = my.env.srcBy$src;\r\n\tfor (let i = 0; i < $arrLen; i++) {\r\n\t\tconst $i = $arr[i],\r\n\t\t\tiSrc = srcBy$src.get($i);\r\n\t\tfor (const n of asOneIdx.keys()) {\r\n\t\t\tconst curIdx = iSrc.asOneIdx.get(n),\r\n\t\t\t\tv = asOneVal[i].get(curIdx);\r\n\t\t\tif (v !== undefined) {\r\n\t\t\t\tsetAsOneIdx(iSrc, n, v);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tconst vv = getNewId();\r\n\t\t\tasOneVal[i].set(curIdx, vv)\r\n\t\t\tsetAsOneIdx(iSrc, n, vv);\r\n\t\t}\r\n\t}\r\n}\r\n//use in attr\r\n/*не нужно из-за того что будет срабатывать только один раз - дальше кэш\r\n// --- вообще то может пригодится если будет надобнасть получить значение которе еще не применено через раф - но пока не нужно\r\nexport function getAttribute($e, name) {\r\n\tif ($e.nodeName === \"INPUT\") {\r\n\t\tswitch (name) {\r\n\t\t\tcase \"value\":\r\n\t\t\t\treturn $e.value;\r\n\t\t\tcase \"checked\":\r\n\t\t\t\treturn $e.checked ? \"checked\" : \"\";\r\n\t\t}\r\n\t}\r\n\treturn $e.getAttribute(name);\r\n}*/\r\nexport function setAttribute($e, name, value) {\r\n//todo атрибут нелльзя создать, если в нем есть некорректные символы - решение ниже слишком исбыточное, на мой взгляд\r\n//\tfor (let i = name.indexOf(\"$\"); i > 0; i = name.indexOf(\"$\")) {\r\n//\t\tname = name.substr(0, i) + name.substr(i + 1);\r\n//\t}\r\n\tsetAttributeValue($e, name, value);\r\n\t$e.setAttribute(name, value);\r\n//!!! думаю что так можно\r\n//\tgetDescrAttrsBy$scr($e)[name] = value;\r\n}\r\nexport function setAttributeValue($e, name, value) {\r\n\tswitch (name) {\r\n\t\tcase \"value\":\r\n\t\t\tif ($e === document.activeElement && typeof $e.setSelectionRange === \"function\") {\r\n\t\t\t\tconst pos = $e.selectionStart;\r\n\t\t\t\t$e.value = value;\r\n//todo input type number console.log($e)\r\n\t\t\t\tif ($e.type === \"text\" || $e.type === \"search\") {\r\n\t\t\t\t\t$e.setSelectionRange(pos, pos);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t$e.value = value;\r\n\t\t\t}\r\n\t\tbreak;\r\n\t\tcase \"checked\":\r\n\t\t\t$e.checked = !!value;\r\n\t\tbreak;\r\n\t}\r\n}\r\n//use in attr\r\nexport function removeAttribute($e, name) {\r\n\tswitch (name) {\r\n\t\tcase \"value\":\r\n\t\t\t$e.value = \"\";\r\n\t\tbreak;\r\n\t\tcase \"checked\":\r\n\t\t\t$e.checked = false;\r\n\t\tbreak;\r\n\t}\r\n\t$e.removeAttribute(name);\r\n//!! см. выше\r\n//\tgetDescrAttrsBy$scr($e).delete(name);\r\n}\r\n\r\nexport function show(req, $e) {\r\n\tconst src = my.env.srcBy$src.get($e);\r\n\tif (src !== undefined ? !src.isHide : ($e.nodeName !== \"TEMPLATE\" || $e.getAttribute(hideName) === null)) {\r\n\t\treturn;\r\n\t}\r\n\treq.sync.animations.add(type_animation(() => _show(req, $e, src), req.sync.local, 0));//my.env.srcBy$src.get($e).id]));\r\n}\r\nfunction _show(req, $e, src) {\r\n\tconst $new = $e.content.firstChild;\r\n\tif (!$new || $new.nextSibling !== null) {\r\n\t\t//todo была ошибка, что $e ет в srcBy$src - повоторить не получается - эта шибка проявляется если Препаре даёт сбой, на данный момент не замечены проблемы в нём\r\n\t\tthrow getErr(new Error(\">>>mw show:01: Template element invalid structure on show function. <template>.content.childNodes.length must be only one element.\"), $e);\r\n\t}\r\n//\tif ($new.nodeType === 1 && my.env.srcBy$src.has($e)) {\r\n\tif (src !== undefined) {\r\n\t\tmoveProps($e, src, $new, false);\r\n\t}\r\n\tif (req.$src === $e) {\r\n\t\treq.$src = $new;\r\n\t}\r\n\t$e.parentNode.replaceChild($new, $e);\r\n}\r\nexport function hide(req, $e) {\r\n\tconst src = my.env.srcBy$src.get($e);\r\n\tif (src !== undefined) {\r\n\t\tif (!src.isHide) {\r\n\t\t\treq.sync.animations.add(type_animation(() => _hide($e, src), req.sync.local, src.id));\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\tif ($e.nodeType === 1 ? $e.nodeName === \"TEMPLATE\" && $e.getAttribute(hideName) !== null : $e.nodeType !== 8) {\r\n\t\treq.sync.animations.add(type_animation(() => _hide($e, src), req.sync.local, 0));\r\n\t}\r\n}\r\nfunction _hide($e, src) {\r\n\tlet $i = $e;\r\n\tconst srcBy$src = my.env.srcBy$src,\r\n\t\t$new = my.document.createElement(\"template\"),\r\n\t\t$parent = $i.parentNode,\r\n\t\t$p = [];\r\n\t$new.setAttribute(hideName, \"\");\r\n\tdo {\r\n//////////////////////\r\n\t\tconst iSrc = srcBy$src.get($i);\r\n\t\tif (iSrc !== undefined) {\r\n\t\t\tconst c = iSrc.cache;//это тоже самое что и $i.isCmd\r\n\t\t\tif (c !== null) {//todo тут можно удалять кэш только для дочерних элементов, но так как еще нужно удалить кэш для команд-после, то такой подход оправдан\r\n\t\t\t\tc.value = type_cacheValue();\r\n\t\t\t\tc.current = type_cacheCurrent();\r\n\t\t\t}\r\n\t\t\tif ($i.firstChild !== null) {\r\n\t\t\t\t$i = $i.firstChild;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n//\t\t\tif ($i.nodeName === \"TEMPLATE\" && $i.getAttribute(hideName) !== null) {//iSrc.isCmd) {// && $i.content.firstChild.firstChild !== null) {//проверку на кастом не делается из соображений экономичности\r\n\t\t\tif (iSrc.isHide && $i.content.firstChild.firstChild !== null) {\r\n\t\t\t\t$p.push($i);\r\n\t\t\t\t$i = $i.content.firstChild.firstChild;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ($i.parentNode === $parent) {//если мы не ушли вглубь - значит и вправо двигаться нельзя\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif ($i.nextSibling !== null) {\r\n\t\t\t$i = $i.nextSibling;\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tdo {\r\n\t\t\t$i = $i.parentNode;\r\n\t\t\tif ($i.nodeType === 11) {\r\n\t\t\t\t$i = $p.pop();\r\n\t\t\t}\r\n\t\t\tif ($i.parentNode === $parent) {\r\n\t\t\t\t$i = null;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif ($i.nextSibling !== null) {\r\n\t\t\t\t$i = $i.nextSibling;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} while (true);\r\n\t} while ($i !== null);\r\n//\tif ($e.nodeType === 1) {\r\n\tif (src !== undefined) {\r\n\t\tmoveProps($e, src, $new, true);\r\n\t}\r\n\t//!!переписывать req.$src в данном случаи не имет смысла\r\n\t$e.parentNode.replaceChild($new, $e);\r\n\t$new.content.appendChild($e);\r\n}\r\nfunction moveProps($from, fromSrc, $to, isHide) {\r\n//!!<-- show hide\r\n//\tconst fromSrc = my.env.srcBy$src.get($from);\r\n\tfromSrc.isHide = isHide;\r\n\tmy.env.$srcById.set(fromSrc.id, $to);\r\n\tmy.env.srcById.set(fromSrc.id, fromSrc);\r\n//\tmy.env.srcBy$src.delete($from);\r\n\tmy.env.srcBy$src.set($to, fromSrc);\r\n\r\n\t$to[p_topUrl] = $from[p_topUrl];\r\n\tif (my.debugLevel === 0) {\r\n\t\treturn;\r\n\t}\r\n\t//это какбы не нужно - мы же подготовленной структуре проходим\r\n\tif (!isHide) {\r\n\t\treturn;\r\n\t}\r\n\tconst attrs = $from.attributes,\r\n\t\tattrsLen = attrs.length;\r\n\tfor (let i = 0; i < attrsLen; i++) {\r\n//\t\tconst a = attrs.item(i);\r\n\t\tconst a = attrs[i];\r\n//\tfor (const a of $from.attributes) {\r\n\t\tsetAttribute($to, a.name, a.value);\r\n\t}\r\n}\r\nexport function is$hide($i) {\r\n\tdo {\r\n\t\tif ($i === my.rootElement) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t$i = $i.parentNode;\r\n\t} while ($i !== null);\r\n\treturn true;\r\n}\r\nexport function isAnimationVisible(animate) {\r\n\treturn animate.viewedSrcId === 0 ? true : is$visible(my.env.$srcById.get(getSrcId(animate.local, animate.viewedSrcId)));\r\n/*\r\n\t}\r\n\tfor (const sId in animate.viewedSrcId) {\r\n\t\tif (!is$visibleBySrcId(sId)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;*/\r\n}\r\nconst $scroll = document.scrollingElement;\r\nexport function is$visible($e) {\r\n\twhile ($e.nodeType !== 1) {\r\n\t\t$e = $e.nextSibling;\r\n\t\tif ($e === null) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n//\tconst b = $e.getBoundingClientRect();\r\n//\tif (b.width === 0 && b.height === 0) {\r\n//\t\treturn false;\r\n//\t}\r\n\tconst visibleK = 1 - visibleScreenSize,\r\n\t\tleft = $scroll.clientWidth * visibleK,\r\n\t\tright = $scroll.clientWidth + left * -1,\r\n\t\ttop = $scroll.clientHeight * visibleK,\r\n\t\tbottom = $scroll.clientHeight + top * -1,\r\n\t\tb = $e.getBoundingClientRect();\r\n//console.log(`!((${b.top} > ${bottom} || ${b.top} + ${b.height} < ${top}) || (b.left > right || b.left + b.width < left))`);\r\n\treturn !((b.top > bottom || b.top + b.height < top) || (b.left > right || b.left + b.width < left));\r\n}\r\nexport function setAsOneIdx(src, str, idx) {\r\n\tif (src.asOneIdx === null) {\r\n\t\tsrc.asOneIdx = type_asOneIdx();\r\n\t}\r\n\tsrc.asOneIdx.set(str, idx);\r\n//!!\r\n\tif (my.debugLevel === 0) {\r\n\t\treturn;\r\n\t}\r\n\tconst $src = my.env.$srcById.get(src.id),\r\n\t\tn = asOneIdxName + str;\r\n\t$src.setAttribute(n, idx);\r\n//\tif ($src.nodeName === \"TEMPLATE\" && $src.getAttribute(hideName) !== null) {// && $src.content.firstChild !== null) {//при q_cloneNode мы клонируем не рекурсивно, а это значит что нет внутренностей - они появятся позже\r\n\tif (src.isHide && $src.content.firstChild !== null) {//todo!!!!! тут проблема в цустановке атрибута из-за алгоритма q_clone - он не клонирует рекурсивно - todo после можно переделать алгоритм\r\n\t\t$src.content.firstChild.setAttribute(n, idx);\r\n\t}\r\n}\r\nexport function getIdx(src, str) {\r\n\tif (src.idx !== null) {\r\n\t\treturn src.idx.get(str);\r\n\t}\r\n}\r\nexport function setIdx(src, str, idx) {\r\n\tif (src.idx === null) {\r\n\t\tsrc.idx = type_idx();\r\n\t}\r\n\tsrc.idx.set(str, idx);\r\n//!!\r\n\tif (my.debugLevel === 0) {\r\n\t\treturn;\r\n\t}\r\n\tconst $src = my.env.$srcById.get(src.id),\r\n\t\tn = idxName + str;\r\n\t$src.setAttribute(n, idx);\r\n//\tif ($src.nodeName === \"TEMPLATE\" && $src.getAttribute(hideName) !== null) {\r\n\tif (src.isHide) {\r\n\t\t$src.content.firstChild.setAttribute(n, idx);\r\n\t}\r\n}\r\nexport function getTopUrl(src, str) {\r\n\tif (str !== \"\") {\r\n\t\tconst topUrl = getAttrTopUrl(src, str);//из-за if ($i[p_topUrl]) { - так как это должэно работать только для робителей\r\n\t\tif (topUrl !== \"\") {\r\n\t\t\treturn topUrl;\r\n\t\t}\r\n\t}\r\n\tconst srcBy$src = my.env.srcBy$src;\r\n\tfor (let $i = my.env.$srcById.get(src.id).parentNode; $i !== my.rootElement; $i = $i.parentNode) {\r\n/*--\r\n\t\tif ($i.nodeType === 11) {//рендер внутри фрагмента возможен, например, for\r\n//console.log(\"getTopUrl\", $src, str);\r\n\t\t\treturn getTopUrl(my.env.$srcById.get(descrById.get(srcBy$src.get($e).descrId).sId)]);\r\n\t\t}*/\r\n\t\tconst topUrl = getAttrTopUrl(srcBy$src.get($i));\r\n\t\tif (topUrl !== \"\") {\r\n\t\t\treturn topUrl;\r\n\t\t}\r\n\t\tif ($i[p_topUrl] !== undefined) {\r\n\t\t\treturn $i[p_topUrl];\r\n\t\t}\r\n\t}\r\n\treturn \"\";\r\n}\r\nfunction getAttrTopUrl(src, str) {\r\n\tif (!src.isCmd) {\r\n\t\treturn \"\";\r\n\t}\r\n\tconst nattr = src.descr.attr.keys();\r\n\tlet topUrl = \"\";\r\n\tif (str !== \"\") {\r\n\t\tfor (const n of nattr) {\r\n\t\t\tif (n === str) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (my.env.reqCmd.get(n).cmdName === incCmdName) {//!!maybe todo пока работает только для inc\r\n\t\t\t\ttopUrl = getIdx(src, n);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn topUrl;\r\n\t}\r\n\tfor (const n of nattr) {\r\n\t\tif (my.env.reqCmd.get(n).cmdName === incCmdName) {//!!maybe todo пока работает только для inc\r\n\t\t\ttopUrl = getIdx(src, n);\r\n\t\t}\r\n\t}\r\n\treturn topUrl;\r\n}\r\n","//import {type_cacheValue} from \"../cache/type.js\";\nimport {p_target} from \"../config/config.js\";\n\nexport function oset(t, n, v) {\n\tconst o = t[n];\n\tif (typeof o !== \"object\" || o === null || typeof v !== \"object\" || v === null) {\n//\t\treturn Reflect.set(t, n, v);\n\t\tt[n] = v;\n\t\treturn true;\n\t}\n\tif (Array.isArray(o)) {\n\t\treturn osetArray(t, n, v);\n\t}\n\tif (o instanceof Set) {\n\t\treturn osetSet(t, n, v);\n\t}\n\tif (o instanceof Map) {\n\t\treturn osetMap(t, n, v);\n\t}\n\treturn osetObject(t, n, v);\n}\nfunction osetArray(t, n, v) {\n\tif (!Array.isArray(v)) {\n//\t\treturn Reflect.set(t, n, v);\n\t\tt[n] = v;\n\t\treturn true;\n\t}\n\tconst o = t[n],\n\t\toLen = o.length,\n\t\tvLen = v.length;\n\tfor (let i = 0; i < oLen && i < vLen; i++) {\n\t\toset(o, i, v[i]);\n\t}\n\tconst l = oLen - vLen;\n\tif (l > 0) {\n\t\to.splice(vLen, l);\n\t\treturn true;\n\t}\n\tfor (let i = oLen; i < vLen; i++) {\n\t\to.push(v[i]);\n\t}\n\treturn true;\n}\nfunction osetObject(t, n, v) {\n\tif (typeof v !== \"object\" || v === null) {\n//\t\treturn Reflect.set(t, n, v);\n\t\tt[n] = v;\n\t\treturn true;\n\t}\n\tconst o = t[n];\n\tfor (const i in o) {\n\t\tif (!(i in v)) {\n\t\t\tdelete o[i];\n\t\t}\n\t}\n\tfor (const i in v) {\n\t\toset(o, i, v[i]);\n\t}\n\treturn true;\n}\nfunction osetSet(t, n, v) {\n\tconst o = t[n];\n\tif (v instanceof Set) {\n\t\tfor (const i of o) {\n\t\t\tif (!v.has(i)) {\n\t\t\t\to.delete(i);\n\t\t\t}\n\t\t}\n\t\tfor (const i of v) {\n//\t\t\tif (!o.has(i)) {\n\t\t\t\to.add(i);\n//\t\t\t}\n\t\t}\n\t}\n\to.clear();\n\treturn Reflect.set(t, n, v);\n}\nfunction osetMap(t, n, v) {\n\tconst o = t[n];\n\tif (v instanceof Map) {\n\t\tfor (const [key, i] of o) {\n\t\t\tif (!v.has(key)) {\n\t\t\t\to.delete(key);\n\t\t\t}\n\t\t}\n\t\tfor (const [key, i] of v) {\n\t\t\tconst iVal = o.get(key);\n\t\t\tif (typeof iVal === \"object\") {\n\t\t\t\tif (Array.isArray(iVal)) {\n\t\t\t\t\tiVal.splice(0, iVal.length);\n\t\t\t\t} else if (iVal instanceof Set || iVal instanceof Map) {\n\t\t\t\t\tiVal.clear();\n\t\t\t\t} else if (iVal !== null) {\n\t\t\t\t\tfor (const j of iVal) {\n\t\t\t\t\t\tdelete iVal[j];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\to.set(key, i);\n\t\t}\n\t}\n\to.clear();\n\treturn Reflect.set(t, n, v);\n}\nexport function del(obj, prop) {\n\tconst val = obj[prop];\n\tdelete obj[prop];\n\treturn val;\n}\nexport function ocopy(val) {\n//\tif (typeof val !== \"object\" || val === null) {\n//\t\treturn val;\n//\t}\n\tconst cpy = {};\n\tfor (const i in val) {\n\t\tcpy[i] = val[i];\n\t}\n\treturn cpy;\n}\nexport function srcSetScope(src, scope) {\n\tconst srcScope = src.scopeCache,\n\t\tsrcScopeT = srcScope[p_target],\n\t\tscopeT = scope[p_target],\n\t\ts = scopeT !== undefined ? scopeT : scope;\n\tfor (const i in s) {\n\t\tsrcScopeT[i] = s[i];\n\t}\n\treturn srcScope;\n}\n/*\nexport function copy(val) {\n\tif (Array.isArray(val)) {\n\t\treturn val.slice();\n\t}\n\tif (typeof val !== \"object\" || val === null) {\n\t\treturn val;\n\t}\n\tif (val instanceof Map) {\n\t\treturn new Map(val);\n\t}\n\tif (val instanceof Set) {\n\t\treturn new Set(val);\n\t}\n\tconst c = {};\n\tfor (const key in val) {\n\t\tc[key] = copy(val[key]);\n\t}\n\treturn c;\n}*/\n","import {lazyRenderName, mountEventName, renderEventName, defEventInit,\r\n\tp_target, cmdArgsDiv, cmdArgsDivLen} from \"../config/config.js\";\r\nimport {getAttrAfter} from \"../descr/descr.js\";\r\nimport {srcSetScope} from \"../oset/oset.js\";\r\nimport {addScrollAnimationsEvent} from \"./algo.js\";\r\nimport {type_req, type_q_renderCtx, type_isLast, type_q_arr, type_localCounter, type_renderRes} from \"./type.js\";\r\n\r\nexport function renderTag($src, scope, str, sync) {\r\n\tif (sync.stat !== 0) {\r\n//console.log(\"isCancel\", sync.stat, 1);\r\n\t\treturn $src;\r\n\t}\r\n//console.error(\"render\", sync.syncId, $src, my.env.srcBy$src.get($src).id, my.env.srcBy$src.get($src).descrId, scope, str);\r\n//alert(1)\r\n\tconst src = my.env.srcBy$src.get($src),\r\n\t\tsId = src.id;\r\n\tif (!sync.local.has(sId)) {\r\n\t\tsync.local.set(sId, type_localCounter());\r\n\t}\r\n\t//todo со скопом есть проблема: если первый тег уже отрендереной динамической вставки добавляет в скоп что-то своё, то после смены значения - этот скоп будет раскопирован на все новые элементы\r\n\tscope = scope === null ? src.scopeCache : srcSetScope(src, scope);\r\n//\tif (scope !== null) {\r\n//\t\tscope = srcSetScope(src, scope);\r\n//\t}\r\n\tconst attr = str === \"\" ? src.descr.attr : getAttrAfter(src.descr.attr, str);\r\n\tif (attr === null || attr.size === 0) {\r\n\t\treturn renderChildren($src, scope, sync, sId, $src);\r\n\t}\r\n\treturn attrRender($src, scope, attr, sync)\r\n\t\t.then(res => {\r\n\t\t\tif (sync.stat !== 0) {\r\n\t\t\t\treturn $src;\r\n\t\t\t}\r\n\t\t\tif ($src !== res.$src) {\r\n\t\t\t\t$src = res.$src;\r\n\t\t\t}\r\n\t\t\tconst $ret = res.$last === null ? $src : res.$last;\r\n\t\t\tif (res.isLast) {// || sync.stat !== 0) {\r\n\t\t\t\treturn $ret;\r\n\t\t\t}\r\n//todo если мы дошли до сюда - то тег изменился а дети остались теми же - этого не должно быть - должны были ути по isLast\r\n//\t\t\tif (sync.stat !== 0) {//my.env.srcBy$src.get($src)?.id !== sId) {\r\n//\t\t\t\tconsole.warn(sync.stat, \"todo если мы дошли до сюда - то тег изменился а дети остались теми же - этого не должно быть - должны были ути по isLast\");\r\n//\t\t\t\treturn null;\r\n//\t\t\t}\r\n\t\t\treturn renderChildren($src, scope, sync, sId, $ret);\r\n\t\t});\r\n}\r\nasync function attrRender($src, scope, attr, sync) {\r\n\tlet $last = null;\r\n\tfor (const [n, v] of attr) {\r\n\t\tconst req = type_req($src, n, v, scope, sync),\r\n\t\t\tres = await req.reqCmd.cmd.render(req);\r\n\t\tif (sync.stat !== 0) {\r\n//console.log(\"isCancel attrRender\", sync.stat, n, v);\r\n\t\t\treturn res || type_renderRes(false, $src, $last);// type_renderRes(res.isLast, res.$src || $src, res.$last || $last);\r\n\t\t}\r\n\t\tif (!res) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (res.attrStr !== \"\") {\r\n//todo res.$attr в этой схеме линий - хватит .$src\r\n//\t\t\tconst $attr = res.$attr,// || res.$src || $src,\r\n//\t\t\t\t$ret = res.$last || res.$src || $attr || $src;//поидеи глупо не возвращать $last, так как attr бы не имела смысла\r\n////\t\t\t\t$ret = res.$last || res.$src || res.$attr || $src;//поидеи глупо не возвращать $last, так как attr бы не имела смысла\r\n\t\t\t$src = await renderTag(res.$attr, scope, res.attrStr, sync);\r\n\t\t\tres.isLast = true;\r\n\t\t\tres.$src = res.$last;\r\n//\t\t\tres.$src = res.$attr === $ret ? $src : $ret;\r\n\t\t\tres.$last = null;\r\n\t\t\tres.$attr = null;\r\n\t\t\tres.attrStr = \"\";\r\n\t\t\treturn res;\r\n\t\t}\r\n\t\tif (res.isLast) {\r\n//\t\t\treturn res;\r\n\t\t\treturn type_renderRes(true, res.$src || $src, res.$last);\r\n\t\t}\r\n\t\tif (res.$last !== null) {\r\n\t\t\t$last = res.$last;\r\n\t\t}\r\n\t\tif (res.$src !== null) {\r\n\t\t\t$src = res.$src;\r\n\t\t}\r\n\t}\r\n\treturn type_renderRes(false, $src, $last);\r\n}\r\nasync function renderChildren($i, scope, sync, sId, $ret) {\r\n\tconst srcBy$src = my.env.srcBy$src;\r\n\tif (sync.stat !== 0 || srcBy$src.get($i).descr.isCustomHtml) {\r\n\t\treturn $i;\r\n\t}\r\n\tif (!sync.renderParam.isLazyRender && $i.getAttribute(lazyRenderName) !== null) {\r\n\t\tsync.renderParam.isLazyRender = true;\r\n\t\t//todo\r\n\t\taddScrollAnimationsEvent($i);\r\n\t}\r\n\tfor ($i = $i.firstChild; $i !== null; $i = $i.nextSibling) {\r\n//\t\tif ($i.nodeType === 1 && \r\n\t\tconst iSrc = srcBy$src.get($i);\r\n\t\tif (iSrc === undefined) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\t$i = await renderTag($i, scope, \"\", sync);\r\n\t\tif (sync.stat !== 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n//\tif (sync.stat === 0) {\r\n\t\ttestLocalEventsBySrcId(sync.local, sId);\r\n//\t}\r\n\treturn $ret;\r\n}\r\nexport function q_renderTag(arr, str, isLast, sync) {\r\n//console.log(\"q_render\", arr.map(i => [i.$src, i.scope]), str);\r\n//alert(1);\r\n\tif (sync.stat !== 0) {\r\n//\t\treturn arr;\r\n\t\treturn Promise.resolve(arr);\r\n\t}\r\n\tconst arrLen = arr.length,\r\n\t\tsrcBy$src = my.env.srcBy$src;\r\n//--\tlocal = new Map(local);\r\n//\tfor (let i = arrLen - 1; i > -1; i--) {\r\n\tfor (let i = 0; i < arrLen; i++) {\r\n\t\tconst aI = arr[i],\r\n\t\t\t$i = aI.$src,\r\n\t\t\tiSrc = srcBy$src.get($i),\r\n\t\t\tiId = iSrc.id;\r\n\t\tif (!sync.local.has(iId)) {\r\n\t\t\tsync.local.set(iId, type_localCounter());\r\n//!!см выше\t\t$i.dispatchEvent(new CustomEvent(renderStartEventName, defEventInit));\r\n//console.log(\"q_rend - local create\", $i);\r\n\t\t}\r\n\t\taI.scope = aI.scope === null ? iSrc.scopeCache : srcSetScope(iSrc, aI.scope);\r\n//\t\tif (aI.scope !== null) {//todo условия можно оптимизировать\r\n//\t\t\taI.scope = srcSetScope(iSrc, aI.scope);\r\n//\t\t}\r\n\t}\r\n\tconst src = srcBy$src.get(arr[0].$src),\r\n\t\tattr = str === \"\" ? src.descr.attr : getAttrAfter(src.descr.attr, str);\r\n\tif (attr !== null && attr.size !== 0) {\r\n\t\treturn q_attrRender(arr, attr, isLast, type_q_renderCtx(), sync)\r\n\t\t\t.then(lastCount => lastCount === arrLen ? arr : _q_renderTag(arr, isLast, sync, arrLen));\r\n\t}\r\n\treturn _q_renderTag(arr, isLast, sync);\r\n}\r\nfunction _q_renderTag(arr, isLast, sync, arrLen) {\r\n\treturn q_renderChildren(arr, isLast, sync)\r\n\t\t.then(() => {\r\n\t\t\tconst srcBy$src = my.env.srcBy$src;\r\n\t\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\t\ttestLocalEventsBySrcId(sync.local, srcBy$src.get(arr[i].$src).id);\r\n\t\t\t}\r\n\t\t\treturn arr;\r\n\t\t});\r\n}\r\nasync function q_attrRender(arr, attr, isLast, ctx, sync) {\r\n\tconst arrLen = arr.length;\r\n\tfor (const [n, v] of attr) {\r\n\t\tconst res = await q_execRender(arr, n, v, isLast, sync);\r\n\t\tif (sync.stat !== 0) {\r\n//console.log(\"isCancel\", sync.stat, n, v, 2);\r\n\t\t\treturn ctx.lastCount;\r\n\t\t}\r\n\t\tif (!res) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\tif (isLast.has(i)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tconst resI = await res[i];\r\n//\t\t\tif (!resI) {\r\n\t\t\tif (resI === null) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (resI.attrStr !== \"\") {\r\n\t\t\t\tconst arrI = arr[i];\r\n//\t\t\t\tq_addAfterAttr(resI.$attr || resI.$src || arrI.$src, arrI.scope, resI.attrStr, ctx);\r\n\t\t\t\tq_addAfterAttr(resI.$attr, arrI.scope, resI.attrStr, ctx);\r\n\t\t\t\tarrI.$src = resI.$last || resI.$src || resI.$attr || arrI.$src;\r\n\t\t\t\tisLast.add(i);\r\n\t\t\t\tctx.lastCount++;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (resI.$last !== null) {\r\n\t\t\t\tarr[i].$src = resI.$last;\r\n\t\t\t}\r\n\t\t\tif (resI.isLast) {\r\n\t\t\t\tisLast.add(i);\r\n\t\t\t\tctx.lastCount++;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n//todo\r\n//\tconst pArr = [];\r\n\tfor (const byAttr of ctx.afterByDescrByAttr.values()) {\r\n\t\tfor (const [attrKey, arr] of byAttr) {\r\n//\t\t\tpArr.push(q_renderTag(arr, ctx.strByAttrKey[attrKey], type_isLast(), sync));\r\n\t\t\tawait q_renderTag(arr, ctx.strByAttrKey.get(attrKey), type_isLast(), sync);\r\n\t\t}\r\n\t}\r\n//\tif (pArr.length) {\r\n//\t\tawait Promise.all(pArr);\r\n//\t}\r\n\treturn ctx.lastCount;\r\n}\r\n//todo\r\nfunction q_addAfterAttr($src, scope, str, ctx) {\r\n\tconst attrKey = getAttrKey(getAttrAfter(my.env.srcBy$src.get($src).descr.attr, str)),\r\n\t\tdId = my.env.srcBy$src.get($src).descr.id,\r\n\t\tbyD = ctx.afterByDescrByAttr.get(dId),\r\n\t\tarrI = type_q_arr($src, scope);\r\n\tif (!ctx.strByAttrKey.has(attrKey)) {\r\n\t\tctx.strByAttrKey.set(attrKey, str);\r\n\t}\r\n\tif (byD !== undefined) {\r\n\t\tconst arr = byD.get(attrKey);\r\n\t\tif (arr) {\r\n\t\t\tarr.push(arrI);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tbyD.set(attrKey, [arrI]);\r\n\t\treturn;\r\n\t}\r\n\tctx.afterByDescrByAttr.set(dId, new Map([[attrKey, [arrI]]]));\r\n}\r\nfunction q_renderChildren(arr, isLast, sync) {\r\n\tconst $first = arr[0].$src;\r\n\tif (sync.stat !== 0 || my.env.srcBy$src.get($first).descr.isCustomHtml) {\r\n//console.log(78979, sync.stat, $first);\r\n\t\treturn Promise.resolve(arr);\r\n\t}\r\n\tif (!sync.renderParam.isLazyRender && $first.getAttribute(lazyRenderName) !== null) {\r\n\t\tsync.renderParam.isLazyRender = true;\r\n\t}\r\n\tconst iArr = [],\r\n\t\tarrLen = arr.length,\r\n\t\tisLazyRender = sync.renderParam.isLazyRender;\r\n\tfor (let i = 0; i < arrLen; i++) {\r\n//\t\tif (!isLast[i] && arr[i].$src.nodeType === 1) {//?? бывает ли в арр не элемент? - проверил, может. --- бывает <!-inc_end\r\n\t\tif (isLast.has(i)) {//?? бывает ли в арр не элемент? - проверил, может. --- бывает <!-inc_end ---- Должен быть ЛАСТ\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst aI = arr[i];\r\n\t\tiArr.push(type_q_arr(aI.$src, aI.scope));\r\n\t\tif (isLazyRender) {\r\n\t\t\t//todo\r\n\t\t\taddScrollAnimationsEvent(aI.$src);\r\n\t\t}\r\n\t}\r\n\tif (iArr.length === 0) {\r\n\t\treturn arr;\r\n\t}\r\n\treturn q_renderFlow(iArr, true, sync)\r\n\t\t.then(() => arr);\r\n}\r\nfunction q_renderFlow(arr, isFirst, sync) {\r\n\tconst byDescr = q_nextGroupByDescr(arr, isFirst);\r\n//\tif (byDescr.size === 0) {\r\n//\t\treturn;\r\n//\t}\r\n//todo\t\r\n\tconst pSet = new Set();\r\n\tfor (const dArr of byDescr.values()) {\r\n//\t\tconst $i = dArr[0].$src,\r\n//\t\t\tiSrc = my.env.srcBy$src.get($i);\r\n//\t\tpSet.add(q_renderTag(dArr, iSrc !== undefined ? iSrc.descr.attr : null, type_isLast(), sync)\r\n\t\tpSet.add(q_renderTag(dArr, \"\", type_isLast(), sync)\r\n\t\t\t.then(() => sync.stat === 0 && q_renderFlow(dArr, false, sync)));\r\n//0922\r\n//\t\tawait q_renderTag(dArr, $i[p_isCmd] && my.env.descrById.get($i[p_descrId]).attr || null, type_isLast(), sync)\r\n//\t\t\t.then(() => sync.stat === 0 && q_renderFlow(dArr, false, sync));\r\n\r\n\r\n/*\r\n//\t\tif ($i.nodeType === 1) {\r\n//!!!как бы так сделать, что бы не идти дальше если рендер говорит что не нужно\r\n\t\t\tpSet.add(q_renderTag(dArr, $i[p_isCmd] && my.env.descrById.get($i[p_descrId]).attr || null, type_isLast(), sync)\r\n\t\t\t\t.then(() => sync.stat === 0 && q_renderFlow(dArr, false, sync)\r\n//console.log(\"isCancel\", sync.stat, 222);\r\n\t\t\t\t));\r\n//\t\t}*/\r\n\t}\r\n\treturn Promise.all(pSet);\r\n}\r\nfunction q_nextGroupByDescr(arr, isFirst) {\r\n\tconst byDescr = new Map(),\r\n\t\tarrLen = arr.length,\r\n\t\tsrcBy$src = my.env.srcBy$src;\r\n\tfor (let i = 0; i < arrLen; i++) {\r\n\t\tif (arr[i].$src.nodeType !== 1) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tfor (let $i = isFirst ? arr[i].$src.firstChild : arr[i].$src.nextSibling; $i !== null; $i = $i.nextSibling) {\r\n\t\t\tconst iSrc = srcBy$src.get($i);\r\n\t\t\tif (iSrc === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tarr[i].$src = $i;\r\n\t\t\tconst dId = iSrc.descr.id,\r\n\t\t\t\tbyD = byDescr.get(dId);\r\n\t\t\tif (byD !== undefined) {\r\n\t\t\t\tbyD.push(arr[i]);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tbyDescr.set(dId, [arr[i]]);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn byDescr;\r\n}\r\nfunction q_execRender(arr, str, expr, isLast, sync) {\r\n\tconst req = type_req(arr[0].$src, str, expr, null, sync);\r\n\tif (req.reqCmd.cmd.q_render !== null) {\r\n\t\treturn req.reqCmd.cmd.q_render(req, arr, isLast);\r\n\t}\r\n/*\r\n\tif (req.reqCmd.cmd.render === null) {\r\n\t\treturn null;\r\n\t}*/\r\n\tconst arrLen = arr.length,\r\n\t\tres = new Array(arrLen);\r\n\tfor (let i = 0; i < arrLen; i++) {\r\n\t\tif (!isLast.has(i)) {\r\n//\t\t\tres[i] = await req.reqCmd.cmd.render(type_req(arr[i].$src, str, expr, arr[i].scope, sync));\r\n\t\t\tres[i] = req.reqCmd.cmd.render(type_req(arr[i].$src, str, expr, arr[i].scope, sync));\r\n\t\t}\r\n\t}\r\n//\treturn res;\r\n\treturn Promise.all(res);\r\n}\r\nfunction getAttrKey(attr) {\r\n\tlet key = \"\";\r\n\tfor (const [n, v] of attr) {\r\n\t\tkey += n + \":\" + v + \";\";\r\n\t}\r\n\treturn key;\r\n}\r\nexport function dispatchLocalEvents(local) {\r\n\tfor (const [sId, l] of local) {\r\n\t\tif (l.animationsCount === 0) {\r\n\t\t\tdispatchLocalEventsBySrcId(sId, l);\r\n\t\t}\r\n\t}\r\n}\r\nfunction testLocalEventsBySrcId(local, sId) {\r\n\tconst l = local.get(sId);\r\n\tif (l.animationsCount === 0) {\r\n\t\tdispatchLocalEventsBySrcId(sId, l);\r\n\t}\r\n}\r\nfunction dispatchLocalEventsBySrcId(sId, l) {\r\n\tconst $src = my.env.$srcById.get(sId);\r\n\tif ($src === undefined) {\r\n\t\treturn;\r\n\t}\r\n\tl.animationsCount = -1;\r\n\t//на тимплэйт события не придут и так\r\n\tif ($src.nodeName === \"TEMPLATE\") {\r\n\t\treturn;\r\n\t}\r\n//console.log(\"a-render\");//, $src);\r\n//console.log(\"a-render\", $src);\r\n\tconst src = my.env.srcById.get(sId);\r\n\tif (!src.isMounted) {\r\n\t\tsrc.isMounted = true;\r\n\t\t$src.dispatchEvent(new CustomEvent(mountEventName, defEventInit));\r\n\t}\r\n\t$src.dispatchEvent(new CustomEvent(renderEventName, defEventInit));\r\n}\r\n","//todo удалить когда наступит момент\r\nif (!self.requestIdleCallback) {\r\n\tself.requestIdleCallback = function(f) {\r\n\t\tconst startTime = Date.now();\r\n\t\treturn setTimeout(() => {\r\n\t\t\tf({\r\n\t\t\t\tdidTimeout: false,\r\n\t\t\t\ttimeRemaining() {\r\n\t\t\t\t\treturn Math.max(0, 50.0 - (Date.now() - startTime));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}, 1);\r\n\t}\r\n\tself.cancelIdleCallback = function(id) {\r\n\t}\r\n}\r\n/*\r\nif (!FormData.prototype.toJSON) {\r\n\tFormData.prototype.toJSON = function() {\r\n\t\tconst obj = {};\r\n\t\tfor (const [name, value] of this.entries()) {\r\n\t\t\tobj[name] = value;\r\n\t\t}\r\n\t\treturn obj;\r\n\t}\r\n//\thideEnum(FormData.prototype, \"toJSON\");\r\n}\r\nif (!HTMLFormElement.prototype.toJSON) {\r\n\tHTMLFormElement.prototype.toJSON = function() {\r\n\t\tconst obj = {},\r\n\t\t\telsLen = this.elements.length;\r\n\t\tfor (let i = 0; i < elsLen; i++) {\r\n\t\t\tconst n = this.elements[i].name || this.elements[i].id;\r\n\t\t\tif (n) {\r\n\t\t\t\tobj[n] = this.elements[i].value;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn obj;\r\n\t}\r\n//\thideEnum(HTMLFormElement.prototype, \"toJSON\");\r\n}\r\nfunction hideEnum(obj, pName) {\r\n\tObject.defineProperty(obj, pName, {\r\n\t\tenumerable: false\r\n\t});\r\n}*/\r\n","import {type_req} from \"../render/type.js\";\r\nimport {getCacheSrcId} from \"../cache/cache.js\";\r\nimport {cmdPref} from \"../config/config.js\";\r\nimport {getErr} from \"../err/err.js\";\r\nimport {setCur$src, proxyStat} from \"../proxy/proxy.js\";\r\n\r\nconst func = Object.getPrototypeOf(async function(){}).constructor;\r\n\r\nexport function eval2(req, $src, isReactive) {\r\n\t//1) isReactive ложь только в _getVal(): _fetch data-_ok, _on\r\n\t//2) $src не равно req.$src только в случаи с loading - сейчас там это исправленено - но только там есть смысл\r\n\tconst cacheSrcId = getCacheSrcId(req.$src, req.str),\r\n\t\tc = my.env.srcById.get(cacheSrcId).cache;\r\n//todo c !== null - почему может быть так что кэша нет?\r\nif (c === null) {\r\n\tconsole.warn(111);\r\n\talert(1);\r\n}\r\n\r\n//\tif (c !== null && req.str in c.value) {\r\n\tif (c.value.has(req.str)) {\r\n//console.log(7777, req.str, req.expr, req.$src, c.value);\r\n\t\treturn c.value.get(req.str);\r\n\t}\r\n\tconst func = getEval2Func(req, req.expr);\r\n\tproxyStat.value = 0;\r\n\tif (isReactive) {\r\n\t\tsetCur$src($src);\r\n\t\tconst val = func\r\n\t\t\t.apply($src, [req, req.scope])\r\n\t\t\t.catch(err => {\r\n\t\t\t\tthrow getErr(err, req.$src, req);\r\n\t\t\t});\r\n\t\tif (proxyStat.value !== 0) {\r\n//--\t\t\tsetCacheValue(cacheSrcId, req.str, val);\r\n\t\t\tc.value.set(req.str, val);\r\n//\t\t\tproxyStat.value = 0;\r\n\t\t}\r\n\t\tsetCur$src(null);\r\n\t\treturn val;\r\n\t}\r\n\tconst val = func\r\n\t\t.apply($src, [req, req.scope])\r\n\t\t.catch(err => {\r\n\t\t\tthrow getErr(err, req.$src, req);\r\n\t\t});\r\n\tif (proxyStat.value !== 0) {\r\n//--\t\tsetCacheValue(cacheSrcId, req.str, val);\r\n\t\tc.value.set(req.str, val);\r\n//\t\tproxyStat.value = 0;\r\n\t}\r\n\treturn val;\r\n}\r\nexport function q_eval2(req, arr, isLast) {\r\n\treturn q_getEval2Func(req, req.expr)\r\n\t\t.apply(null, [req, arr, isLast, req.str, setCur$src, proxyStat, my.env.srcBy$src])\r\n\t\t.then(vals => Promise.all(vals))\r\n\t\t.catch(err => {\r\n\t\t\tthrow getErr(err, req.$src, req);\r\n\t\t});\r\n}\r\n//const commentRe = /\\/\\/.+?(\\n|$)/g;\r\nexport function getEval2Func(req, expr) {\r\n\texpr = expr.trim();\r\n\tconst cacheKey = expr,\r\n\t\t_f = my.env._func.get(cacheKey);\r\n\tif (_f !== undefined) {\r\n\t\treturn _f;\r\n\t}\r\n\tif (expr === \"\") {\r\n\t\tconst ff = new func();\r\n\t\tmy.env._func.set(cacheKey, ff);\r\n\t\treturn ff;\r\n\t}\r\n//todo\r\n//\texpr = expr.replace(commentRe, \"\");\r\n\tif (isNeedRet(expr)) {\r\n\t\texpr = \"const _tpl_res = \" + expr + \";\\nreturn _tpl_res;\";\r\n\t}\r\n/*\r\n//todo if need change with\r\n\tconst fBody = `const _tpl_scopeNames = [];\r\nfor (const i in _tpl_scope) {\r\n\t_tpl_scopeNames.push(i);\r\n}\r\nconst _tpl_scopeNamesLen = _tpl_scopeNames.length;\r\n_tpl_scopeValues = new Array(_tpl_scopeNamesLen);\r\nfor (let i = 0; i < _tpl_scopeNamesLen; i++) {\r\n\t_tpl_scopeValues[i] = _tpl_scope[_tpl_scopeNames[i]];\r\n}\r\nreturn (function(Object.keys(_tpl_scope)) {${expr}\r\n}).apply(this, Object.values(_tpl_scope));`;\r\n\r\nor\r\n\r\n\tconst fBody = \"return (function(Object.keys(_tpl_scope)) {\" + expr + \"\\n}).apply(this, Object.values(_tpl_scope))\";\r\n*/\r\n\r\n\tconst fBody = \"with (_tpl_scope) {\" + expr + \"\\n}\";\r\n//console.log(fBody);\r\n\ttry {\r\n//console.log(fBody)\r\n\t\tconst ff = new func(\"req\", \"_tpl_scope\", fBody);\r\n\t\tmy.env._func.set(cacheKey, ff);\r\n\t\treturn ff;\r\n\t} catch (err) {\r\n\t\tthrow getErr(err, req.$src, req);\r\n\t}\r\n}\r\nexport function q_getEval2Func(req, expr) {\r\n\texpr = expr.trim();\r\n\tconst cacheKey = \"=q\" + expr,\r\n\t\t_f = my.env._func.get(cacheKey);\r\n\tif (_f !== undefined) {\r\n\t\treturn _f;\r\n\t}\r\n\tif (expr === \"\") {\r\n\t\tconst ff = new func();\r\n\t\tmy.env._func.set(cacheKey, ff);\r\n\t\treturn ff;\r\n\t}\r\n\tif (isNeedRet(expr)) {\r\n\t\texpr = \"const _tpl_res = \" + expr + \";\\nreturn _tpl_res;\";\r\n\t}\r\n\tconst fBody = `const _tpl_len = _tpl_arr.length,\r\n\t_tpl_val = new Array(_tpl_len);\r\nfor (let i = 0; i < _tpl_len; i++) {\r\n\tif (_tpl_isLast.has(i)) {\r\n\t\tcontinue;\r\n\t}\r\n\tconst $i = _tpl_arr[i].$src,\r\n\t\tsrc = _tpl_srcBy$src.get($i),\r\n\t\tc = src.cache;\r\n\tif (c.value.has(_tpl_str)) {\r\n\t\t_tpl_val[i] = c.value.get(_tpl_str);\r\n//console.log(7777, \"q\", _tpl_val[i]);\r\n\t\tcontinue;\r\n\t}\r\n\t_tpl_proxyStat.value = 0;\r\n\t_tpl_setCur$src($i);\r\n\tconst v = _tpl_val[i] = (function() {\r\n//todebug \r\n\t\tif (my.debugLevel !== 0) {\r\n\t\t\treq.scope = _tpl_arr[i].scope;\r\n\t\t}\r\n\t\twith (_tpl_arr[i].scope) {${expr}\r\n\t\t}\r\n\t}).apply($i);\r\n\tif (_tpl_proxyStat.value !== 0) {\r\n//--\t\t_tpl_setCacheValue(cacheSrcId, _tpl_str, v);\r\n\t\tc.value.set(_tpl_str, v);\r\n\t}\r\n}\r\n_tpl_setCur$src(null);\r\n//_tpl_proxyStat.value = 0;\r\nreturn _tpl_val;`;\r\n//console.log(fBody);\r\n\ttry {\r\n\t\tconst ff = new func(\"req\", \"_tpl_arr\", \"_tpl_isLast\", \"_tpl_str\", \"_tpl_setCur$src\", \"_tpl_proxyStat\", \"_tpl_srcBy$src\", fBody);//, \"_tpl_isReactive\"\r\n\t\tmy.env._func.set(cacheKey, ff); \r\n\t\treturn ff;\r\n\t} catch (err) {\r\n\t\tthrow getErr(err, req.$src, req);\r\n\t}\r\n}\r\nconst _e = [\"with\", \"var\", \"try\", \"catch\", \"switch\" , \"do\", \"while\", \"let\", \"const\", \"for\", \"if\", \"return\"];\r\nfunction isNeedRet(expr) {\r\n\tif (expr === \"\") {\r\n\t\treturn false;\r\n\t}\r\n\texpr = clearBlock(clearBlock(clearBlock(clearBlock(clearBlock(expr, \"'\", \"'\"), \"`\", \"`\"), \"\\\"\", \"\\\"\"), \"{\", \"}\"), \"(\", \")\");\r\n//console.log(expr)\r\n\tfor (let i = _e.length - 1; i > -1; i--) {\r\n\t\tconst j = expr.indexOf(_e[i]);\r\n\t\tif (j === -1) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n//\t\tswitch (expr.substr(j + _e[i].length, 1)) {\r\n\t\tswitch (expr[j + _e[i].length]) {\r\n\t\t\tcase \" \":\r\n\t\t\tcase \"(\":\r\n\t\t\tcase \"\\n\":\r\n\t\t\tcase \"\\t\":\r\n\t\t\tcase \"\\r\":\r\n//console.log(1, _e[i]);\r\n\t\t\t\treturn false;\r\n\t\t}\r\n//console.log(2, _e[i]);\r\n//\t\treturn true;\r\n\t}\r\n//console.log(3);\r\n\treturn true;\r\n}\r\nfunction clearBlock(str, begin, end) {\r\n\tfor (let i = str.indexOf(begin); i !== -1; i = str.indexOf(begin, i + 1)) {\r\n\t\tconst strLen = str.length;\r\n\t\tfor (let j = i + 1, count = 0; j < strLen; j++) {\r\n\t\t\tif (str[j] === \"\\\\\") {\r\n\t\t\t\tj++;\r\n\t\t\t}\r\n\t\t\tif (str[j] === end) {\r\n\t\t\t\tif (count === 0) {\r\n\t\t\t\t\tstr = str.substr(0, i + 1) + str.substr(j);\r\n\t\t\t\t\ti = j;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tcount--;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (str[j] === begin) {\r\n\t\t\t\tcount++;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn str;\r\n}\r\n//self.clearBlock = clearBlock;\r\n//self.isNeedRet = isNeedRet;\r\n/*--\r\n//todo-- attr and get$props\r\nexport function getVal($src, scope, name, isReactive) {\r\n//\tconst val = $src.dataset[name];\r\n//\tif (val !== undefined) {\r\n//\t\treturn val;\r\n//\t}\r\n////inline\treturn _getVal($src, scope, name, isReactive);\r\n\tconst str = cmdPref + name,\r\n\t\texpr = $src.dataset[str];\r\n\tif (expr) {\r\n\t\treturn eval2(type_req($src, str, expr, scope || srcBt$src.get($src).scopeCache, null), $src, isReactive);\r\n\t}\r\n}\r\nexport function _getVal($src, scope, name, isReactive) {\r\n\tconst str = cmdPref + name,\r\n\t\texpr = $src.dataset[str];\r\n\tif (expr) {\r\n\t\treturn eval2(type_req($src, str, expr, scope || my.env.srcBy$src.get($src).scopeCache, null), $src, isReactive);\r\n\t}\r\n}*/\r\n","import {get$first, getNextStr} from \"../descr/descr.js\";\r\n\r\nexport function getCacheSrcId($i, str) {\r\n//todo если _for1 _for2 - кэш будет браться для for2 c первого элемента\r\n\tconst srcBy$src = my.env.srcBy$src,\r\n\t\tsrc = srcBy$src.get($i);\r\n//todo\r\nif (src === undefined) {\r\n//Такое было с filling - так как запуск через таймер и что-то могло удалится. Нужно защетиться от всех подобных ситуаций.\r\n\tconsole.warn(\"2323\", $i, str);\r\n//debugger\r\n\treturn 0;\r\n}\r\n\tconst descr = src.descr;\r\n\tif (descr.asOnes === null || !descr.asOnes.has(str)) {\r\n\t\treturn src.id;\r\n\t}\t\r\n\tconst nStr = getNextStr(src, str);\r\n\t$i = get$first($i, descr.get$elsByStr, nStr);\r\n\tdo {\r\n\t\tconst iSrc = srcBy$src.get($i);\r\n\t\tif (iSrc !== undefined && iSrc.isCmd) {\r\n\t\t\treturn iSrc.id;\r\n\t\t}\r\n\t\t$i = $i.nextSibling;\r\n\t} while ($i !== null);\r\n//todo\r\n\tthrow new Error(\"getCacheSrcId\");\r\n}\r\n","import {defRequestInit} from \"../config/config.js\";\n\nexport function getRequest(val, topUrl) {\n\tif (typeof val === \"string\") {\n\t\treturn val !== \"\" ? new Request(getUrl(val, topUrl), defRequestInit) : null;\n\t}\n\treturn val instanceof Request || val instanceof Response ? val : null;\n}\nconst reHost = /^(\\w+\\:\\/\\/|\\/\\/)/,\n\treSlash = /\\/\\/+/,\n\treUp = /[^\\/]+\\/+\\.\\.\\//,\n\treThis = /\\/+\\.\\//;\nexport function getUrl(url, topUrl = location.pathname) {\n\tif (isUri(url)) {\n//\t\tif (topUrl !== undefined) {\n\t\t\tif (isUri(topUrl)) {\n\t\t\t\ttopUrl = normalizeUrl(topUrl);\n\t\t\t}\n\t\t\tlet u = normalizeUrl_get(url.trim());\n\t\t\twhile (u.indexOf(\".\") === 0) {\n\t\t\t\tif (u.indexOf(\"./\") === 0) {\n\t\t\t\t\tu = u.substr(2);\n\t\t\t\t} else if (u.indexOf(\"../\") === 0) {\n\t\t\t\t\tu = u.substr(3);\n\t\t\t\t}\n\t\t\t}\n\t\t\turl = topUrl.endsWith(u) ? topUrl : normalizeUrl(topUrl.substr(0, topUrl.lastIndexOf(\"/\") + 1) + url);\n//\t\t} else {\n//\t\t\turl = normalizeUrl(url);\n//\t\t}\n\t}\n\treturn url.search(reHost) === -1 ? location.origin + url : url;\n}\nfunction isUri(url) {\n\turl = url.trimLeft();\n\treturn url.search(reHost) !== 0 && url[0] !== \"/\";\n}\nfunction normalizeUrl(url) {\n\turl = url.trim();\n//\tif (url.search(reHost) === 0) {\n//\t\treturn new URL(url).href;\n//\t}\n//\tif (url[0] !== \"/\") {\n//\tif (url.search(reHost) !== 0 && url[0] !== \"/\") {\n\tif (isUri(url)) {\n\t\tconst lastSlashIdx = location.pathname.lastIndexOf(\"/\");\n\t\tif (lastSlashIdx === location.pathname.length - 1) {\n\t\t\turl = location.pathname + url;\n\t\t} else if (lastSlashIdx !== -1)  {\n\t\t\turl = location.pathname.substr(0, lastSlashIdx + 1) + url;\n\t\t}\n\t}\n\treturn normalizeUrl_get(url);\n}\nfunction normalizeUrl_get(url) {\n\tfor (let re = [reUp, reThis], i = re.length - 1; i > -1; i--) {\n\t\twhile (url.search(re[i]) !== -1) {\n\t\t\turl = url.replace(re[i], \"/\");\n\t\t}\n\t}\n\tif (url.search(reHost) === -1) {\n\t\treturn url.replace(reSlash, \"/\");\n\t}\n\tconst i = url.indexOf(\"//\");\n\treturn url.substr(0, i + 1) + url.substr(i + 1).replace(reSlash, \"/\");\n\t//.trim();\n}\n","import {renderTag} from \"../../render/render.js\";\r\nimport {type_req, type_localCounter, type_animation, type_renderRes} from \"../../render/type.js\";\r\nimport {p_target, cmdPref, cmdArgsDiv, cmdArgsDivLen, incCmdName, fetchCmdName, foreachCmdName, elseCmdName, defaultCmdName, onCmdName, isFillingName, isFillingDiv, asOneIdxName, idxName, defRequestInit} from \"../../config/config.js\";\r\nimport {type_asOneIdx, type_idx, type_save, type_saveI} from \"../../descr/type.js\";\r\nimport {getAttrItAfter, get$els} from \"../../descr/descr.js\";\r\nimport {type_cloneNodeOn} from \"../../dom/type.js\";\r\nimport {preRender, joinText, removeChild/*--, cloneNode*/, getIdx, setIdx, getTopUrl} from \"../../dom/dom.js\";\r\nimport {getErr} from \"../../err/err.js\";\r\nimport {eval2, q_eval2} from \"../../eval2/eval2.js\";\r\nimport {loadingCount, showLoading} from \"../../loading/loading.js\";\r\nimport {ocopy} from \"../../oset/oset.js\";\r\nimport {getRequest, getUrl} from \"../../url/url.js\";\r\nimport {type_cmd} from \"../type.js\";\r\nimport {setReqCmd} from \"../cmd.js\";\r\n\r\nconst waitingStack = new Map();\r\nexport const incCache = new Map();\r\nconst incScriptCache = new Map();\r\n\r\nexport default type_cmd(cmd_render, cmd_q_render, cmd_get$first, cmd_get$els, false, false);\r\n\r\nfunction cmd_render(req) {\r\n\treturn eval2(req, req.$src, true)\r\n\t\t.then(val => inc_render(req, val));\r\n//\t\t.then(val => getIncude(req, val))\r\n//\t\t.then(include => inc_render(req, include));\r\n}\r\nfunction cmd_q_render(req, arr, isLast) {\r\n\treturn q_eval2(req, arr, isLast)\r\n\t\t.then(vals => {\r\n\t\t\tconst arrLen = arr.length,\r\n\t\t\t\tres = new Array(arrLen);\r\n\t\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\t\tres[i] = inc_render(type_req(arr[i].$src, req.str, req.expr, arr[i].scope, req.sync), vals[i]);\r\n//\t\t\t\t\tres[i] = getIncude(req, vals[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn res;\r\n/*\r\n\t\t\treturn Promise.all(res)\r\n\t\t\t\t.then(includes => {\r\n\t\t\t\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\t\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\t\t\t\tres[i] = inc_render(type_req(arr[i].$src, req.str, req.expr, arr[i].scope, req.sync), includes[i]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t});*/\r\n\t\t});\r\n}\r\nfunction cmd_get$first($src, str, expr, pos) {\r\n\treturn inc_get$first($src, str, expr, pos);\r\n}\r\nfunction cmd_get$els($src, str, expr, pos) {\r\n//console.log(\"inc get$els\", $src, str, expr)\r\n\treturn inc_get$els($src, str, expr, pos);\r\n}\r\n/*\r\nexport default {\r\n\tget$els($src, str, expr, pos) {\r\n//console.log(\"inc get$els\", $src, str, expr)\r\n\t\treturn inc_get$els($src, str, expr, pos);\r\n\t},\r\n\tget$first($src, str, expr, pos) {\r\n\t\treturn inc_get$first($src, str, expr, pos);\r\n\t},\r\n\trender(req) {\r\n\t\treturn eval2(req, req.$src, true)\r\n\t\t\t.then(val => inc_render(req, val));\r\n//\t\t\t.then(val => getIncude(req, val))\r\n//\t\t\t.then(include => inc_render(req, include));\r\n\t},\r\n\tq_render(req, arr, isLast) {\r\n\t\treturn q_eval2(req, arr, isLast)\r\n\t\t\t.then(vals => {\r\n\t\t\t\tconst arrLen = arr.length,\r\n\t\t\t\t\tres = new Array(arrLen);\r\n\t\t\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\t\t\tres[i] = inc_render(type_req(arr[i].$src, req.str, req.expr, arr[i].scope, req.sync), vals[i]);\r\n//\t\t\t\t\t\tres[i] = getIncude(req, vals[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn res;\r\n*/\r\n/*\r\n\t\t\t\treturn Promise.all(res)\r\n\t\t\t\t\t.then(includes => {\r\n\t\t\t\t\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\t\t\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\t\t\t\t\tres[i] = inc_render(type_req(arr[i].$src, req.str, req.expr, arr[i].scope, req.sync), includes[i]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn res;\r\n\t\t\t\t\t});*/\r\n/*\r\n\t\t\t});\r\n\t}\r\n};*/\r\nfunction inc_render(req, val) {\r\n//console.info(\"inc\", req);\r\n\tconst include = getIncude(req, val);\r\n\tif (include === null) {\r\n\t\treturn type_renderRes(true);\r\n\t}\r\n\tconst pos = -1,\r\n\t\t$els = inc_get$els(req.$src, req.str, req.expr, pos),\r\n\t\t$elsLen = $els.length,\r\n\t\toldVal = getIdx(my.env.srcBy$src.get(req.$src), req.str);\r\n//todo\r\n\tfor (let i = 0; i < $elsLen; i++) {\r\n\t\tconst iSrc = my.env.srcBy$src.get($els[i]);\r\n\t\tif (iSrc !== undefined && !req.sync.local.has(iSrc.id)) {\r\n\t\t\treq.sync.local.set(iSrc.id, type_localCounter());\r\n\t\t}\r\n\t}\r\n//console.log(111, req, $els, oldVal, my.env.srcBy$src.get(req.$src), include);\r\n//alert(1);\r\n\t//если выражение вернуло Request или Response, то такой запрос будет всегда запрашиваться\r\n//todo если объект тогда новый\r\n\tif ($elsLen !== 1 && oldVal === include.key) {//уже в доме\r\n//console.log(444, $els, req, `${$elsLen} !== 1 && ${oldVal} === ${include.key}`, $elsLen !== 1 && oldVal === include.key);\r\n//alert(22);\r\n//\t\treturn $elsLen > 3 ? getInc(req, include, $els, $elsLen) : null;//если много тегов, тогда ренедрим их или продолжаем рендер следующей команды\r\n\t\treturn $elsLen > 3 ? renderI(req, $els[0], $els[$elsLen - 1], renderInc)\r\n\t\t\t.then($last => readyInc(req, include, $last)) : null;//если много тегов, тогда ренедрим их или продолжаем рендер следующей команды\r\n\t}\r\n\tconst $last = $els[$elsLen - 1];\r\n\tif (include.readyState === \"complete\") {\r\n\t\tgetNewInc(req, include, oldVal, $els, $elsLen, null);\r\n\t\treturn type_renderRes(true, null, $last);\r\n\t}\r\n\tconst loading = type_incLoading(req);\r\n\tif (loading.isShow) {\r\n//\t\tshowLoading(req.$src, () => include.readyState === \"complete\", loading.type, loading.waitTime);\r\n\t\tshowLoading(req.$src, () => false, loading.type, loading.waitTime);\r\n\t}\r\n\tif (!waitingStack.has(include.key)) {\r\n\t\twaitingStack.set(include.key, (include.res === null ? fetch(include.req)\r\n\t\t\t.then(res => res.text()) : include.res.text())\r\n\t\t\t.then(html => {\r\n\t\t\t\twaitingStack.delete(include.key);\r\n\t\t\t\treturn createIncFragment(req, include, html);\r\n\t\t\t}));\r\n\t}\r\n\tconst w = waitingStack.get(include.key);\r\n\treq.sync.afterAnimations.add(type_animation(() => w\r\n\t\t.then(() => req.sync.stat === 0 && getNewInc(req, include, oldVal, $els, $elsLen, loading)), req.sync.local, 0));\r\n\treturn type_renderRes(true, null, $last);\r\n}\r\nfunction getIncude(req, val) {\r\n\tif (typeof val !== \"string\") {\r\n\t\tconst r = getRequest(val, \"\");\r\n\t\tif (r === null) {\r\n\t\t\treturn null;\r\n\t\t}\r\n//todo так как у респонса неполчится узнать гет ли он - то все добовляем кэш - А при использовании в строке в фетч - он всегда будет разный ...\r\n\t\tif (r.method === \"GET\" || r.method === undefined) {\r\n\t\t\tconst include = incCache.get(r.url);\r\n\t\t\tif (include !== undefined) {\r\n\t\t\t\treturn include;\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst inc = r instanceof Request ? type_include(\"loading\", r.url, r, null) : type_include(\"loading\", r.url, null, r);\r\n\t\tincCache.set(inc.key, inc);\r\n\t\treturn inc;\r\n\t}\r\n\tif (val === \"\") {\r\n\t\treturn null;\r\n\t}\r\n\tconst r = getRequest(val, getTopUrl(my.env.srcBy$src.get(req.$src), req.str)),\r\n\t\tinclude = incCache.get(r.url);\r\n\tif (include !== undefined) {\r\n\t\treturn include;\r\n\t}\r\n\tconst inc = type_include(\"loading\", r.url, r, null);\r\n\tincCache.set(inc.url, inc);\r\n\treturn inc;\r\n}\r\nfunction type_include(readyState, url, req, res) {\r\n\treturn {\r\n//\t\tkey: req === null ? (res === null ? url : res) : (req.method === \"GET\" ? url : req),\r\n\t\tkey: req === null ? url : (req.method === \"GET\" ? url : req),\r\n\t\treadyState,\r\n\t\turl,\r\n\t\treq,\r\n\t\tres,\r\n\t\t$fr: null,\r\n\t\t$tags: null,\r\n\t\tscope: null\r\n\t};\r\n}\r\nfunction type_incLoading(req) {\r\n\tconst a0 = req.reqCmd.args[0],\r\n\t\ta1 = req.reqCmd.args[1],\r\n\t\ttype = a0 !== \"\" && a0 !== undefined ? a0 : \"\",\r\n\t\twaitTime = a1 !== \"\" && a1 !== undefined ? a1 : \"\";\r\n\treturn {\r\n\t\ttype,\r\n\t\twaitTime,\r\n\t\tisShow: waitTime !== \"\" || type !== \"\"\r\n\t};\r\n}\r\nasync function createIncFragment(req, include, html) {\r\n\tconst $fr = my.document.createDocumentFragment(),\r\n\t\t$div = my.document.createElement(\"div\");\r\n\t$div.innerHTML = html;\r\n\tfor (let $i = $div.firstChild; $i !== null; $i = $div.firstChild) {\r\n\t\t$fr.appendChild($i);\r\n\t}\r\n\tif (my.createLineNo) {\r\n\t\tmy.createLineNo(include.url, html, $fr);\r\n\t}\r\n\tjoinText($fr);\r\n\tinclude.$tags = [];\r\n//\tinclude.$tags = [...$fr.querySelectorAll(\"link[rel]\")];\r\n\tconst $links = $fr.querySelectorAll(\"link\"),\r\n\t\t$linksLen = $links.length;\r\n\tfor (let i = 0; i < $linksLen; i++) {\r\n\t\tconst $i = $links[i];\r\n\t\tif ($i.getAttribute(\"rel\") !== null) {\r\n\t\t\tinclude.$tags.push($i);\r\n\t\t}\r\n\t}\r\n\tfor (const $i of include.$tags) {\r\n\t\tconst uri = $i.getAttribute(\"href\");\r\n\t\tif (uri) {\r\n\t\t\tconst url = getUrl(uri, include.url);\r\n\t\t\tif (uri !== url) {\r\n\t\t\t\t$i.setAttribute(\"href\", url);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n//\tinclude.$tags.push(...$fr.querySelectorAll(\"style\"));\r\n\tconst $styles = $fr.querySelectorAll(\"style\"),\r\n\t\t$stylesLen = $styles.length;\r\n\tfor (let i = 0; i < $stylesLen; i++) {\r\n\t\tinclude.$tags.push($styles[i]);\r\n\t}\r\n\tconst $scripts = $fr.querySelectorAll(\"script\");\r\n\tif ($scripts.length !== 0) {\r\n\t\tawait createIncScripts(req, include, $scripts);\r\n\t}\r\n\tif (include.$tags.length !== 0) {\r\n//todo может быть просто вставить?\r\n//--\t\treq.sync.animations.add(type_animation(() => {//todo- если так сделать то онрендер на тегах не сработает - пусть так\r\n\t\t\tif (include.$tags[0].parentNode === my.document.head) {\r\n//todo такого не долждно быть - можно удалять\r\nconsole.warn(\"applyIncFragment\", include.$tags, req);\r\n//alert(1);\r\n\t\t\t}\r\n\t\t\tfor (const $i of include.$tags) {\r\n\t\t\t\tmy.document.head.appendChild($i);\r\n\t\t\t}\r\n//--\t\t}, req.sync.local, 0));\r\n\t}\r\n\tinclude.$fr = $fr;\r\n\tinclude.readyState = \"complete\";\r\n}\r\nfunction createIncScripts(req, include, $scripts) {\r\n\tconst $sLen = $scripts.length,\r\n\t\tscripts = new Array($sLen);\r\n\tfor (let i = 0; i < $sLen; i++) {\r\n\t\tscripts[i] = createIncScript(req, include, $scripts[i]);\r\n\t}\r\n\treturn Promise.all(scripts);\r\n}\r\nfunction createIncScript(req, include, $e) {\r\n\t$e.parentNode.removeChild($e);\r\n\tconst origUrl = $e.getAttribute(\"src\"),\r\n\t\turl = origUrl !== null ? getUrl(origUrl, include.url) : null;\r\n\tif (url !== origUrl) {\r\n\t\t$e.setAttribute(\"src\", url);\r\n\t}\r\n\tif ($e.type === \"module\") {\r\n\t\tif (url !== null) {\r\n//\t\t\ttry {\r\n\t\t\t\treturn import(url)\r\n\t\t\t\t\t.then(m => incToScope(m, include))\r\n\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\tthrow checkScript(err, $e, req, url);\r\n\t\t\t\t\t});\r\n//\t\t\t} catch (err) {\r\n//\t\t\t\tthrow checkScript(err, $e, req, url);\r\n//\t\t\t}\r\n\t\t}\r\n\t\tconst uurl = URL.createObjectURL(new Blob([$e.textContent], {\r\n\t\t\ttype: \"text/javascript\"\r\n\t\t}));\r\n//\t\ttry {\r\n\t\t\treturn import(uurl)\r\n\t\t\t\t.then(m => {\r\n//\t\t\t\t\tif (my.debugLevel !== 0) {//todo\r\n\t\t\t\t\t\tURL.revokeObjectURL(uurl);\r\n//\t\t\t\t\t}\r\n\t\t\t\t\tincToScope(m, include);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(err => {\r\n//\t\t\t\t\tif (my.debugLevel !== 0) {//todo\r\n\t\t\t\t\t\tURL.revokeObjectURL(uurl);\r\n//\t\t\t\t\t}\r\n\t\t\t\t\tthrow checkScript(err, $e, req);\r\n\t\t\t\t});\r\n//\t\t} catch (err) {\r\n////\t\t\tif (my.debugLevel !== 0) {//todo\r\n//\t\t\t\tURL.revokeObjectURL(uurl);\r\n////\t\t\t}\r\n//\t\t\tthrow checkScript(err, $e, req);\r\n//\t\t}\r\n//\t\treturn;\r\n\t}\r\n\tif (url === null) {\r\n\t\trunIncScript(req, $e.textContent, $e, url);\r\n\t\treturn;\r\n\t}\r\n\tconst s = incScriptCache.get(url);\r\n\tif (s !== undefined)  {\r\n\t\trunIncScript(req, s, $e, url);\r\n\t\treturn;\r\n\t}\r\n\treturn fetch(url, defRequestInit)\r\n\t\t.then(res => {\r\n\t\t\tif (res.ok) {\r\n\t\t\t\treturn res.text();\r\n\t\t\t}\r\n\t\t\tthrow getErr(new Error(`>>>mw inc:createIncScript: Request stat ${res.status}`), req.$src, req);\r\n\t\t})\r\n\t\t.then(text => {\r\n\t\t\tincScriptCache.set(url, text);\r\n\t\t\trunIncScript(req, text, $e, url);\r\n\t\t});\r\n}\r\nfunction incToScope(m, include) {\r\n\tinclude.scope = {};\r\n\tfor (const i in m) {\r\n\t\tconst j = m[i];\r\n\t\tinclude.scope[j.name !== undefined ? j.name : i] = j;\r\n\t}\r\n}\r\nfunction scopeToInc(include, req) {\r\n\tif (include.scope === null) {\r\n\t\treturn;\r\n\t}\r\n\tfor (const n in include.scope) {\r\n\t\treq.scope[p_target][n] = include.scope[n];\r\n\t}\r\n}\r\nfunction runIncScript(req, text, $e, url) {\r\n\ttry {\r\n//\t\tnew Function(text).apply($e);\r\n\t\tself.eval(text);\r\n\t} catch (err) {\r\n\t\tthrow checkScript(err, $e, req, url);\r\n\t}\r\n}\r\nfunction checkScript(err, $e, req, url) {\r\n\tif (url) {\r\n\t\treturn getErr(err, $e, req, null, url, err.lineNumber, err.columnNumber);\r\n\t}\r\n\tif (my.getLineNo === undefined) {\r\n\t\treturn getErr(err, $e, req);\r\n\t}\r\n\tconst line = my.getLineNo($e),\r\n\t\tnumIdx = line.lastIndexOf(\":\");\r\n\treturn getErr(err, $e, req, null, line.substr(0, numIdx), Number(line.substr(numIdx + 1)) - 1 + err.lineNumber);\r\n}\r\n//new\r\nfunction getNewInc(req, include, oldVal, $els, $elsLen, loading) {\r\n\treq.sync.animations.add(type_animation(() => {\r\n\t\tconst $new = cloneIncFragment(req, include, oldVal, loading),\r\n\t\t\t$src = $new.firstChild,\r\n\t\t\t$last = $new.lastChild;\r\n\t\tgetNewIncInsert(req, oldVal, $els, $elsLen, $new, $src);\r\n\t\treq.sync.afterAnimations.add(type_animation(() => {\r\n\t\t\tscopeToInc(include, req);\r\n\t\t\treturn renderI(req, $src, $last, renderNewInc)\r\n\t\t\t\t.then($last => readyInc(req, include, $last));\r\n\t\t}, req.sync.local, 0))\r\n\t}, req.sync.local, 0));\r\n/*//!!этот вариант плох тем, что если после анимации произойдёт отмена, то последующие рендеры будут считать что вставка уже отрендерена - это плохо для слотов\r\n\tconst $new = cloneIncFragment(req, include, oldVal, loading),\r\n\t\t$src = $new.firstChild,\r\n\t\t$last = $new.lastChild;\r\n\treq.sync.animations.add(type_animation(() => getNewIncInsert(req, oldVal, $els, $elsLen, $new, $src), req.sync.local, 0));\r\n\treq.sync.afterAnimations.add(type_animation(() => {\r\n\t\tscopeToInc(include, req);\r\n\t\treturn renderI(req, $src, $last, renderNewInc)\r\n\t\t\t.then($last => readyInc(req, include, $last));\r\n\t}, req.sync.local, 0));*/\r\n}\r\nfunction getNewIncInsert(req, oldVal, $els, $elsLen, $new, $src) {\r\n\tconst srcBy$src = my.env.srcBy$src;\r\n\tlet newSrcId = 0;\r\n\tfor (let $i = $new.firstChild; $i !== null; $i = $i.nextSibling) {\r\n\t\tconst iSrc = srcBy$src.get($i);\r\n\t\tif (iSrc !== undefined) {\r\n\t\t\tnewSrcId = iSrc.id;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tconst $parent = $els[0].parentNode,\r\n\t\t$lastNext = $els[$elsLen - 1].nextSibling,\r\n\t\tsrc = srcBy$src.get(req.$src);\r\n\tfor (let iSrc, i = 0;; i++) {\r\n\t\tiSrc = srcBy$src.get($els[i]);\r\n\t\tif (iSrc === undefined) {\r\n\t\t\tremoveChild($els[i], req);\r\n\t\t\tcontinue;\r\n\t\t}\r\n//\t\tif (newSrcId !== 0) {\r\n\t\t\tconst vIds = my.env.srcById.get(newSrcId).descr.varIds;\r\n\t\t\tfor (const vId of iSrc.descr.varIds) {\r\n\t\t\t\tvIds.add(vId);\r\n\t\t\t\tmy.env.srcIdsByVarId.get(vId).add(newSrcId);\r\n/*\r\n\t\t\t\tconst sIds = my.env.srcIdsByVarId.get(vId);\r\nif (sIds === undefined) {\r\n//todo\r\nconsole.warn(\"inc.js\");\r\nalert(1)\r\n//\t\t\t\t\tcontinue;\r\n}\r\n\t\t\t\tsIds.add(newSrcId);*/\r\n\t\t\t}\r\n//\t\t}\r\n\t\tdo {\r\n\t\t\tif (iSrc !== undefined) {\r\n\t\t\t\tconst l = req.sync.local.get(iSrc.id);\r\n\t\t\t\tl.animationsCount = -1;\r\n\t\t\t\tl.newSrcId = newSrcId;\r\n\t\t\t\tif (iSrc.id === req.sync.renderParam.sId) {// && $els[i][p_srcId] !== req.$src[p_srcId]) {\r\n\t\t\t\t\treq.sync.renderParam.sId = newSrcId;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tremoveChild($els[i]);\r\n\t\t\tiSrc = srcBy$src.get($els[i]);\r\n\t\t} while (++i < $elsLen);\r\n\t\tbreak;\r\n\t}\r\n//todo\tif (oldVal !== undefined) {\r\n//\t\tincClear(req.str, src, oldVal);\r\n//\t}\r\n\t$parent.insertBefore($new, $lastNext);\r\n}\r\n/*\r\nfunction incClear(str, src, incKey) {\r\n\tincClearByKey(incKey);\r\n\tfor (const n of getAttrItAfter(src.descr.attr.keys(), str, false)) {\r\n\t\tif (my.env.reqCmd.get(n).cmdName !== incCmdName) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tincKey = getIdx(src, n);\r\n\t\tif (incKey === undefined) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tincClearByKey(incKey);\r\n\t}\r\n}\r\nexport function incClearByKey(key) {\r\n\tconst inc = incCache.get(key);\r\nconsole.error(1, key, inc?.counter);\r\n\tif (--inc.counter !== 0) {\r\n\t\treturn;\r\n\t}\r\n\tincCache.delete(key);\r\n\tif (inc.$tags === null) {\r\n\t\treturn;\r\n\t}\r\n\tfor (let i = inc.$tags.length - 1; i > -1; i--) {\r\n\t\tconst $i = inc.$tags[i];\r\n\t\t$i.parentNode.removeChild($i);\r\n//or\t\tmy.document.head.removeChild($i);\r\n\t}\r\n}*/\r\n//function getNewIncRender(req, include, $src, $last) {\r\n//\tif (include.scope !== null) {\r\n//\t\tfor (const n in include.scope) {\r\n//\t\t\treq.scope[p_target][n] = include.scope[n];\r\n//\t\t}\r\n//\t}\r\n//\treturn renderI(req, $src, $last, renderNewInc)\r\n//\t\t.then($last => readyInc(req, include, $last));\r\n//}\r\nasync function renderNewInc(req, $e) {\r\n/*\r\n\tconst afterAttr = new Map(),\r\n\t\tdescr = my.env.srcBy$src.get($e).descr,\r\n\t\tattrIt = descr.attr.entries();\r\n\tfor (let i = attrIt.next(); !i.done; i = attrIt.next()) {\r\n\t\tconst [n, v] = i.value,\r\n\t\t\tcn = my.env.reqCmd.get(n).cmdName;\r\n//todo inc args --\r\n//\t\tif (v && ((cn !== incCmdName && cn !== fetchCmdName) || !my.env.reqCmd.get(n).args[0]) && cn !== elseCmdName && cn !== defaultCmdName && cn !== onCmdName) {\r\n//todo наверное всё же не так! для иквов фетчей это может стать проблемой\r\n\t\tif (v && cn !== elseCmdName && cn !== defaultCmdName && cn !== onCmdName) {\r\n//todo\r\nconsole.warn(n, v);\r\n\t\t\tawait eval2(type_req($e, n, v, req.scope, req.sync), $e, true);//привязываем к новым тегам команды ДО\r\n\t\t}\r\n\t\tif (n !== req.str) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tfor (i = attrIt.next(); !i.done; i = attrIt.next()) {\r\n\t\t\tafterAttr.set(i.value[0], i.value[1]);\r\n\t\t}\r\n\t\treturn renderTag($e, req.scope, afterAttr, req.sync);\r\n\t}\r\n\tthrow new Error(\"inc.js\");*/\r\n\treturn renderTag($e, req.scope, req.str, req.sync);\r\n}\r\n//current\r\n//function getInc(req, include, $els, $elsLen) {\r\n//\treturn renderI(req, $els[0], $els[$elsLen - 1], renderInc)\r\n//\t\t.then($last => readyInc(req, include, $last));\r\n//}\r\nfunction renderInc(req, $e) {\r\n\treturn renderTag($e, req.scope, req.str, req.sync);\r\n}\r\nasync function renderI(req, $e, $last, h) {\r\n\tdo {\r\n\t\tconst iSrc = my.env.srcBy$src.get($e);\r\n\t\tif (iSrc !== undefined && iSrc.isCmd) {//это когда template и в нем скрыта тектовая нода\r\n\t\t\t$e = await h(req, $e);\r\n\t\t\tif (req.sync.stat !== 0) {\r\n//\t\t\t\tconsole.error(7878787, iSrc.id, $e, $last, req);\r\n//\t\t\t\talert(11);\r\n\t\t\t\treturn $last;\r\n\t\t\t}\r\n/*\r\n//todo--\r\n\t\t\tif ($e.parentNode !== $last.parentNode) {\r\n\t\t\t\tconsole.error(555555555, iSrc.id, $e, $last, req);\r\n\t\t\t\talert(11);\r\n\r\n\t\t\t\treturn $last;\r\n\t\t\t}\r\n\t\t\tif (!$last.nextSibling === $e) {\r\n//todo--\r\n\t\t\t\tconsole.warn(666666666, $e, $last, req);\r\n\t\t\t\talert(11);\r\n\r\n\t\t\t\treturn $last;\r\n\t\t\t}*/\r\n\t\t}\r\n\t\tif ($e === $last) {\r\n\t\t\treturn $last;\r\n\t\t}\r\n\t\t$e = $e.nextSibling;\r\n\t} while ($e !== null);\r\n\tthrow new Error(\"inc.js\");\r\n}\r\n//todo replace inline\r\nfunction readyInc(req, include, $last) {\r\n\treturn type_renderRes(true, null, $last);\r\n}\r\nfunction cloneIncFragment(req, include, oldVal, loading) {\r\n//\tconst $fr = cloneNode(req, include.$fr),\r\n\tconst $fr = include.$fr.cloneNode(true),\r\n\t\tsrc = my.env.srcBy$src.get(req.$src),\r\n\t\tdescr = src.descr,\r\n\t\tattrs = req.$src.attributes,\r\n\t\tattrsLen = attrs.length,\r\n\t\tcurAttr = new Map(),\r\n\t\tisR = oldVal !== undefined,\r\n\t\tasOneIdx = src.asOneIdx !== null ? src.asOneIdx : type_asOneIdx(),\r\n\t\tidx = src.idx !== null ? src.idx : type_idx(),\r\n\t\tsave = src.save !== null ? src.save : type_save(),\r\n\t\ton = [];\r\n\tfor (const n of getAttrItAfter(descr.attr.keys(), req.str, false)) {\r\n\t\tasOneIdx.delete(n);\r\n\t\tidx.delete(n);\r\n\t}\r\n\tif (isR) {\r\n\t\tfor (const [n, v] of save.get(req.str)) {\r\n\t\t\tcurAttr.set(n, v);\r\n\t\t}\r\n\t} else {\r\n\t\tconst skipAttrs = new Set();\r\n\t\tif (loading !== null && loading.isShow) {\r\n\t\t\tconst sId = src.id,\r\n\t\t\t\tl = loadingCount.get(sId),\r\n\t\t\t\tlCount = l.get(\"\") - 1;\r\n\t\t\tl.set(\"\", lCount);\r\n\t\t\tif (lCount <= 0) {\r\n\t\t\t\tskipAttrs.add(isFillingName);\r\n\t\t\t}\r\n\t\t\tif (loading.type !== \"\") {\r\n\t\t\t\tconst lCount = l.get(loading.type) - 1;\r\n\t\t\t\tl.set(loading.type, lCount);\r\n\t\t\t\tif (lCount <= 0) {\r\n\t\t\t\t\tskipAttrs.add(isFillingName + isFillingDiv + loading.type);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst saveI = type_saveI();\r\n\t\tsave.set(req.str, saveI);\r\n\t\tfor (let i = 0; i < attrsLen; i++) {\r\n\t\t\tconst a = attrs[i];\r\n\t\t\tif (skipAttrs.has(a.name)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tcurAttr.set(a.name, a.value);\r\n\t\t\t//todo\r\n\t\t\tif ((my.debugLevel !== 0 || a.name.indexOf(idxName) !== 0 && a.name.indexOf(asOneIdxName) !== 0) && a.name.indexOf(isFillingName) !== 0) {\r\n\t\t\t\tsaveI.set(a.name, a.value);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tfor (const [n, v] of descr.attr) {\r\n\t\tif (n === req.str) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tconst rc = my.env.reqCmd.get(n);\r\n\t\tif (rc.cmdName === onCmdName) {\r\n\t\t\ton.push(type_cloneNodeOn(rc.cmd, n, v));\r\n\t\t}\r\n\t}\r\n\tconst onLen = on.length;\r\n\tfor (let k, nn, j, i = 0, $i = $fr.firstChild; $i !== null; i++, $i = $i.nextSibling) {\r\n\t\tif ($i.nodeType !== 1) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst iAttrs = $i.attributes,\r\n\t\t\tiAttrsLen = iAttrs.length,\r\n\t\t\tnewAttr = new Map();\r\n\t\tfor (let i = 0; i < iAttrsLen; i++) {\r\n\t\t\tconst a = iAttrs[i];\r\n\t\t\tnewAttr.set(a.name, a.value);\r\n\t\t}\r\n\t\tfor (const n of newAttr.keys()) {\r\n\t\t\t$i.removeAttribute(n);\r\n\t\t}\r\n\t\tconst curAttrIt = curAttr.entries(),\r\n\t\t\tnSet = new Set();\r\n\t\tfor (j = curAttrIt.next(); !j.done; j = curAttrIt.next()) {\r\n\t\t\tconst [n, v] = j.value;\r\n\t\t\t$i.removeAttribute(n);\r\n\t\t\t$i.setAttribute(n, v);\r\n\t\t\tnSet.add(n);\r\n\t\t\tif (n !== req.str) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tfor (const [n, v] of newAttr) {\r\n\t\t\t\tif (!setReqCmd(n)) {\r\n\t\t\t\t\t$i.removeAttribute(n);\r\n\t\t\t\t\t$i.setAttribute(n, v);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tnn = n;\r\n\t\t\t\twhile (nSet.has(nn)) {\r\n\t\t\t\t\tnn += cmdArgsDiv;\r\n\t\t\t\t}\r\n\t\t\t\tnSet.add(nn);\r\n\t\t\t\t$i.setAttribute(nn, v);\r\n\t\t\t}\r\n\t\t\tfor (j = curAttrIt.next(); !j.done; j = curAttrIt.next()) {\r\n\t\t\t\tconst [n, v] = j.value;\r\n\t\t\t\tif (!setReqCmd(n)) {\r\n\t\t\t\t\t$i.removeAttribute(n);\r\n\t\t\t\t\t$i.setAttribute(n, v);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tnn = n;\r\n\t\t\t\twhile (nSet.has(nn)) {\r\n\t\t\t\t\tnn += cmdArgsDiv;\r\n\t\t\t\t}\r\n\t\t\t\t$i.setAttribute(nn, v);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tpreRender($i, false);\r\n\t\tconst iSrc = my.env.srcBy$src.get($i);\r\n\t\tif (asOneIdx.size !== 0) {\r\n\t\t\tiSrc.asOneIdx = type_asOneIdx(asOneIdx);\r\n\t\t}\r\n\t\tiSrc.idx = type_idx(idx);\r\n\t\tiSrc.save = type_save(save);\r\n\t\tif (onLen !== 0) {\r\n\t\t\tfor (k = 0; k < onLen; k++) {\r\n\t\t\t\tconst o = on[k];\r\n\t\t\t\to.cmd.render(type_req($i, o.str, o.expr, req.scope, req.sync));\r\n\t\t\t}\r\n\t\t}\r\n//!!2\r\n\t\tif (my.debugLevel !== 0) {\r\n\t\t\tfor (const [n, v] of asOneIdx) {\r\n\t\t\t\t$i.setAttribute(asOneIdxName + n, v);\r\n\t\t\t}\r\n\t\t\tfor (const [n, v] of idx) {\r\n\t\t\t\t$i.setAttribute(idxName + n, v);\r\n\t\t\t}\r\n\t\t}\r\n\t\tsetIdx(iSrc, req.str, include.key);\r\n\t}\r\n\tlet isHas$e = false;\r\n\tfor (let $i = $fr.firstChild; $i !== null; $i = $i.nextSibling) {\r\n\t\tif ($i.nodeType === 1) {\r\n\t\t\tisHas$e = true;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (!isHas$e) {//!$fr.firstElementChild) {\r\n\t\treturn $fr;\r\n\t}\r\n//тут что бы не создовать sId => preRender\r\n//todo\r\n\tif (!isR) {//со слотами такая штука: если уже была вставка - это не делаем, так как путаница получиться\r\n\t\tmakeSlots(req, $fr);\r\n\t}\r\n\t$fr.insertBefore(my.document.createComment(\"inc_begin\"), $fr.firstChild);\r\n\t$fr.appendChild(my.document.createComment(\"inc_end\"));\r\n\treturn $fr;\r\n}\r\nfunction makeSlots(req, $fr) {\r\n\tconst $slots = $fr.querySelectorAll(\"slot\"),\r\n//\tconst $slots = $fr.getElementsByTagName(\"slot\"),\r\n\t\t$slotsLen = $slots.length;\r\n\tlet $freeSlot = null;\r\n\tfor (let i = 0; i < $slotsLen; i++) {\r\n\t\tconst $s = $slots[i],\r\n\t\t\tn = $s.name;\r\n\t\tif (n === \"\" && !$freeSlot) {\r\n\t\t\t$freeSlot = $s;\r\n\t\t\tcontinue;\r\n\t\t}\r\n/*\r\n\t\tconst $v = req.$src.querySelectorAll(`[slot=\"${n}\"]`),\r\n\t\t\t$vLen = $v.length;\r\n\t\tfor (let j = 0; j < $vLen; j++) {\r\n//\t\t\tconst jSrc = my.env.srcBy$src.get($v[j]);\r\n//\t\t\tif (jSrc === undefined) {\r\n//\t\t\t\t$s.appendChild($v[j]);\r\n//\t\t\t\tcontinue;\r\n//\t\t\t}\r\n//\t\t\tconst get$elsByStr = jSrc.descr.get$elsByStr;\r\n\t\t\tconst $j = $v[j],\r\n\t\t\t\tget$elsByStr = my.env.srcBy$src.get($j).descr.get$elsByStr;\r\n\t\t\tif (get$elsByStr === null) {\r\n\t\t\t\t$s.appendChild($j);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tconst $els = get$els($j, get$elsByStr, \"\"),\r\n\t\t\t\t$elsLen = $els.length;\r\n\t\t\tfor (let k = 0; k < $elsLen; k++) {\r\n\t\t\t\t$s.appendChild($els[k]);\r\n\t\t\t}\r\n\t\t}*/\r\n\t\tconst $parent = $i.parentNode,\r\n\t\t\t$p = [];\r\n\t\tlet $i = req.$src.firstChild;\r\n\t\tdo {\r\n\t\t\tif ($i.getAttribute(\"slot\") === n) {\r\n\t\t\t\tconst $j = $i,\r\n\t\t\t\t\tget$elsByStr = my.env.srcBy$src.get($j).descr.get$elsByStr;\r\n\t\t\t\t$i = $i.previousSibling;\r\n\t\t\t\tif ($i === null) {\r\n\t\t\t\t\t$i = $j.parentNode;\r\n\t\t\t\t}\r\n\t\t\t\tif (get$elsByStr === null) {\r\n\t\t\t\t\t$s.appendChild($j);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tconst $els = get$els($j, get$elsByStr, \"\"),\r\n\t\t\t\t\t$elsLen = $els.length;\r\n\t\t\t\tfor (let k = 0; k < $elsLen; k++) {\r\n\t\t\t\t\t$s.appendChild($els[k]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n//////////////////////\r\n\t\t\tif ($i.firstChild !== null) {\r\n\t\t\t\t$i = $i.firstChild;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n//\t\t\tif ($i.nodeName === \"TEMPLATE\" && $i.getAttribute(hideName) !== null) {\r\n//\t\t\t\t$p.push($i);\r\n//\t\t\t\t$i = $i.content.firstChild;\r\n//\t\t\t\tcontinue;\r\n//\t\t\t}\r\n\t\t\tif ($i.parentNode === $parent) {//если мы не ушли вглубь - значит и вправо двигаться нельзя\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif ($i.nextSibling !== null) {\r\n\t\t\t\t$i = $i.nextSibling;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tdo {\r\n\t\t\t\t$i = $i.parentNode;\r\n//\t\t\t\tif ($i.nodeType === 11) {\r\n//\t\t\t\t\t$i = $p.pop();\r\n//\t\t\t\t}\r\n\t\t\t\tif ($i.parentNode === $parent) {\r\n\t\t\t\t\t$i = null;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif ($i.nextSibling !== null) {\r\n\t\t\t\t\t$i = $i.nextSibling;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} while (true);\r\n\t\t} while ($i !== null);\r\n\t}\r\n\tif ($freeSlot === null) {\r\n\t\treturn;\r\n\t}\r\n\tfor (let $i = req.$src.firstChild; $i !== null; $i = req.$src.firstChild) {\r\n\t\t$freeSlot.appendChild($i);\r\n\t}\r\n}\r\nfunction inc_get$els($src, str, expr, pos) {\r\n\tif ($src.nodeType === 1 && !isRenderdInc($src, str)) {\r\n\t\treturn [$src];\r\n\t}\r\n\tconst $els = [],\r\n\t\tsrcBy$src = my.env.srcBy$src;\r\n\tfor (let $i = inc_get$first($src, str, expr, pos), count = 0; $i !== null; $i = $i.nextSibling) {\r\n\t\t$els.push($i);\r\n\t\tconst iSrc = srcBy$src.get($i);\r\n\t\tif (iSrc === undefined || !iSrc.isCmd) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tcount = getIncCount($i, str, expr, pos);\r\n\t\tfor ($i = $i.nextSibling; $i !== null; $i = $i.nextSibling) {\r\n\t\t\t$els.push($i);\r\n\t\t\tconst iSrc = srcBy$src.get($i);\r\n\t\t\tif (iSrc !== undefined && iSrc.isCmd || $i.nodeType !== 8) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tconst t = $i.textContent;\r\n\t\t\tif (t === \"inc_end\") {\r\n\t\t\t\tif (count === 0) {\r\n\t\t\t\t\treturn $els;\r\n\t\t\t\t}\r\n\t\t\t\tcount--;\r\n\t\t\t} else if (t === \"inc_begin\") {\r\n\t\t\t\tcount++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tbreak;\r\n\t}\r\n\tthrow getErr(new Error(`>>>mw inc:incGet$els: Not found <!--inc_begin-->: \"${str}\", \"${expr}\", ${pos}`), $src);\r\n}\r\nfunction inc_get$first($src, str, expr, pos) {\r\n\tif ($src.nodeType === 1 && !isRenderdInc($src, str)) {\r\n\t\treturn $src;\r\n\t}\r\n\tif ($src.nodeType === 8 && $src.textContent === \"inc_begin\") {\r\n\t\treturn $src;\r\n\t}\r\n\tconst srcBy$src = my.env.srcBy$src;\r\n\tfor (let $i = $src, count = 0; $i !== null; $i = $i.previousSibling) {\r\n\t\tconst iSrc = srcBy$src.get($i);\r\n\t\tif (iSrc === undefined || !iSrc.isCmd) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tcount = getIncCount($i, str, expr, pos);\r\n\t\tfor ($i = $i.previousSibling; $i !== null; $i = $i.previousSibling) {\r\n\t\t\tconst iSrc = srcBy$src.get($i);\r\n\t\t\tif (iSrc !== undefined && iSrc.isCmd || $i.nodeType !== 8) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tconst t = $i.textContent;\r\n\t\t\tif (t === \"inc_begin\") {\r\n\t\t\t\tif (count === 0) {\r\n\t\t\t\t\treturn $i;\r\n\t\t\t\t}\r\n\t\t\t\tcount--;\r\n\t\t\t} else if (t === \"inc_end\") {\r\n\t\t\t\tcount++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tbreak;\r\n\t}\r\n\tthrow getErr(new Error(`>>>mw inc:incGet$first: Not found <!--inc_begin-->: \"${str}\", \"${expr}\", ${pos}`), $src);\r\n}\r\nfunction getIncCount($i, str, expr, pos) {\r\n//todo , expr, pos\r\n\tlet count = 0;\r\n\tconst attrIt = getAttrItAfter(my.env.srcBy$src.get($i).descr.attr.keys(), str, false);\r\n\tfor (let i = attrIt.next(); !i.done; i = attrIt.next()) {\r\n\t\tif (my.env.reqCmd.get(i.value).cmdName !== incCmdName) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (!isRenderdInc($i, i.value)) {\r\n\t\t\treturn count;\r\n\t\t}\r\n\t\tcount++;\r\n\t}\r\n\treturn count;\r\n}\r\nfunction isRenderdInc($i, str) {\r\n\tconst srcBy$src = my.env.srcBy$src;\r\n\tif ($i.nodeType === 8 && $i.textContent === \"inc_end\") {\r\n\t\twhile (!srcBy$src.has($i) && $i !== null) {\r\n\t\t\t$i = $i.previousSibling;\r\n\t\t}\r\n\t} else {\r\n\t\twhile (!srcBy$src.has($i) && $i !== null) {\r\n\t\t\t$i = $i.nextSibling;\r\n\t\t}\r\n\t}\r\n\tconst iSrc = srcBy$src.get($i);\r\n\tif (str) {\r\n\t\treturn getIdx(iSrc, str) !== undefined;\r\n\t}\r\n\tfor (const n of iSrc.descr.attr.keys()) {\r\n\t\tif (my.env.reqCmd.get(n).cmdName === incCmdName) {\r\n\t\t\treturn getIdx(iSrc, n) !== undefined;\r\n\t\t}\r\n\t}\r\n}\r\n","import {defEventInit} from \"../config/config.js\";\n\nexport function dispatchCustomEvent($src, evtName, detail) {\n\tconst p = {\n\t\tdetail\n\t};\n\tfor (const i in defEventInit) {\n\t\tp[i] = defEventInit[i];\n\t}\n\t$src.dispatchEvent(new CustomEvent(evtName, p));\n}\n","﻿import {locVarName} from \"../config/config.js\";\r\nimport {oset} from \"../oset/oset.js\";\r\nimport {getProxy} from \"../proxy/proxy.js\";\r\nimport {type_loc} from \"./type.js\";\r\n\r\n//const trimSlashRe = /(^\\/|\\/$)/g;\r\n\r\nexport function setLoc(url) {\r\n\toset(self, locVarName, getLoc(url));\r\n}\r\nexport function getLoc(url) {//, defPageName = \"\") {\r\n\turl = new URL(url);\r\n\r\n//\tconst loc = parsePath(url.href, url.pathname, defPageName);\r\n//\tloc.hash = parsePath(url.hash, url.hash.substr(1), defPageName);\r\n\r\n\tconst query = new Map();\r\n\tfor (const [n, v] of url.searchParams) {\r\n\t\tquery.set(n, v);\r\n\t}\r\n\treturn type_loc(url.origin, url.href, url.pathname, query, url.hash);\r\n}\r\n//function parsePath(href, path, defPageName) {\r\n//\tconst args = path.replace(trimSlashRe, \"\").split(\"/\"),\r\n//\t\tloc = type_loc(href, path, args[0] || defPageName, args);\r\n//\tfor (let i = args.length - 1; i > 0; i -= 2) {\r\n//\t\tloc.param[args[i - 1]] = decodeURIComponent(args[i]);\r\n//\t}\r\n//\treturn loc;\r\n//}\r\n","export function type_loc(origin, href, pathname, query, hash) {//, name, args) {\n\treturn {\n\t\torigin,\n\t\thref,\n\t\tpathname,\n//\t\tname,\n//\t\targs,\n//\t\tparam: {},\n\t\tquery,\n\t\thash: {\n//\t\t\thref: hash,\n\t\t\tpath: hash.substr(1)\n\t\t}\n\t};\n}\n","export function kebabToCamelCase(str) {\n\tif (str === \"\" || str === undefined) {\n\t\treturn str;\n\t}\n\tconst words = str.split(\"-\"),\n\t\twordsLen = words.length;\n\tif (wordsLen == 1) {\n\t\treturn str;\n\t}\n\tstr = words[0];\n\tfor (let i = 1; i < wordsLen; i++) {\n\t\tif (words[i] !== \"\") {\n\t\t\tstr += words[i][0].toUpperCase() + words[i].substr(1);\n\t\t}\n\t}\n\treturn str;\n}\nexport function copyToClipboard(str) {\n\tconst $f = document.createElement(\"input\");\n\t$f.type = \"text\";\n\t$f.value = str;\n\t$f.setSelectionRange(0, this.length);\n\tdocument.execCommand(\"copy\");\n}\n","export function typedef(val) {\n\treturn new typedefCheck(val);\n}\nfunction typedefCheck(val) {\n\tthis.val = val;\n}\ntypedefCheck.prototype = {\n\teq(val) {\n\t\tif (this.val === val) {\n\t\t\treturn this;\n\t\t}\n\t\tthrow new Error(\"Value \" + this.val + \" !== \" + val);\n\t},\n\tof(ins) {\n\t\tif (this.val instanceof ins) {\n\t\t\treturn this;\n\t\t}\n\t\tthrow new Error(\"Value \" + this.val + \" isn't instanceof \" + ins);\n\t},\n\telsOf(t) {\n\t\tif (!Array.isArray(this.val)) {\n\t\t\tthrow new Error(\"Value \" + this.val + \" isn't array\");\n\t\t}\n\t\tfor (const i of this.val) {\n\t\t\tif (!(i instanceof t)) {\n\t\t\t\tthrow new Error(\"Value \" + i + \", array items isn't instanceof \" + t);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t},\n\tpropsOf(t) {\n\t\tif (typeof this.val !== \"object\" || this.val === null) {\n\t\t\tthrow new Error(\"Value \" + this.val + \" isn't object\");\n\t\t}\n\t\tfor (const i in this.val) {\n\t\t\tif (!(this.val[i] instanceof t)) {\n\t\t\t\tthrow new Error(\"Value \" + this.val[i] + \", object props isn't instanceof \" + t);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t},\n\tarray() {\n\t\tif (Array.isArray(this.val)) {\n\t\t\treturn this;\n\t\t}\n\t\tthrow new Error(\"Value \" + this.val + \" isn't array\");\n\t},\n\tobject() {\n\t\tif (typeof this.val === \"object\" && this.val !== null) {\n\t\t\treturn this;\n\t\t}\n\t\tthrow new Error(\"Value \" + this.val + \" isn't object\");\n\t},\n\tbool() {\n\t\tif (this.val === true || this.val === false) {\n\t\t\treturn this;\n\t\t}\n\t\tthrow new Error(\"Value \" + this.val + \" isn't bool\");\n\t},\n\tnumber() {\n\t\tif (typeof this.val === \"number\") {\n\t\t\treturn this;\n\t\t}\n\t\tthrow new Error(\"Value \" + this.val + \" isn't number\");\n\t},\n\tstring() {\n\t\tif (typeof this.val === \"string\") {\n\t\t\treturn this;\n\t\t}\n\t\tthrow new Error(\"Value \" + this.val + \" isn't string\");\n\t},\n\tnull() {\n\t\tif (this.val === null) {\n\t\t\treturn this;\n\t\t}\n\t\tthrow new Error(\"Value \" + this.val + \" isn't null\");\n\t},\n\tnotNull() {\n\t\tif (this.val !== null) {\n\t\t\treturn this;\n\t\t}\n\t\tthrow new Error(\"Value \" + this.val + \" is null\");\n\t},\n\tundef() {\n\t\tif (this.val === undefined) {\n\t\t\treturn this;\n\t\t}\n\t\tthrow new Error(\"Value \" + this.val + \" isn't undefined\");\n\t},\n\tnotUndef() {\n\t\tif (this.val !== undefined) {\n\t\t\treturn this;\n\t\t}\n\t\tthrow new Error(\"Value \" + this.val + \" is undefined\");\n\t},\n\tfunc() {\n\t\tif (typeof this.val === \"function\") {\n\t\t\treturn this;\n\t\t}\n\t\tthrow new Error(\"Value \" + this.val + \" isn't function\");\n\t},\n\ttest(func) {\n\t\tif (func(this.val)) {\n\t\t\treturn this;\n\t\t}\n\t\tthrow new Error(\"Value \" + this.val + \" didn't pass the functional test\");\n\t}\n};\n","import {viewVarName} from \"../config/config.js\";\nimport {oset} from \"../oset/oset.js\";\nimport {getProxy} from \"../proxy/proxy.js\";\n\nexport function setView(doc) {\n\toset(self, viewVarName, getView(doc));\n//console.log(\"resize\", self.view.clientWidth);\n}\nexport function getView(doc) {\n\tconst $s = doc.scrollingElement;\n//\treturn type_view(doc.scrollingElement);\n//}\n//function type_view($s) {\n\treturn {\n\t\tscrollTop: $s.scrollTop,\n\t\tscrollLeft: $s.scrollLeft,\n\t\tclientWidth: $s.clientWidth,\n\t\tclientHeight: $s.clientHeight\n\t};\n}\n","import {incCache} from \"../cmd/inc/inc.js\";\nimport {render, getCurRender, setDelay, cancelSync} from \"../render/algo.js\";\nimport {p_target, p_topUrl} from \"../config/config.js\";\nimport {preRender, removeChild} from \"../dom/dom.js\";\nimport {dispatchCustomEvent} from \"../evt/evt.js\";\n//import {showLoading\n//todo close\n//\t, loadingCount\n//\t} from \"../loading/loading.js\";\nimport {setLoc} from \"../loc/loc.js\";\nimport {getProxy} from \"../proxy/proxy.js\";\nimport {oset, del} from \"../oset/oset.js\";\nimport {copyToClipboard} from \"../str/str.js\";\nimport {typedef} from \"../typedef/typedef.js\";\nimport {getUrl\n//\t, isUri, normalizeUrl\n\t} from \"../url/url.js\";\n\nif (!self.my) {\n\tself.my = {};\n}\n\nmy.incCache = incCache;\n\nmy.render = render;\nmy.getCurRender = getCurRender;\nmy.setDelay = setDelay;\nmy.cancelSync = cancelSync;\n\nmy.p_target = p_target;\nmy.p_topUrl = p_topUrl;\n\nmy.preRender = preRender;\nmy.removeChild = removeChild;\n\nmy.setLoc = setLoc;\n\nmy.getProxy = getProxy;\n\nmy.oset = oset;\nmy.del = del;\n\nmy.copyToClipboard = copyToClipboard;\n\nmy.typedef = typedef;\n\nmy.getUrl = getUrl;\n//my.isUri = isUri;\n//my.normalizeUrl = normalizeUrl;\n\nmy.dispatchCustomEvent = dispatchCustomEvent;\n//todo close\n//my.loadingCount = loadingCount;\n//my.showLoading = showLoading;\n","import {type_animation} from \"../../render/type.js\";\r\nimport {type_cacheAttrSyncCurI} from \"../../cache/type.js\";\r\nimport {lazyRenderName, pushModName, replaceModName} from \"../../config/config.js\";\r\nimport {setAttribute, setAttributeValue, removeAttribute} from \"../../dom/dom.js\";\r\nimport {getErr} from \"../../err/err.js\";\r\nimport {eval2, q_eval2} from \"../../eval2/eval2.js\";\r\nimport {setLoc} from \"../../loc/loc.js\";\r\nimport {type_cmd} from \"../type.js\";\r\n\r\n//1) _attr.<name>=\"<string|bool>\"\r\n//2) _attr.<name>.<value>=\"<bool>\"\r\n//3) _attr.href.(push|replace)=... history.(push|replace)State\r\n//4) _attr.href... data-<_*(push|replace)>=\"<bool>\" history.(push|replace)State <- priority\r\n\r\nexport default type_cmd(cmd_render, cmd_q_render, null, null, false, false);\r\n\r\nfunction cmd_render(req) {\r\n\treturn eval2(req, req.$src, true)\r\n\t\t.then(val => {\r\n\t\t\tattr_render(req, req.$src, getName(req), val);\r\n\t\t\treturn null;\r\n\t\t});\r\n}\r\nfunction cmd_q_render(req, arr, isLast) {\r\n\treturn q_eval2(req, arr, isLast)\r\n\t\t.then(vals => {\r\n\t\t\tconst arrLen = arr.length,\r\n\t\t\t\tn = getName(req);\r\n\t\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\t\tattr_render(req, arr[i].$src, n, vals[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t});\r\n}\r\n/*\r\nexport default {\r\n\trender(req) {\r\n\t\treturn eval2(req, req.$src, true)\r\n\t\t\t.then(val => {\r\n\t\t\t\tattr_render(req, req.$src, getName(req), val);\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\t},\r\n\tq_render(req, arr, isLast) {\r\n\t\treturn q_eval2(req, arr, isLast)\r\n\t\t\t.then(vals => {\r\n\t\t\t\tconst arrLen = arr.length,\r\n\t\t\t\t\tn = getName(req);\r\n\t\t\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\t\t\tattr_render(req, arr[i].$src, n, vals[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\t}\r\n};*/\r\nfunction attr_render(req, $src, n, v) {\r\n//console.log(1111, req, $src, n, v);\r\n\tconst toggleVal = req.reqCmd.args[1],\r\n//\t\tc = getCacheBySrcId($src[p_srcId]),\r\n\t\tc = my.env.srcBy$src.get($src).cache,\r\n\t\tisInit = c.isInits.has(req.str);\r\n\tif (!isInit) {\r\n\t\tc.isInits.add(req.str);\r\n\t\tsetClick(req, $src, n);\r\n\t}\r\n\tif (req.sync.renderParam.isLinking) {\r\n\t\tc.current.set(req.str, $src.getAttribute(n));\r\n\t\treturn;\r\n\t}\r\n\tconst curVal = c.current.has(req.str) ? c.current.get(req.str) : $src.getAttribute(n),\r\n//todo сейчас это, наверное, уже не нужно\r\n\t\taCache = c.attrSyncCur.get(n),\r\n\t\taCurVal = aCache !== undefined && aCache.syncId === req.sync.syncId ? aCache.value : curVal;\r\n//--\t\tcurVal = aCache && aCache.syncId === req.sync.syncId ? aCache.value : (req.str in c.current ? c.current[req.str] : $src.getAttribute(n));\r\n\tif (toggleVal && toggleVal !== pushModName && toggleVal !== replaceModName) {\r\n\t\tif (aCurVal) {\r\n//console.log(2, req.str, aCurVal, n, v);\r\n\t\t\tconst i = aCurVal.indexOf(toggleVal),\r\n\t\t\t\tl = toggleVal.length;\r\n\t\t\tif (i !== -1 && (aCurVal[i - 1] === \" \" || i === 0) && (aCurVal[i + l] === \" \" || i + l === aCurVal.length)) {\r\n\t\t\t\tv = v ? aCurVal : aCurVal.substr(0, i) + aCurVal.substr(i + l + 1);\r\n\t\t\t} else if (v) {\r\n\t\t\t\tv = aCurVal[aCurVal.length - 1] === \" \" ? aCurVal + toggleVal : aCurVal + \" \" + toggleVal;\r\n//\t\t\t\tv = aCurVal + \" \" + toggleVal;\r\n\t\t\t} else {\r\n\t\t\t\tv = aCurVal;\r\n\t\t\t}\r\n\t\t} else if (v){\r\n\t\t\tv = toggleVal;\r\n\t\t} else {\r\n//\t\t\tv = false;\r\n\t\t\tv = aCurVal;\r\n\t\t}\r\n\t}\r\n\tif (v === true) {\r\n\t\tv = n;\r\n\t}\r\n\tif (aCache !== undefined) {\r\n\t\taCache.syncId = req.sync.syncId;\r\n\t\taCache.value = v;\r\n\t} else {\r\n\t\tc.attrSyncCur.set(n, type_cacheAttrSyncCurI(req.sync.syncId, v));\r\n\t}\r\n\tconst f = !!(v || v === \"\");\r\n\tif (n === lazyRenderName) {\r\n\t\treq.sync.renderParam.isLazyRender = f;\r\n\t}\r\n\tif (isInit && curVal === v) {\r\n//if (n == `selected`) console.log(111,$src, n, v);\r\n\t\tsetAttributeValue($src, n, v);\r\n\t\treturn;\r\n\t}\r\n\treq.sync.animations.add(type_animation(() => {\r\n\t\tc.current.set(req.str, v);\r\n\t\tif (f) {\r\n//if (n == `selected`) console.log(222,$src, n, v);\r\n\t\t\tsetAttribute($src, n, v);\r\n\t\t\treturn;\r\n\t\t}\r\n//if (n == `selected`) console.log(333,$src, n);\r\n\t\tremoveAttribute($src, n);\r\n\t}, req.sync.local, my.env.srcBy$src.get($src).id));\r\n/*\r\n\tif (f) {\r\n//todo <body _attr.class.home=\"[``].indexOf(loc.name) !== -1\" _attr.class.main=\"[`myloc`, `mysnt`, `services`].indexOf(loc.name) !== -1\"\r\n\t\treq.sync.animations.add(type_animation(() => {\r\n\t\t\tc.current.set(req.str, v);\r\n\t\t\tsetAttribute($src, n, v);\r\n\t\t}, req.sync.local, my.env.srcBy$src.get($src).id));\r\n\t\treturn;\r\n\t}\r\n//!!be clone => has attribute => not removing\r\n//\tif (aCurVal !== null) {\r\n\t\treq.sync.animations.add(type_animation(() => {\r\n\t\t\tc.current.set(req.str, v);\r\n\t\t\tremoveAttribute($src, n);\r\n\t\t}, req.sync.local, my.env.srcBy$src.get($src).id));\r\n//\t}*/\r\n}\r\nfunction setClick(req, $src, n) {\r\n//todo toLowerCase\r\n\tif ($src.tagName !== \"A\" || n.toLowerCase() !== \"href\" || $src.target) {\r\n\t\treturn;\r\n\t}\r\n\t$src.addEventListener(\"click\", async evt => {\r\n\t\tif (!$src.href || evt.ctrlKey || evt.metaKey) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tevt.preventDefault();\r\n//!!придумать\t\tswitch (await getVal($src, null, pushModName, false) ? pushModName : (await getVal($src, null, replaceModName, false) ? replaceModName : req.reqCmd.args[1])) {\r\n\t\tconst mode = req.reqCmd.args[1];\r\n\t\tif (mode === pushModName) {\r\n\t\t\thistory.pushState(undefined, undefined, $src.href);\r\n\t\t} else if (mode === replaceModName) {\r\n\t\t\thistory.replaceState(undefined, undefined, $src.href);\r\n\t\t} else {\r\n\t\t\tlocation.href = $src.href;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdocument.scrollingElement.scrollTop = 0;\r\n\t\tsetLoc(location.href);\r\n\t});\r\n}\r\nfunction getName(req) {\r\n\tconst n = req.reqCmd.args[0];\r\n\tif (n) {\r\n\t\treturn n;\r\n\t}\r\n\tthrow getErr(new Error(\">>>mw attr:render:01: Need set attribute name\"), req.$src, req);\r\n}\r\n","﻿import {p_target} from \"../../config/config.js\";\r\nimport {eval2, q_eval2} from \"../../eval2/eval2.js\";\r\nimport {getProxy} from \"../../proxy/proxy.js\";\r\nimport {kebabToCamelCase} from \"../../str/str.js\";\r\nimport {type_cmd} from \"../type.js\";\r\n\r\nexport default type_cmd(cmd_render, cmd_q_render, null, null, false, false);\r\n\r\nfunction cmd_render(req) {\r\n\treturn eval2(req, req.$src, true)\r\n\t\t.then(val => {\r\n\t\t\tconst n = getName(req);\r\n\t\t\tif (n !== undefined) {\r\n\t\t\t\treq.scope[p_target][n] = getProxy(val);\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t});\r\n}\r\nfunction cmd_q_render(req, arr, isLast) {\r\n\treturn q_eval2(req, arr, isLast)\r\n\t\t.then(vals => {\r\n\t\t\tconst n = getName(req);\r\n\t\t\tif (n === undefined) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tconst arrLen = arr.length;\r\n\t\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\t\tarr[i].scope[p_target][n] = getProxy(vals[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t});\r\n}\r\n/*\r\nexport default {\r\n\trender(req) {\r\n\t\treturn eval2(req, req.$src, true)\r\n\t\t\t.then(val => {\r\n\t\t\t\tconst n = getName(req);\r\n\t\t\t\tif (n !== undefined) {\r\n\t\t\t\t\treq.scope[p_target][n] = getProxy(val);\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\t},\r\n\tq_render(req, arr, isLast) {\r\n\t\treturn q_eval2(req, arr, isLast)\r\n\t\t\t.then(vals => {\r\n\t\t\t\tconst n = getName(req);\r\n\t\t\t\tif (n === undefined) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\tconst arrLen = arr.length;\r\n\t\t\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\t\t\tarr[i].scope[p_target][n] = getProxy(vals[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\t}\r\n};*/\r\nfunction getName(req) {\r\n\tconst n = req.reqCmd.args[0];\r\n\tif (n !== undefined && n !== \"\") {\r\n\t\treturn kebabToCamelCase(n);\r\n\t}\r\n}\r\n","import {type_animation, type_renderRes} from \"../../render/type.js\";\r\nimport {type_cacheValue, type_cacheCurrent} from \"../../cache/type.js\";\r\nimport {defRequestInit, loadEventName, okEventName, errorEventName, resultDetailName, errorDetailName} from \"../../config/config.js\";\r\nimport {eval2} from \"../../eval2/eval2.js\";\r\nimport {dispatchCustomEvent} from \"../../evt/evt.js\";\r\nimport {getRequest} from \"../../url/url.js\";\r\nimport {type_cmd} from \"../type.js\";\r\n\r\n//my.fetchDefGetError = undefined;//default error handler\r\n\r\nexport default type_cmd(cmd_render, null, null, null, false, false);\r\n\r\nfunction cmd_render(req) {\r\n//console.log(\"fetch\", req);\r\n\treturn eval2(req, req.$src, true)\r\n\t\t.then(val => {\r\n\t\t\tconst r = getRequest(val, \"\");\r\n\t\t\tif (r === null) {\r\n\t\t\t\treturn type_renderRes(true);\r\n\t\t\t}\r\n\t\t\tconst f = r instanceof Response ? getRes(req, r, null) : getFetch(req, r);\r\n\t\t\treq.sync.afterAnimations.add(type_animation(() => f, req.sync.local, 0));\r\n\t\t\treturn null;\r\n\t\t});\r\n}\r\n/*\r\nexport default {\r\n\trender(req) {\r\n//console.log(\"fetch\", req);\r\n\t\treturn eval2(req, req.$src, true)\r\n\t\t\t.then(val => {\r\n\t\t\t\tconst r = getRequest(val, \"\");\r\n\t\t\t\tif (r === null) {\r\n\t\t\t\t\treturn type_renderRes(true);\r\n\t\t\t\t}\r\n\t\t\t\tconst f = r instanceof Response ? getRes(req, r, null) : getFetch(req, r);\r\n\t\t\t\treq.sync.afterAnimations.add(type_animation(() => f, req.sync.local, 0));\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\t}\r\n};*/\r\nfunction getFetch(req, r) {\r\n\tif (req.sync.stat !== 0) {\r\n\t\tclearFetch(req);\r\n\t\treturn;\r\n\t}\r\n\tfor (const n in defRequestInit) {\r\n\t\tif (n === \"headers\") {\r\n\t\t\tfor (const n in defRequestInit.headers) {\r\n\t\t\t\tif (r.headers[n] === undefined) {\r\n\t\t\t\t\tr.headers[n] = defRequestInit.headers[n];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (r[n] === undefined) {\r\n\t\t\tr[n] = defRequestInit[n];\r\n\t\t}\r\n\t}\r\n\treturn fetch(r)\r\n\t\t.then(res => getRes(req, res, null))\r\n\t\t.catch(err => getRes(req, null, err));\r\n}\r\nfunction getRes(req, res, err) {\r\n\tif (req.sync.stat !== 0) {\r\n\t\tclearFetch(req);\r\n\t\treturn;\r\n\t}\r\n\treq.sync.afterAnimations.add(type_animation(() => req.sync.beforeAnimations.add(type_animation(() => {//это нужно для того что бы избежать ситуации, когда ранее уже был загружен и был сет (который вызывает отмену рендера и очистку текущего)\r\n\t\tconst det = type_fetchDetailEvent(res, err);\r\n\t\tif (err !== null) {\r\n\t\t\tdispatchCustomEvent(req.$src, errorEventName, det);\r\n//\t\t\tif (my.fetchDefGetError) {\r\n//\t\t\t\treturn my.fetchDefGetError(det);\r\n//\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdispatchCustomEvent(req.$src, loadEventName, det);\r\n\t\tif (res.ok) {\r\n\t\t\tdispatchCustomEvent(req.$src, okEventName, det);\r\n\t\t}\r\n\t}, req.sync.local, 0)), req.sync.local, 0));\r\n}\r\nfunction clearFetch(req) {\r\n\tif (my.debugLevel !== 0) {\r\n\t\tconsole.info(\"clear fetch => \", req);\r\n\t}\r\n\tconst c = my.env.srcBy$src.get(req.$src).cache;\r\n//\tif (c !== null) {\r\n\t\tc.value = type_cacheValue();//todo тут можно удалять кэш только для дочерних элементов, но так как еще нужно удалить кэш для команд-после, то такой подход оправдан\r\n\t\tc.current = type_cacheCurrent();\r\n//\t}\r\n}\r\nfunction type_fetchDetailEvent(res, err) {\r\n\treturn {\r\n\t\t[resultDetailName]: res,\r\n\t\t[errorDetailName]: err\r\n\t};\r\n}\r\n","import {q_renderTag} from \"../../render/render.js\";\r\nimport {type_req, type_isLast, type_q_arr, type_animation, type_renderRes} from \"../../render/type.js\";\r\nimport {p_target, visibleScreenSize, defIdleCallbackOpt, foreachCmdName, renderPackSize} from \"../../config/config.js\";\r\nimport {type_asOneIdx} from \"../../descr/type.js\";\r\nimport {getNewId, getSrcId, get$els, get$first, getNextStr} from \"../../descr/descr.js\";\r\nimport {type_q$i} from \"../../dom/type.js\";\r\nimport {show, hide, is$visible, removeChild, q_cloneNode, setAsOneIdx, getIdx, setIdx} from \"../../dom/dom.js\";\r\nimport {eval2, q_eval2} from \"../../eval2/eval2.js\";\r\nimport {ocopy} from \"../../oset/oset.js\";\r\nimport {kebabToCamelCase} from \"../../str/str.js\";\r\nimport {type_cmd} from \"../type.js\";\r\n\r\nexport default type_cmd(cmd_render, cmd_q_render, foreach_get$first, cmd_get$els, false, true);\r\n\r\nfunction cmd_render(req) {\r\n\treturn eval2(req, req.$src, true)\r\n\t\t.then(val => foreach_render(req, val));\r\n}\r\nfunction cmd_q_render(req, arr, isLast) {\r\n\treturn q_eval2(req, arr, isLast)\r\n\t\t.then(vals => {\r\n\t\t\tconst arrLen = arr.length,\r\n\t\t\t\tres = new Array(arrLen);\r\n\t\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\t\tres[i] = foreach_render(type_req(arr[i].$src, req.str, req.expr, arr[i].scope, req.sync), vals[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t});\r\n}\r\nfunction cmd_get$els($src, str, expr, pos) {\r\n//todo , expr, pos\r\n\tconst $els = foreach_get$els(foreach_get$first($src, str, expr, pos), str, expr, pos),\r\n\t\t$elsLen = $els.length,\r\n\t\t$ret = [];\r\n\tfor (let i = 0; i < $elsLen; i++) {\r\n\t\tconst $iLen = $els[i].length;\r\n\t\tfor (let j = 0; j < $iLen; j++) {\r\n\t\t\t$ret.push($els[i][j]);\r\n\t\t}\r\n\t}\r\n\treturn $ret;\r\n}\r\n/*\r\nexport default {\r\n\tisAsOne: true,\r\n\tget$els($src, str, expr, pos) {\r\n//todo , expr, pos\r\n\t\tconst $els = foreach_get$els(foreach_get$first($src, str, expr, pos), str, expr, pos),\r\n\t\t\t$elsLen = $els.length,\r\n\t\t\t$ret = [];\r\n\t\tfor (let i = 0; i < $elsLen; i++) {\r\n\t\t\tconst $iLen = $els[i].length;\r\n\t\t\tfor (let j = 0; j < $iLen; j++) {\r\n\t\t\t\t$ret.push($els[i][j]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn $ret;\r\n\t},\r\n\tget$first: foreach_get$first,\r\n//\tget$first($src, str, expr, pos) {\r\n//\t\treturn foreach_get$first($src, str, expr, pos);\r\n//\t},\r\n\trender(req) {\r\n\t\treturn eval2(req, req.$src, true)\r\n\t\t\t.then(val => foreach_render(req, val));\r\n\t},\r\n\tq_render(req, arr, isLast) {\r\n\t\treturn q_eval2(req, arr, isLast)\r\n\t\t\t.then(vals => {\r\n\t\t\t\tconst arrLen = arr.length,\r\n\t\t\t\t\tres = new Array(arrLen);\r\n\t\t\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\t\t\tres[i] = foreach_render(type_req(arr[i].$src, req.str, req.expr, arr[i].scope, req.sync), vals[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn res;\r\n\t\t\t});\r\n\t}\r\n};*/\r\nfunction foreach_render(req, val) {\r\n//console.error(\"_for\", req.sync.syncId, req, req.$src);\r\n//alert(1);\r\n//if (self.a && req.expr === 'game.log') {\r\n//\tconsole.log(req, val);\r\n//\talert(1);\r\n//}\r\n\tconst srcBy$src = my.env.srcBy$src,\r\n\t\tsrc = srcBy$src.get(req.$src);\r\n\tif (src.asOneIdx === null) {\r\n\t\tsrc.asOneIdx = type_asOneIdx();\r\n\t}\r\n\tif (!src.asOneIdx.has(req.str)) {\r\n\t\tsetAsOneIdx(src, req.str, getNewId());\r\n\t\tsetIdx(src, req.str, 0);\r\n\t}\r\n\tconst ctx = getCtx(req, val),\r\n\t\telsLen = ctx.els.length,\r\n\t\tkeysLen = ctx.keys.length,\r\n\t\tl = ctx.els[elsLen - 1].$els,\r\n\t\t$last = l[l.length - 1];\r\n\tif (keysLen === 0) {\r\n\t\tshow$first(req, ctx, hide);\r\n\t\treq.sync.animations.add(type_animation(() => {\r\n\t\t\tfor (let j, i = elsLen - 1; i > 0; i--) {\r\n\t\t\t\tconst $elsI = ctx.els[i].$els;\r\n\t\t\t\tfor (j = $elsI.length - 1; j > -1; j--) {\r\n\t\t\t\t\tremoveChild($elsI[j]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, req.sync.local, 0));\r\n\t\treturn type_renderRes(true, null, $last);\r\n\t}\r\n//console.error(\"for ctx\", ctx.els, ctx, req);\r\n//alert(2);\r\n\tconst res = type_renderRes(true, null, $last);\r\n\tif (elsLen === 1) {//todo подумать об этом\r\n\t\tconst $e0 = ctx.els[0].$els;\r\n//\t\tif ($e00.nodeName === \"TEMPLATE\" && $e00.getAttribute(hideName) !== null) {\r\n\t\tfor (let $j = $e0[0];; $j = $j.nextSibling) {\r\n//\t\t\tif ($j.nodeType !== 1) {//впринципе можно и убрать\r\n//\t\t\t\tbreak;\r\n//\t\t\t}\r\n\t\t\tconst jSrc = srcBy$src.get($j);\r\n\t\t\tif (jSrc === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (!jSrc.isHide) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tshow$first(req, ctx, show);\r\n\t\t\tfor (let j = $e0.length - 1; j > -1; j--) {\r\n\t\t\t\t$e0[j] = $e0[j].content.firstChild;\r\n\t\t\t}\r\n\t\t\treq.sync.afterAnimations.add(type_animation(() => q_forRender(req, ctx, ctx.els, elsLen < keysLen ? () => q_add(req, ctx) : null), req.sync.local, 0));\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n\tif (elsLen === keysLen) {\r\n\t\tconst p = q_forRender(req, ctx, ctx.els, null);\r\n\t\treturn p === undefined ? res : p\r\n\t\t\t.then(() => res);\r\n\t}\r\n\tif (elsLen < keysLen) {\r\n\t\tconst p = q_forRender(req, ctx, ctx.els, () => q_add(req, ctx));\r\n\t\treturn p === undefined ? res : p\r\n\t\t\t.then(() => res);\r\n\t}\r\n\tconst toRem = new Set();\r\n//\tfor (let i = elsLen - 1; i >= keysLen; i--) {\r\n//\t\tfor (let j = ctx.els[i].length - 1; j > -1; j--) {\r\n\tfor (let i = keysLen; i < elsLen; i++) {\r\n\t\tconst l = ctx.els[i].$els.length,\r\n\t\t\t$elsI = ctx.els[i].$els;\r\n\t\tfor (let j = 0; j < l; j++) {\r\n\t\t\ttoRem.add($elsI[j]);\r\n\t\t}\r\n\t}\r\n\tctx.els.splice(keysLen, elsLen - keysLen);\r\n\treq.sync.animations.add(type_animation(() => { \r\n\t\tfor (const $i of toRem) {\r\n\t\t\tremoveChild($i);\r\n\t\t}\r\n\t}, req.sync.local, 0));\r\n\treq.sync.afterAnimations.add(type_animation(() => q_forRender(req, ctx, ctx.els, null), req.sync.local, 0));\r\n\treturn res;\r\n/*\r\n\tconst p = q_forRender(req, ctx);\r\n\treturn p === null ? res : p\r\n\t\t.then(() => {\r\n\t\t\treq.sync.animations.add(type_animation(() => { \r\n\t\t\t\tfor (const $i of toRem) {\r\n\t\t\t\t\tremoveChild($i);\r\n\t\t\t\t}\r\n\t\t\t}, req.sync.local, 0));\r\n\t\t\treturn res;\r\n\t\t});*/\r\n}\r\nfunction getCtx(req, val) {\r\n\tconst pos = -1,//нужно было бы запускать с нулевого элемента для получения кэша - эта задача режается в функции получения кэша\r\n\t\t$first = foreach_get$first(req.$src, req.str, req.expr, pos),\r\n\t\t$els = foreach_get$els($first, req.str, req.expr, pos),\r\n\t\tvalName = kebabToCamelCase(req.reqCmd.args[0]),\r\n\t\tkeyName = kebabToCamelCase(req.reqCmd.args[1]);\r\n\tif (!val) {\r\n\t\treturn type_ctx([], [], $els, valName, keyName);\r\n\t}\r\n\tif (Array.isArray(val)) {\r\n\t\tconst len = val.length,\r\n\t\t\tkeys =new Array(len);\r\n\t\tfor (let i = 0; i < len; i++) {\r\n\t\t\tkeys[i] = i;\r\n\t\t}\r\n\t\treturn type_ctx(keys, val, $els, valName, keyName);\r\n\t}\r\n\tif (val instanceof Set || val instanceof Map) {\r\n\t\tconst keys = new Array(val.size),\r\n\t\t\tarr = new Array(val.size);\r\n\t\tlet i = 0;\r\n\t\tfor (const [k, v] of val.entries()) {\r\n\t\t\tkeys[i] = k;\r\n\t\t\tarr[i++] = v;\r\n\t\t}\r\n\t\treturn type_ctx(keys, arr, $els, valName, keyName);\r\n\t}\r\n\tconst keys = [],\r\n\t\tarr = [];\r\n\tfor (const key in val) {\r\n\t\tkeys.push(key);\r\n\t\tarr.push(val[key]);\r\n\t}\r\n\treturn type_ctx(keys, arr, $els, valName, keyName);\r\n}\r\nfunction type_ctx(keys, value, $els, valName, keyName) {\r\n\tconst $elsLen = $els.length,\r\n\t\tels = new Array($elsLen);\r\n\tfor (let i = 0; i < $elsLen; i++) {\r\n\t\tels[i] = type_q$i($els[i], i);\r\n\t}\r\n\treturn {\r\n\t\tkeys,\r\n\t\tvalue,\r\n\t\tels,\r\n\t\tvalName,\r\n\t\tkeyName\r\n\t};\r\n}\r\nfunction show$first(req, ctx, showFunc) {\r\n\tconst first$els = ctx.els[0].$els,\r\n\t\tfirst$elsLen = first$els.length;\r\n//\tfor (let j = first$elsLen - 1; j > -1; j--) {\r\n\tfor (let j = 0; j < first$elsLen; j++) {\r\n\t\tshowFunc(req, first$els[j]);\r\n\t}\r\n}\r\nfunction foreach_get$first($first, str, expr, pos) {\r\n\tconst srcBy$src = my.env.srcBy$src;\r\n\tfor (let $i = $first; $i !== null; $i = $i.previousSibling) {\r\n\t\tconst iSrc = srcBy$src.get($i);\r\n\t\tif (iSrc === undefined || !iSrc.isCmd) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (iSrc.asOneIdx === null) {\r\n\t\t\treturn $first;\r\n\t\t}\r\n\t\tconst nStr = getNextStr(iSrc, str),\r\n\t\t\tasOneIdx = iSrc.asOneIdx.get(str);\r\n\t\t$first = nStr !== \"\" ? get$first($i, iSrc.descr.get$elsByStr, nStr) : $i;\r\n\t\tfor ($i = $first.previousSibling; $i !== null; $i = $i.previousSibling) {\r\n\t\t\tconst iSrc = srcBy$src.get($i);\r\n\t\t\tif (iSrc === undefined || !iSrc.isCmd) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (iSrc.asOneIdx === null || iSrc.asOneIdx.get(str) !== asOneIdx) {\r\n\t\t\t\treturn $first;\r\n\t\t\t}\r\n\t\t\tif (nStr === \"\") {\r\n\t\t\t\t$first = $i;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t$first = $i = get$first($i, iSrc.descr.get$elsByStr, nStr);\r\n\t\t}\r\n\t\treturn $first;\r\n\t}\r\n\tthrow new Error(\"foreach.js\");\r\n}\r\nfunction foreach_get$els($e, str, expr, pos) {\r\n\tconst srcBy$src = my.env.srcBy$src;\r\n\tfor (let $i = $e; $i !== null; $i = $i.nextSibling) {\r\n\t\tconst iSrc = srcBy$src.get($i);\r\n\t\tif (iSrc === undefined || !iSrc.isCmd) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (iSrc.asOneIdx === null) {//if foreach\r\n\t\t\treturn [[$e]];\r\n\t\t}\r\n\t\tconst nStr = getNextStr(iSrc, str),\r\n\t\t\tasOneIdx = iSrc.asOneIdx.get(str),\r\n\t\t\t$els = [];\r\n\t\tdo {\r\n\t\t\tif (nStr !== \"\") {\r\n\t\t\t\tconst $e = $els[$els.push(get$els($i, iSrc.descr.get$elsByStr, nStr)) - 1];\r\n\t\t\t\t$i = $e[$e.length - 1];\r\n\t\t\t} else {\r\n\t\t\t\t$els.push([$i]);\r\n\t\t\t}\r\n\t\t\tfor ($i = $i.nextSibling; $i !== null; $i = $i.nextSibling) {\r\n\t\t\t\tconst iSrc = srcBy$src.get($i);\r\n\t\t\t\tif (iSrc === undefined || !iSrc.isCmd) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (iSrc.asOneIdx === null || iSrc.asOneIdx.get(str) !== asOneIdx) {\r\n\t\t\t\t\treturn $els;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} while ($i !== null);\r\n\t\treturn $els;\r\n\t}\r\n\tthrow new Error(\"foreach.js\");\r\n}\r\nfunction q_add(req, ctx) {\r\n\tconst elsLen = ctx.els.length,\r\n\t\tkeysLen = ctx.keys.length,\r\n\t\tfrom = ctx.els[elsLen - 1],\r\n\t\tfrom$elsLen = from.$els.length,\r\n//\t\tfrom$last = from.$els[from$elsLen - 1],\r\n\t\tidx = elsLen;\r\n\tlet viewSize = 0,//todo расположение можжет быть и горизонтальным, тогда будем рендерить по одной* штуке\r\n\t\tsId = 0;\r\n\tfor (let j = 0; j < from$elsLen; j++) {\r\n\t\tconst $j = from.$els[j],\r\n\t\t\tiSrc = my.env.srcBy$src.get($j);\r\n\t\tif (sId === 0 && iSrc !== undefined) {\r\n\t\t\tsId = iSrc.id;\r\n\t\t}\r\n\t\tif ($j.nodeType === 1) {\r\n\t\t\tviewSize += $j.offsetHeight;\r\n\t\t}\r\n\t}\r\n//\tif (sId === 0) {\r\n//\t\tthrow new Error(\"foreach.js\");\r\n//\t}\r\n\tconst step = viewSize !== 0 ? Math.ceil(document.scrollingElement.clientHeight * visibleScreenSize / viewSize) : renderPackSize;\r\n//\tif (is$visible(from$last)) {\r\n\tif (is$visible(from.$els[from$elsLen - 1])) {\r\n\t\treq.sync.animations.add(type_animation(() => q_addInsert(req, ctx, getSrcId(req.sync.local, sId), keysLen, idx, step), req.sync.local, 0));//!! нельзя не вставить этот элементи двигасться дальше, так что если даже на момент отрисовки его не будет видно, его всё рано нужно вставить\r\n\t\treturn;\r\n\t}\r\n\treq.sync.afterAnimations.add(type_animation(() => q_addDeferred(req, ctx, sId, keysLen, idx, step), req.sync.local, 0));\r\n}\r\nfunction q_addDeferred(req, ctx, sId, keysLen, idx, step) {\r\n\treturn new Promise(ricResolve => {//обязательно нужден проимс\r\n\t\tconst ricId = requestIdleCallback(() => {\r\n\t\t\treq.sync.idleCallback.delete(ricId);\r\n\t\t\treq.sync.animations.add(type_animation(() => q_addInsert(req, ctx, getSrcId(req.sync.local, sId), keysLen, idx, step), req.sync.local, sId));\r\n\t\t\tricResolve();\r\n\t\t}, defIdleCallbackOpt);\r\n\t\treq.sync.idleCallback.set(ricId, ricResolve);\r\n\t});\r\n}\r\nfunction q_addInsert(req, ctx, sId, keysLen, idx, step) {\r\n\tconst $fr = my.document.createDocumentFragment(),\r\n\t\tnewEls = q_addI(req, sId, $fr, keysLen, idx, step),//!!перенесли в аницации, что бы дать возможнасть отрисовать всё перед клонированием\r\n\t\tnewElsLen = newEls.length,\r\n//\t\t$last = get$last(req, from$last, idx - 1);\r\n\t\t$last = get$last(req, my.env.$srcById.get(sId), idx - 1);\r\n\tidx += newElsLen;\r\n\tif (idx >= keysLen) {\r\n/*\r\n//todo\r\nif (!$last.parentNode) {\r\n\tconsole.error(req, ctx, sId, keysLen, idx, step, $last);\r\n}*/\r\n\t\t$last.parentNode.insertBefore($fr, $last.nextSibling);\r\n\t\treq.sync.afterAnimations.add(type_animation(() => q_forRenderI(req, ctx, newEls), req.sync.local, 0));\r\n\t\treturn;\r\n\t}\r\n\tconst newElsLast$els = newEls[newElsLen - 1].$els,\r\n\t\tsrcBy$src = my.env.srcBy$src;\r\n\tfor (let $i = newElsLast$els[newElsLast$els.length - 1]; $i !== null; $i = $i.previousSibling) {\r\n\t\tconst iSrc = srcBy$src.get($i);\r\n\t\tif (iSrc === undefined) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tsId = iSrc.id;\r\n\t\t$last.parentNode.insertBefore($fr, $last.nextSibling);\r\n\t\treq.sync.afterAnimations.add(type_animation(() => q_forRenderI(req, ctx, newEls)\r\n\t\t\t.then(() => q_addDeferred(req, ctx, sId, keysLen, idx, step)), req.sync.local, 0));\r\n\t\treturn;\r\n\t}\r\n\tthrow new Error(\"foreach.js\");\r\n}\r\nfunction get$last(req, $last, lastIdx) {\r\n\tconst srcBy$src = my.env.srcBy$src,\r\n\t\tasOneIdx = srcBy$src.get($last).asOneIdx.get(req.str),\r\n\t\t$els = get$els($last, srcBy$src.get($last).descr.get$elsByStr, req.str);\r\n\t$last = $els[$els.length - 1];\r\n\tfor (let $i = $last.nextSibling; $i !== null; $i = $i.nextSibling) {\r\n\t\tconst iSrc = srcBy$src.get($i);\r\n\t\tif (iSrc === undefined || !iSrc.isCmd) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (iSrc.asOneIdx === null || iSrc.asOneIdx.get(req.str) !== asOneIdx || getIdx(iSrc, req.str) !== lastIdx) {\r\n\t\t\treturn $last;\r\n\t\t}\r\n\t\tconst $els = get$els($i, srcBy$src.get($i).descr.get$elsByStr, req.str);\r\n\t\t$last = $els[$els.length - 1];\r\n\t}\r\n\treturn $last;\r\n}\r\n/*\r\nfunction get$last(req, $last, lastIdx) {\r\n\tconst asOneIdx = my.env.srcBy$src.get($last).asOneIdx.get(req.str);\r\n\tfor (let $i = $last.nextSibling; $i !== null; $i = $i.nextSibling) {\r\n\t\tconst iSrc = my.env.srcBy$src.get($i);\r\n\t\tif (iSrc === undefined || !iSrc.isCmd) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (iSrc.asOneIdx === null || iSrc.asOneIdx.get(req.str) !== asOneIdx || getIdx(iSrc, req.str) !== lastIdx) {\r\n\t\t\treturn $last;\r\n\t\t}\r\n\t\t$last = $i;\r\n\t}\r\n\treturn $last;\r\n}*/\r\nfunction q_addI(req, sId, $fr, keysLen, idx, step) {\r\n\tconst len = idx + step > keysLen ? keysLen - idx : step,\r\n\t\tnewEls = q_cloneNode(req, sId, idx, len),\r\n\t\t$elsILen = newEls[0].$els.length;\r\n\tfor (let j, i = 0; i < len; i++) {\r\n\t\tconst $elsI = newEls[i].$els;\r\n\t\tfor (j = 0; j < $elsILen; j++) {\r\n\t\t\t$fr.appendChild($elsI[j]);\r\n\t\t}\r\n\t}\r\n//console.log(222, sId, $new, req.str);\r\n//alert(1);\r\n\treturn newEls;\r\n}\r\nfunction q_forRender(req, ctx, els, addF) {\r\n\tconst nows = [],\r\n\t\tdeferreds = [],\r\n\t\telsLen = els.length;\r\n\tif (!req.sync.renderParam.isLinking) {\r\n\t\tfor (let i = 0; i < elsLen; i++) {\r\n\t\t\tconst elsI = els[i],\r\n\t\t\t\t$elsI = elsI.$els,\r\n\t\t\t\tl = $elsI.length;\r\n\t\t\tlet f = false;\r\n\t\t\tfor (let j = 0; j < l; j++) {\r\n\t\t\t\tif (is$visible($elsI[j])) {\r\n\t\t\t\t\tf = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (f) {\r\n\t\t\t\tnows.push(elsI);\r\n\t\t\t} else {\r\n\t\t\t\tdeferreds.push(elsI);\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tfor (let i = 0; i < elsLen; i++) {\r\n\t\t\tnows.push(els[i]);\r\n\t\t}\r\n\t}\r\n\tif (nows.length !== 0) {\r\n//console.log(1, nows)\r\n\t\treturn q_forRenderI(req, ctx, nows)\r\n\t\t\t.then(() => {\r\n\t\t\t\tif (deferreds.length !== 0) {\r\n\t\t\t\t\treq.sync.afterAnimations.add(type_animation(() => q_forRender(req, ctx, deferreds, addF), req.sync.local, 0));\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (addF !== null) {\r\n\t\t\t\t\taddF();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t}\r\n//console.log(2, deferreds)\r\n\treturn new Promise(ricResolve => {\r\n\t\tconst ricId = requestIdleCallback(() => {\r\n\t\t\treq.sync.idleCallback.delete(ricId);\r\n\t\t\tq_forRenderI(req, ctx, deferreds.splice(0, renderPackSize))\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tif (deferreds.length !== 0) {\r\n\t\t\t\t\t\treturn q_forRender(req, ctx, deferreds, addF)\r\n\t\t\t\t\t\t\t.then(ricResolve);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (addF !== null) {\r\n\t\t\t\t\t\taddF();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tricResolve();\r\n\t\t\t\t});\r\n\t\t});\r\n\t\treq.sync.idleCallback.set(ricId, ricResolve);\r\n\t}, defIdleCallbackOpt);\r\n/*\r\n\r\n\r\n\r\n//console.error(nowsIdxs, deferredsIdxs);\r\n//alert(1);\r\n\tif (deferredsIdxs.size !== 0) {\r\n\t\tq_forRenderAddDeferredI(req, ctx, $deferreds, deferredsIdxs, 0, addF);\r\n\t\tif (nowsIdxs.size !== 0) {\r\n\t\t\treturn q_forRenderI(req, ctx, $nows, nowsIdxs);\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\tif (nowsIdxs.size === 0) {\r\n\t\treturn;\r\n\t}\r\n\treturn q_forRenderI(req, ctx, $nows, nowsIdxs)\r\n\t\t.then(() => {\r\n\t\t\tif (addF !== null) {\r\n\t\t\t\taddF();\r\n\t\t\t}\r\n\t\t});*/\r\n}\r\n/*\r\nfunction q_forRenderAddDeferredI(req, ctx, $deferreds, deferredsIdxs, i, addF) {\r\n\treq.sync.afterAnimations.add(type_animation(() => new Promise(ricResolve => {\r\n\t\tconst ricId = requestIdleCallback(() => {\r\n\t\t\treq.sync.idleCallback.delete(ricId);\r\n\t\t\tconst idxs = new Set(),\r\n\t\t\t\ts = i,\r\n\t\t\t\t$defLen = $deferreds.length;\r\n\t\t\tlet c = 0;\r\n\t\t\tfor (const idx of deferredsIdxs) {\r\n\t\t\t\tidxs.add(idx);\r\n\t\t\t\tdeferredsIdxs.delete(idx);\r\n\t\t\t\ti++;\r\n\t\t\t\tc++;\r\n\t\t\t\tif (c === renderPackSize || i === $defLen) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst isF = i < $defLen;\r\n\t\t\tq_forRenderI(req, ctx, $deferreds.slice(s, s + c), idxs)\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tif (!isF && addF !== null) {\r\n\t\t\t\t\t\taddF();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tricResolve();\r\n\t\t\t\t});\r\n\t\t\tif (isF) {\r\n\t\t\t\tq_forRenderAddDeferredI(req, ctx, $deferreds, deferredsIdxs, i, addF);\r\n\t\t\t}\r\n\t\t}, defIdleCallbackOpt);\r\n\t\treq.sync.idleCallback.set(ricId, ricResolve);\r\n\t}), req.sync.local, 0));\r\n}*/\r\nfunction q_forRenderI(req, ctx, els) {//!!idxs необходим для разделение на текущие и отложенные рендеры\r\n\tconst arrLen = els.length,\r\n\t\tarr = new Array(arrLen),\r\n\t\tsrcBy$src = my.env.srcBy$src;\r\n\tfor (let $i, j, i = 0; i < arrLen; i++) {\r\n//\tlet $i, j, i = 0;\r\n//\tfor (const idx of idxs) {\r\n\t\tconst elsI = els[i],\r\n\t\t\t$elsI = elsI.$els,\r\n\t\t\t$elsILen = $elsI.length;\r\n\t\t$i = $elsI[0];\r\n\t\tif (!srcBy$src.has($i)) {\r\n\t\t\tj = 1;\r\n\t\t\tdo {\r\n\t\t\t\t$i = $elsI[j++];\r\n//todo - так может получиться если удалить элемент, который ренджерится из дом-а\r\n//\t\t\t\tif ($i === undefined) {\r\n//\t\t\t\t\tconsole.warn(22323432, req, ctx, els, j);\r\n//\t\t\t\t\talert(1)\r\n//\t\t\t\t}\r\n\t\t\t} while (!srcBy$src.has($i));// && j < $elsILen);//!!то что в $elsI может отсутствовать команда - проверено на этапе q_add\r\n\t\t}\r\n//todo не медленно ли это?\r\n\t\tconst scopeI = ocopy(req.scope),\r\n\t\t\tidx = elsI.idx;\r\n\t\tif (ctx.valName) {\r\n\t\t\tscopeI[ctx.valName] = ctx.value[idx];\r\n\t\t}\r\n\t\tif (ctx.keyName) {\r\n\t\t\tscopeI[ctx.keyName] = ctx.keys[idx];\r\n\t\t}\r\n\t\tarr[i] = type_q_arr($i, scopeI);\r\n\t}\r\n//console.log(555, arr, req.str);\r\n//todo  нужно переносить на стр - атрибуты мешаю рендерить фор->инк (1)\r\n\treturn q_renderTag(arr, req.str, type_isLast(), req.sync);\r\n}\r\n","﻿import {type_animation} from \"../../render/type.js\";\r\nimport {eval2, q_eval2} from \"../../eval2/eval2.js\";\r\nimport {type_cmd} from \"../type.js\";\r\n\r\nexport default type_cmd(cmd_render, cmd_q_render, null, null, true, false);\r\n\r\nfunction cmd_render(req) {\r\n\treturn eval2(req, req.$src, true)\r\n\t\t.then(val => {\r\n\t\t\thtml_render(req, req.$src, val);\r\n\t\t\treturn null;\r\n\t\t});\r\n}\r\nfunction cmd_q_render(req, arr, isLast) {\r\n\treturn q_eval2(req, arr, isLast)\r\n\t\t.then(vals => {\r\n\t\t\tconst arrLen = arr.length;\r\n\t\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\t\thtml_render(req, arr[i].$src, vals[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t});\r\n}\r\n/*\r\nexport default {\r\n\tisCustomHtml: true,\r\n\trender(req) {\r\n\t\treturn eval2(req, req.$src, true)\r\n\t\t\t.then(val => {\r\n\t\t\t\thtml_render(req, req.$src, val);\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\t},\r\n\tq_render(req, arr, isLast) {\r\n\t\treturn q_eval2(req, arr, isLast)\r\n\t\t\t.then(vals => {\r\n\t\t\t\tconst arrLen = arr.length;\r\n\t\t\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\t\t\thtml_render(req, arr[i].$src, vals[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\t}\r\n};*/\r\nfunction html_render(req, $src, val) {\r\n//\tconst c = getCacheBySrcId($src[p_srcId]),\r\n\tconst c = my.env.srcBy$src.get($src).cache;\r\n\tif (req.sync.renderParam.isLinking) {\r\n\t\tc.current.set(req.str, val);\r\n\t\treturn;\r\n\t}\r\n\tif (val === c.current.get(req.str)) {\r\n\t\treturn;\r\n\t}\r\n\treq.sync.animations.add(type_animation(() => {\r\n\t\tc.current.set(req.str, val);\r\n\t\tconst m = req.reqCmd.args[0];\r\n\t\tif (m !== undefined && m !== \"\") {\r\n\t\t\t$src.textContent = val;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t$src.innerHTML = val;\r\n\t}, req.sync.local, my.env.srcBy$src.get($src).id));\r\n}\r\n","import {renderTag} from \"../../render/render.js\";\r\nimport {type_req, type_animation, type_renderRes} from \"../../render/type.js\";\r\nimport {p_target, ifCmdName, elseifCmdName, elseCmdName, switchCmdName, caseCmdName, defaultCmdName, foreachCmdName, incCmdName} from \"../../config/config.js\";\r\nimport {getAttrAfter, get$els, get$first, getNextStr} from \"../../descr/descr.js\";\r\nimport {show, hide, getIdx} from \"../../dom/dom.js\";\r\nimport {getErr} from \"../../err/err.js\";\r\nimport {eval2, q_eval2} from \"../../eval2/eval2.js\";\r\nimport {ocopy, srcSetScope} from \"../../oset/oset.js\";\r\nimport {getProxy} from \"../../proxy/proxy.js\";\r\nimport {kebabToCamelCase} from \"../../str/str.js\";\r\nimport {type_cmd} from \"../type.js\";\r\n\r\nexport const ifCmd = type_cmd(ifCmd_render, ifCmd_q_render, ifCmd_get$first, ifCmd_get$els, false, false);\r\nexport const switchCmd = type_cmd(switchCmd_render, null, switchCmd_get$first, switchCmd_get$els, false, false);\r\n\r\nfunction ifCmd_render(req) {\r\n//console.log(\"if\", req);\r\n//alert(1);\r\n\tmake$first(req, ifCmdName, elseifCmdName, elseCmdName);\r\n\treturn eval2(req, req.$src, true)\r\n\t\t.then(val => if_render(req, val, ifCmdName, elseifCmdName, elseCmdName));\r\n/*\r\n.then(async val => {\r\n\tconst r = await if_render(req, val, ifCmdName, elseifCmdName, elseCmdName);\r\n\tconsole.log(\"ifres\", req.str, req.expr, val, r, req);\r\n\talert(1);\r\n\treturn r;\r\n});*/\r\n}\r\nfunction ifCmd_q_render(req, arr, isLast) {\r\n\tlet i = 0;\r\n\twhile (isLast.has(i)) {\r\n\t\ti++;\r\n\t}\r\n\tconst arrLen = arr.length;\r\n\tif (i === arrLen) {\r\n\t\treturn null;\r\n\t}\r\n\t//так как иф при ку-рендере может быть только сингл, то можно не задумываться про то что в req\r\n\treturn q_eval2(req, arr, isLast)\r\n\t\t.then(val => {\r\n\t\t\tconst res = new Array(arrLen);\r\n\t\t\tdo {\r\n\t\t\t\tconst reqI = type_req(arr[i].$src, req.str, req.expr, arr[i].scope, req.sync);\r\n\t\t\t\tmake$first(reqI, ifCmdName, elseifCmdName, elseCmdName);\r\n\t\t\t\tres[i] = if_render(reqI, val[i], ifCmdName, elseifCmdName, elseCmdName);\r\n\t\t\t\twhile (isLast.has(++i));\r\n\t\t\t\tif (i === arrLen) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} while (true);\r\n\t\t\treturn res;\r\n\t\t});\r\n}\r\nfunction ifCmd_get$first($src, str, expr, pos) {\r\n\treturn if_get$first(ifCmdName, elseifCmdName, elseCmdName, $src, str, expr, pos);\r\n}\r\nfunction ifCmd_get$els($src, str, expr, pos) {\r\n\treturn if_get$els(ifCmdName, elseifCmdName, elseCmdName, $src, str, expr, pos);\r\n}\r\n\r\nfunction switchCmd_render(req) {\r\n//console.log(\"switch\", req);\r\n\tmake$first(req, switchCmdName, caseCmdName, defaultCmdName);\r\n\tlet f = true;\r\n\tfor (const [n, v] of my.env.srcBy$src.get(req.$src).descr.attr) {\r\n\t\tif (f) {\r\n\t\t\tif (n === req.str) {\r\n\t\t\t\tf = false;\r\n\t\t\t}\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tconst rc = my.env.reqCmd.get(n);\r\n\t\tif (rc.cmdName !== caseCmdName) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\treturn eval2(req, req.$src, true)\r\n\t\t\t.then(expression => {\r\n\t\t\t\treq.reqCmd = rc;\r\n\t\t\t\treq.str = n;\r\n\t\t\t\treq.expr = v;\r\n\t\t\t\treturn eval2(req, req.$src, true)\r\n\t\t\t\t\t.then(val => if_render(req, val, switchCmdName, caseCmdName, defaultCmdName, f => f === expression));\r\n/*\r\n.then(async val => {\r\n\tconst r = await if_render(req, val, switchCmdName, caseCmdName, defaultCmdName, f => f === expression);\r\n\tconsole.log(\"witch-res\", expression, req.str, req.expr, val, r, req);\r\n\talert(1);\r\n\treturn r;\r\n});*/\r\n\t\t\t});\r\n\t}\r\n\tthrow getErr(new Error(\">>>mw switch:01:Invalide structure: case-cmmand not found\"), req.$src, req);\r\n}\r\n//q_render для swicha не нужен - ку-рендер нжен для циклов\r\nfunction switchCmd_get$first($src, str, expr, pos) {\r\n\treturn if_get$first(switchCmdName, caseCmdName, defaultCmdName, $src, str, expr, pos);\r\n}\r\nfunction switchCmd_get$els($src, str, expr, pos) {\r\n\treturn if_get$els(switchCmdName, caseCmdName, defaultCmdName, $src, str, expr, pos);\r\n}\r\n\r\n\r\n\r\n/*\r\nexport const ifCmd = {\r\n\tget$els($src, str, expr, pos) {\r\n\t\treturn if_get$els(ifCmdName, elseifCmdName, elseCmdName, $src, str, expr, pos);\r\n\t},\r\n\tget$first($src, str, expr, pos) {\r\n\t\treturn if_get$first(ifCmdName, elseifCmdName, elseCmdName, $src, str, expr, pos);\r\n\t},\r\n\trender(req) {\r\n//console.log(\"if\", req);\r\n//alert(1);\r\n\t\tmake$first(req, ifCmdName, elseifCmdName, elseCmdName);\r\n\t\treturn eval2(req, req.$src, true)\r\n\t\t\t.then(val => if_render(req, val, ifCmdName, elseifCmdName, elseCmdName));\r\n//.then(async val => {\r\n//\tconst r = await if_render(req, val, ifCmdName, elseifCmdName, elseCmdName);\r\n//\tconsole.log(\"ifres\", req.str, req.expr, val, r, req);\r\n//\talert(1);\r\n//\treturn r;\r\n//});\r\n\t},\r\n\tq_render(req, arr, isLast) {\r\n\t\tlet i = 0;\r\n\t\twhile (isLast.has(i)) {\r\n\t\t\ti++;\r\n\t\t}\r\n\t\tconst arrLen = arr.length;\r\n\t\tif (i === arrLen) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn q_eval2(req, arr, isLast)\r\n\t\t\t.then(val => {\r\n\t\t\t\tconst res = new Array(arrLen);\r\n\t\t\t\tdo {\r\n\t\t\t\t\tconst reqI = type_req(arr[i].$src, req.str, req.expr, arr[i].scope, req.sync);\r\n\t\t\t\t\tmake$first(reqI, ifCmdName, elseifCmdName, elseCmdName);\r\n\t\t\t\t\tres[i] = if_render(reqI, val[i], ifCmdName, elseifCmdName, elseCmdName);\r\n\t\t\t\t\twhile (isLast.has(++i));\r\n\t\t\t\t\tif (i === arrLen) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t} while (true);\r\n\t\t\t\treturn res;\r\n\t\t\t});\r\n\t}\r\n};\r\nexport const switchCmd = {\r\n\tget$els($src, str, expr, pos) {\r\n\t\treturn if_get$els(switchCmdName, caseCmdName, defaultCmdName, $src, str, expr, pos);\r\n\t},\r\n\tget$first($src, str, expr, pos) {\r\n\t\treturn if_get$first(switchCmdName, caseCmdName, defaultCmdName, $src, str, expr, pos);\r\n\t},\r\n\trender(req) {\r\n//console.log(\"switch\", req);\r\n\t\tmake$first(req, switchCmdName, caseCmdName, defaultCmdName);\r\n\t\tlet f = true;\r\n\t\tfor (const [n, v] of my.env.srcBy$src.get(req.$src).descr.attr) {\r\n\t\t\tif (f) {\r\n\t\t\t\tif (n === req.str) {\r\n\t\t\t\t\tf = false;\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tconst rc = my.env.reqCmd.get(n);\r\n\t\t\tif (rc.cmdName !== caseCmdName) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\treturn eval2(req, req.$src, true)\r\n\t\t\t\t.then(expression => {\r\n\t\t\t\t\treq.reqCmd = rc;\r\n\t\t\t\t\treq.str = n;\r\n\t\t\t\t\treq.expr = v;\r\n\t\t\t\t\treturn eval2(req, req.$src, true)\r\n\t\t\t\t\t\t.then(val => if_render(req, val, switchCmdName, caseCmdName, defaultCmdName, f => f === expression));\r\n//.then(async val => {\r\n//\tconst r = await if_render(req, val, switchCmdName, caseCmdName, defaultCmdName, f => f === expression);\r\n//\tconsole.log(\"witch-res\", expression, req.str, req.expr, val, r, req);\r\n//\talert(1);\r\n//\treturn r;\r\n//});\r\n\t\t\t\t});\r\n\t\t}\r\n\t\tthrow getErr(new Error(\">>>mw switch:01:Invalide structure: case-cmmand not found\"), req.$src, req);\r\n\t}//,\r\n//todo\tq_render(req, arr, isLast) {}\r\n};*/\r\n\r\n\r\n//1) прдполагается что если первый скрыт то и все такие же скрыты - и наоборот\r\n//2) !!: !$i[p_descrId] - это коммент, текст или когда template  и в нем скрыта тектовая нода\r\n//3) в этом алгоритме нет проверки на эдентичность условий (предполлагается, что если они есть, то дожны быть правильными - так как такого рода ошибка может быть в серверном рендеренге - и это точно ошибка)\r\nasync function if_render(req, val, ifCmdName, elseifCmdName, elseCmdName, testFunc = f => f) {//, str) {\r\n\tconst srcBy$src = my.env.srcBy$src,\r\n\t\tpSrc = srcBy$src.get(req.$src.parentNode),\r\n\t\tpScope = pSrc !== undefined ? pSrc.scopeCache : {},\r\n\t\treqI = type_req(req.$src, req.str, req.expr, srcSetScope(srcBy$src.get(req.$src), pScope), req.sync);\r\n\tlet isTrue = testFunc(val);\r\n\tif (isTrue) {\r\n\t\tconst valName = reqI.reqCmd.args[0];\r\n\t\tif (valName !== undefined && valName !== \"\") {\r\n\t\t\treqI.scope[p_target][kebabToCamelCase(valName)] = getProxy(val);\r\n\t\t}\r\n\t}\r\n\tlet [$last, $attr, attrStr] = makeShow(reqI, reqI.$src, reqI.str, isTrue);\r\n\tconst beforeAttrCount = isSingle(reqI.$src, srcBy$src.get(reqI.$src), reqI.str, ifCmdName);\r\n//console.log(1, isTrue, $last, $attr, str, beforeAttrCount, req, ifCmdName, elseifCmdName, elseCmdName);\r\n\tif (beforeAttrCount === -1) {\r\n//\t\treturn type_renderRes(!isTrue, $attr, $last);\r\n\t\treturn type_renderRes(attrStr === \"\", $attr, $last, $attr, attrStr);//если attrStr === \"\" - это значит, что что-то не показывается, а если нужно рендереить вглубь, то был запщен рендер в афтерАнимации\r\n\t}\r\n\tfor (let $i = $last.nextSibling; $i !== null; $i = $i.nextSibling) {\r\n//\t\tif ($i.nodeType !== 1) {\r\n//\t\tif (!$i[p_descrId]) {//это коммент, текст или когда template и в нем скрыта тектовая нода\r\n\t\tconst iSrc = srcBy$src.get($i);\r\n\t\tif (iSrc === undefined) {//это коммент, текст или когда template и в нем скрыта тектовая нода\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (!iSrc.isCmd) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tlet f = true,\r\n\t\t\tpos = 0;\r\n\t\tfor (const [n, v] of iSrc.descr.attr) {\r\n\t\t\tif (pos++ < beforeAttrCount) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tconst rc = my.env.reqCmd.get(n);\r\n//console.log(req.str, iSrc, $i, n, rc.cmdName, elseifCmdName, elseCmdName)\r\n\t\t\tif (rc.cmdName !== elseifCmdName && rc.cmdName !== elseCmdName) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n//\t\t\tif (pos++ !== beforeAttrCount) {\r\n//\t\t\t\tthrow getErr(new Error(\">>>mw if:make$first:01 Invalid structure: elseif and else command can be first in this attributes\"), $i);\r\n//\t\t\t}\r\n\t\t\tconst reqI = type_req($i, n, v, srcSetScope(iSrc, pScope), req.sync);\r\n\t\t\t//!!*3\r\n\t\t\tf = false;\r\n\t\t\tif (isTrue) {//это означает, что ранее был показан блок и текущий нужно скрыть, и далее рендерить по ранее заданному $attr\r\n//\t\t\t\tif ($i.nodeName === \"TEMPLATE\") {\r\n//\t\t\t\t\t$last = $i;\r\n//\t\t\t\t\tbreak;\r\n//\t\t\t\t}\r\n\t\t\t\t[$last] = makeShow(reqI, $i, n, false);\r\n//console.log(2, $last, $attr, attrStr);\r\n\t\t\t\t$i = $last;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (rc.cmdName === elseCmdName) {\r\n\t\t\t\t[$last, $attr, attrStr] = makeShow(reqI, $i, n, true);\r\n//console.log(3, $last, $attr, attrStr);\r\n\t\t\t\t$i = $last;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t//это elsif\r\n\t\t\tval = await eval2(reqI, $i, true);\r\n\t\t\tif (isTrue = testFunc(val)) {\r\n\t\t\t\tconst valName = reqI.reqCmd.args[0];\r\n\t\t\t\tif (valName !== undefined && valName !== \"\") {\r\n\t\t\t\t\treqI.scope[p_target][kebabToCamelCase(valName)] = getProxy(val);\r\n\t\t\t\t}\r\n\t\t\t\t[$last, $attr, attrStr] = makeShow(reqI, $i, n, true);\r\n//console.log(4, $last, $attr, attrStr);\r\n\t\t\t\t$i = $last;\r\n\t\t\t\tval = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t[$last, $attr, attrStr] = makeShow(reqI, $i, n, false);\r\n//console.log(5, f, $i, $last, $attr, attrStr);\r\n\t\t\t$i = $last;\r\n//\t\t\tval = false;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif (f) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn type_renderRes(attrStr === \"\", $attr, $last, $attr, attrStr);//если attrStr === \"\" - это значит, что что-то не показывается, а если нужно рендереить вглубь, то был запщен рендер в афтерАнимации\r\n}\r\nfunction make$first(req, ifCmdName, elseifCmdName, elseCmdName) {\r\n\tlet pos = 0;\r\n\tfor (const n of my.env.srcBy$src.get(req.$src).descr.attr.keys()) {\r\n\t\tif (n === req.str) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tpos++;\r\n\t}\r\n\tconst $first = if_get$first(ifCmdName, elseifCmdName, elseCmdName, req.$src, req.str, req.expr, pos);\r\n\tif (my.env.reqCmd.get(req.str).cmdName === ifCmdName) {\r\n\t\treq.$src = $first;\r\n\t\treturn;\r\n\t}\r\n\tfor (const [n, v] of my.env.srcBy$src.get($first).descr.attr) {\r\n\t\tconst rc = my.env.reqCmd.get(n);\r\n\t\tif (rc.cmdName === ifCmdName) {\r\n\t\t\treq.reqCmd = rc;\r\n\t\t\treq.str = n;\r\n\t\t\treq.expr = v;\r\n\t\t\treq.$src = $first;\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n}\r\nfunction if_get$first(ifCmdName, elseifCmdName, elseCmdName, $src, str, expr, pos, firstStr) {\r\n\tconst isStrIf = str !== \"\" && my.env.reqCmd.get(str).cmdName === ifCmdName,\r\n\t\tsrcBy$src = my.env.srcBy$src;\r\n\tfor (let $i = $src; $i !== null; $i = $i.previousSibling) {\r\n//\t\tif ($i.nodeType !== 1) {\r\n\t\tconst iSrc = srcBy$src.get($i);\r\n\t\tif (iSrc === undefined) {//это коммент, текст или когда template и в нем скрыта тектовая нода\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (!iSrc.isCmd) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tlet f = true,\r\n\t\t\tl = 0;\r\n\t\tfor (const n of iSrc.descr.attr.keys()) {\r\n\t\t\tconst rc = my.env.reqCmd.get(n);\r\n\t\t\tif (rc.cmdName === incCmdName) {\r\n\t\t\t\tl = 0;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tl++;\r\n\t\t\tif (isStrIf) {\r\n\t\t\t\tif (n !== str) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t} else if (rc.cmdName === elseifCmdName || rc.cmdName === elseCmdName) {\r\n\t\t\t\tif (l !== 1) {\r\n\t\t\t\t\tthrow getErr(new Error(\">>>mw if:make$first:01 Invalid structure: elseif and else command can be first in this attributes\"), $i);\r\n\t\t\t\t}\r\n\t\t\t\tf = false;\r\n\t\t\t\tbreak;\r\n\t\t\t} else if (rc.cmdName !== ifCmdName) {// || (isStrIf && n !== str)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (firstStr) {\r\n\t\t\t\tfirstStr.str = n;\r\n\t\t\t}\r\n\t\t\tlet incCount = 0,\r\n\t\t\t\tforBefore = [],\r\n\t\t\t\tforStr = \"\",\r\n\t\t\t\tforIdx;\r\n\t\t\tconst attrIt = iSrc.descr.attr.keys();\r\n\t\t\tfor (let i = attrIt.next(); !i.done; i = attrIt.next()) {\r\n\t\t\t\tif (incCount === 0) {\r\n\t\t\t\t\tconst n = i.value,\r\n\t\t\t\t\t\trc = my.env.reqCmd.get(n);\r\n\t\t\t\t\tif (rc.cmdName === foreachCmdName) {\r\n\t\t\t\t\t\tforBefore.push([n, getIdx(iSrc, n)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (i.value !== str) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tfor (i = attrIt.next(); !i.done; i = attrIt.next()) {\r\n\t\t\t\t\tconst n = i.value,\r\n\t\t\t\t\t\trc = my.env.reqCmd.get(n);\r\n\t\t\t\t\tif (forStr === \"\" && rc.cmdName === incCmdName) {\r\n\t\t\t\t\t\tif (getIdx(iSrc, n) !== undefined) {\r\n\t\t\t\t\t\t\tincCount++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (incCount === 0 && forStr === \"\" && rc.cmdName === foreachCmdName) {\r\n\t\t\t\t\t\tforIdx = getIdx(iSrc, n);\r\n\t\t\t\t\t\tif (forIdx !== undefined) {\r\n\t\t\t\t\t\t\tforStr = n;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (incCount !== 0) {\r\n\t\t\t\tfor ($i = $i.previousSibling; $i !== null; $i = $i.previousSibling) {\r\n\t\t\t\t\tif ($i.nodeType === 8 && $i.textContent === \"inc_begin\") {\r\n\t\t\t\t\t\tif (--incCount) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor ($i = $i.nextSibling; $i !== null; $i = $i.nextSibling) {\r\n\t\t\t\t\t\t\tconst iSrc = srcBy$src.get($i);\r\n\t\t\t\t\t\t\tif (iSrc !== undefined && iSrc.isCmd) {\r\n\t\t\t\t\t\t\t\treturn $i;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthrow getErr(new Error(\">>>mw if:make$first:02 Invalid structure: inc_begin not found\"), $src);\r\n\t\t\t}\r\n\t\t\tif (forStr !== \"\") {\r\n\t\t\t\tconst forBeforeLen = forBefore.length;\r\n\t\t\t\tfor (let $j = $i.previousSibling; $j !== null; $j = $j.previousSibling) {\r\n\t\t\t\t\tconst jSrc = srcBy$src.get($j);\r\n\t\t\t\t\tif (jSrc === undefined || !jSrc.isCmd) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst jdx = getIdx(jSrc, forStr);\r\n\t\t\t\t\tif (jdx === undefined || forIdx < jdx) {\r\n\t\t\t\t\t\treturn $i;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (forBeforeLen > 0) {\r\n\t\t\t\t\t\tfor (let i = 0; i < forBeforeLen; i++) {\r\n\t\t\t\t\t\t\tconst b = forBefore[i];\r\n\t\t\t\t\t\t\tif (getIdx(jSrc, b[0]) !== b[1]) {\r\n\t\t\t\t\t\t\t\treturn $i;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$i = $j;\r\n\t\t\t\t\tforIdx = jdx;\r\n//--\t\t\t\t\tif (jdx === \"0\") {\r\n//\t\t\t\t\t\t$i = $j;\r\n//\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn $i;\r\n\t\t\t}\r\n\t\t\treturn $i;\r\n\t\t}\r\n\t\tif (f) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tthrow getErr(new Error(`>>>mw if:ifGet$first:02 Invalid structure: if-command not found - str => \"${str}\"`), $src);\r\n}\r\nfunction if_get$els(ifCmdName, elseifCmdName, elseCmdName, $src, str, expr, pos) {\r\n//console.error(ifCmdName, elseifCmdName, elseCmdName, $src, str, expr, pos);\r\n//todo type\r\n\tconst srcBy$src = my.env.srcBy$src,\r\n\t\tfirstStr = {\r\n\t\t\tstr: \"\"\r\n\t\t};\r\n\tlet $i = if_get$first(ifCmdName, elseifCmdName, elseCmdName, $src, str, expr, pos, firstStr);\r\n\tfor (let iSrc = srcBy$src.get($i); iSrc !== undefined && !iSrc.isCmd && $i !== null; $i = $i.nextSibling, iSrc = srcBy$src.get($i)) {\r\n\t\t$i = $i.nextSibling;\r\n\t}\r\n//\tif (!$i) {\r\n//\t\t!!такого не должно быть\r\n//\t}\r\n\tconst iSrc = srcBy$src.get($i),\r\n\t\tnStr = if_getNextStr(iSrc, firstStr.str),\r\n\t\t$els = nStr !== \"\" ? get$els($i, iSrc.descr.get$elsByStr, nStr) : [$i],\r\n\t\tbeforeAttrCount = isSingle($i, iSrc, firstStr.str, ifCmdName);\r\n\tif (beforeAttrCount === -1) {\r\n\t\treturn $els;\r\n\t}\r\n\tif (nStr !== \"\") {\r\n\t\t$i = $els[$els.length - 1];\r\n\t}\r\n\tlet $maybe = [];\r\n\tfor ($i = $i.nextSibling; $i !== null; $i = $i.nextSibling) {\r\n//\t\tif ($i.nodeType !== 1) {\r\n//--\t\tif (!$i[p_descrId]) {//это коммент, текст или когда template и в нем скрыта тектовая нода\r\n\t\tconst iSrc = srcBy$src.get($i);\r\n\t\tif (iSrc === undefined) {//это коммент, текст или когда template и в нем скрыта тектовая нода\r\n\t\t\t$maybe.push($i);\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (!iSrc.isCmd) {\r\n\t\t\treturn $els;\r\n\t\t}\r\n\t\tlet f = true,\r\n\t\t\tpos = 0;\r\n\t\tconst iDescr = iSrc.descr;\r\n\t\tfor (const n of iDescr.attr.keys()) {\r\n\t\t\tif (pos++ < beforeAttrCount) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tconst rc = my.env.reqCmd.get(n);\r\n\t\t\tif (rc.cmdName !== elseifCmdName && rc.cmdName !== elseCmdName) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n//\t\t\tif (pos++ !== beforeAttrCount) {\r\n//\t\t\t\tthrow getErr(new Error(\">>>mw if:ifGet$els:01 Invalid structure: elseif and else command can be first in this attributes\"), $i);\r\n//\t\t\t}\r\n\t\t\t//!!*3\r\n\t\t\tf = false;\r\n//todo--if ($els.length > 20) {\r\n//\tdebugger\r\n//}\r\n\t\t\tconst nStr = if_getNextStr(iSrc, n),\r\n\t\t\t\t$iEls = nStr !== \"\" ? get$els($i, iDescr.get$elsByStr, nStr) : [$i];\r\n\t\t\tif ($iEls.length === 1) {\r\n\t\t\t\tif ($maybe.length !== 0) {\r\n\t\t\t\t\t$els.push(...$maybe);\r\n\t\t\t\t\t$maybe = [];\r\n\t\t\t\t}\r\n\t\t\t\t$els.push($i);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n//todo тут вроде всё работает - проверить доказательство\r\n\t\t\t$i = $iEls[0].previousSibling;\r\n\t\t\t$maybe = [];\r\n//\t\t\twhile (!$i[p_descrId]) {\r\n\t\t\twhile (true) {\r\n\t\t\t\tconst iSrc = srcBy$src.get($i);\r\n\t\t\t\tif (iSrc === undefined) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t$maybe.push($i);\r\n\t\t\t\t$i = $i.previousSibling;\r\n\t\t\t}\r\n\t\t\tconst $maybeLen = $maybe.length;\r\n\t\t\tif ($maybeLen !== 0) {\r\n\t\t\t\tfor (let i = $maybeLen - 1; i > -1; i--) {\r\n\t\t\t\t\t$els.push($maybe[i]);\r\n\t\t\t\t}\r\n\t\t\t\t$maybe = [];\r\n\t\t\t}\r\n\t\t\t$i = $els[$els.push(...$iEls) - 1];\r\n//console.error($i, $i.nextSibling, $i.nextSibling.nextSibling);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tif (f) {\r\n\t\t\treturn $els;\r\n\t\t}\r\n\t}\r\n\treturn $els;\r\n}\r\nfunction isSingle($src, src, str, ifCmdName) {//проверка на то что этот иф входит в конструккцию типа: <div _elseif=\"*\" _if=\"эотот иф\"\r\n\tlet beforeAttrCount = 0,\r\n\t\tf = false;\r\n\tfor (const n of src.descr.attr.keys()) {\r\n\t\tif (n === str) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tconst nn = my.env.reqCmd.get(n).cmdName;\r\n\t\tif (ifCmdName === switchCmdName && nn === switchCmdName) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tbeforeAttrCount++;\r\n\t\tswitch (nn) {\r\n\t\t\tcase ifCmdName:\r\n\t\t\tcase elseifCmdName:\r\n\t\t\tcase elseCmdName:\r\n\t\t\tcase foreachCmdName:\r\n//\t\t\tcase switchCmdName:\r\n\t\t\tcase caseCmdName:\r\n\t\t\tcase defaultCmdName:\r\n//\t\t\t\tbeforeAttrCount++;\r\n\t\t\t\tf = true;\r\n//console.log(333333, $src, str, n, my.env.descrById.get($src[p_descrId]).attr);\r\n\t\t\tbreak;\r\n\t\t\tcase incCmdName:\r\n/*\r\n\t\t\t\tconst $els = get$els($src, src.descr.get$elsByStr, n);\r\n\t\t\t\tfor (let $i = $els[$els.length - 2];; $i = $i.previousSibling) {\r\n\t\t\t\t\tconst iSrc = srcBy$src.get($i);\r\n\t\t\t\t\tif (!iSrc.isCmd) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (iSrc.descr.attr.has(str)) {\r\n\t\t\t\t\t\treturn -1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}*/\r\n//\t\t\t\tbeforeAttrCount++;\r\n\t\t\t\tf = false;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn f ? -1 : beforeAttrCount;\r\n}\r\nfunction makeShow(req, $i, str, isShow) {\r\n\tconst srcBy$src = my.env.srcBy$src,\r\n\t\tsrc = srcBy$src.get($i),\r\n\t\tnStr = if_getNextStr(src, str),\r\n\t\t$els = nStr !== \"\" ? get$els($i, src.descr.get$elsByStr, nStr) : [$i],\r\n\t\t$elsLen = $els.length,\r\n\t\t$last = $els[$elsLen - 1];\r\n\tif (!isShow) {\r\n\t\tfor (let i = 0; i < $elsLen; i++) {\r\n//\t\t\t$i = $els[i];\r\n//\t\t\tif ($i.nodeType === 1) {\r\n//\t\t\t\thide(req, $i);\r\n//\t\t\t}\r\n\t\t\thide(req, $els[i]);\r\n\t\t}\r\n\t\treturn [$last, null, \"\"];\r\n\t}\r\n\tlet $attr = null,\r\n\t\tattrStr = \"\",\r\n\t\tisNotAnimations = true;\r\n\tfor (let i = 0; i < $elsLen; i++) {\r\n\t\t$i = $els[i];\r\n\t\tconst iSrc = srcBy$src.get($i);\r\n//\t\tif ($i.nodeType !== 1) {\r\n\t\tif (iSrc === undefined) {\r\n\t\t\tif ($i.nodeType === 1) {\r\n\t\t\t\tshow(req, $i);\r\n\t\t\t\tisNotAnimations = false;\r\n\t\t\t}\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif ($attr === null) {\r\n\t\t\t$attr = $i;\r\n\t\t\tattrStr = str;\r\n\t\t}\r\n//\t\tif ($i.nodeName === \"TEMPLATE\" && $i.getAttribute(hideName) !== null) {\r\n\t\tif (iSrc.isHide) {\r\n\t\t\tshow(req, $i);\r\n\t\t\tisNotAnimations = false;\r\n\t\t}\r\n\t}\r\n/*<==\r\n\tfor (let i = 0; i < $elsLen; i++) {\r\n\t\t$i = $els[i];\r\n\t\tif ($i.nodeType === 8) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif ($attr === null) {\r\n\t\t\tconst iSrc = srcBy$src.get($i);\r\n\t\t\tif (iSrc !== undefined && iSrc.isCmd) {\r\n\t\t\t\t$attr = $i;\r\n\t\t\t\tattrStr = str;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ($i.nodeName === \"TEMPLATE\" && $i.getAttribute(hideName) !== null) {\r\n\t\t\tshow(req, $i);\r\n\t\t\tisNotAnimations = false;\r\n\t\t}\r\n\t}*/\r\n\tif (isNotAnimations) {\r\n\t\treturn [$last, $attr, attrStr];\r\n\t}\r\n\tconst sId = srcBy$src.get($attr).id;\r\n\treq.sync.afterAnimations.add(type_animation(() => renderTag(my.env.$srcById.get(sId), req.scope, str, req.sync), req.sync.local, 0));\r\n\treturn [$last, null, \"\"];\r\n}\r\nfunction if_getNextStr(src, str) {\r\n\treturn str !== switchCmdName ? getNextStr(src, str) : getNextStr(src, getNextStr(src, str));\r\n}\r\n","﻿import {type_req} from \"../../render/type.js\";\r\nimport {type_cacheValue} from \"../../cache/type.js\";\r\nimport {p_target, preventDefaultModName, stopModName, selfModName, exactModName, eventScopeName} from \"../../config/config.js\";\r\nimport {getErr} from \"../../err/err.js\";\r\nimport {eval2} from \"../../eval2/eval2.js\";\r\nimport {kebabToCamelCase} from \"../../str/str.js\";\r\nimport {type_cmd} from \"../type.js\";\r\n\r\nexport default type_cmd(cmd_render, cmd_q_render, null, null, false, false);\r\n\r\nfunction cmd_render(req) {\r\n\ton_render(req, req.$src);\r\n\treturn null;\r\n}\r\nfunction cmd_q_render(req, arr, isLast) {\r\n\tconst arrLen = arr.length;\r\n\tfor (let i = 0; i < arrLen; i++) {\r\n\t\tif (!isLast.has(i)) {\r\n\t\t\ton_render(req, arr[i].$src);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n/*\r\nexport default {\r\n\trender(req) {\r\n\t\ton_render(req, req.$src);\r\n\t\treturn null;\r\n\t},\r\n\tq_render(req, arr, isLast) {\r\n\t\tconst arrLen = arr.length;\r\n\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\ton_render(req, arr[i].$src);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n};*/\r\nconst isInit = new WeakMap();\r\nfunction on_render(req, $src) {\r\n\tconst n = req.reqCmd.args[0];\r\n\tif (!n) {\r\n\t\tthrow getErr(new Error(\">>>mw on:render:01: Need set action name\"), $src, req);\r\n\t}\r\n\tconst src = my.env.srcBy$src.get($src);\r\n//\tif (src !== undefined) {\r\n//\t\tconst c = getCacheBySrcId($src[p_srcId]);\r\n\t\tconst c = src.cache;\r\n\t\tif (c.isInits.has(req.str)) {// || ($src._isInit !== undefined && $src._isInit.has(req.str))) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tc.isInits.add(req.str);\r\n\t\tconst ii = isInit.get($src);\r\n\t\tif (ii !== undefined && ii.has(req.str)) {\r\n\t\t\tii.delete(req.str);\r\n\t\t\treturn;\r\n\t\t}\r\n/*\r\n//todo\r\n\t} else {\r\nconsole.warn(32423423, req);\r\n\t\tconst ii = isInit.get($src);\r\n\t\tif (ii !== undefined && ii.has(req.str)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tisInit.set($src, new Set([req.str]));\r\n\t}*/\r\n\tconst opt = type_listenerOptions();\r\n\tfor (let i = req.reqCmd.args.length - 1; i > 0; i--) {\r\n\t\tswitch (req.reqCmd.args[i]) {\r\n\t\t\tcase \"capture\":\r\n\t\t\t\topt.capture = true;\r\n\t\t\t\tcontinue;\r\n\t\t\tcase \"once\":\r\n\t\t\t\topt.once = true;\r\n\t\t\t\tcontinue;\r\n\t\t\tcase \"passive\":\r\n\t\t\t\topt.passive = true;\r\n\t\t\t\tcontinue;\r\n\t\t}\r\n\t}\r\n\t$src.addEventListener(kebabToCamelCase(n), evt => listen(req, $src, evt), opt);\r\n}\r\nconst holdsKeys = new Set([\"ctrl\", \"alt\", \"shift\", \"meta\"]);\r\nfunction listen(req, $src, evt) {\r\n\tconst argsLen = req.reqCmd.args.length,\r\n\t\tactions = new Set();\r\n\tfor (let i = 1; i < argsLen; i++) {\r\n\t\tconst mod = req.reqCmd.args[i];//.toLowerCase();\r\n\t\tswitch (mod) {\r\n\t\t\tcase \"\":\r\n\t\t\tcase \"capture\":\r\n\t\t\tcase \"once\":\r\n\t\t\tcase \"passive\":\r\n\t\t\t\tcontinue;\r\n\t\t\tcase preventDefaultModName:\r\n\t\t\t\tevt.preventDefault();\r\n\t\t\t\tcontinue;\r\n\t\t\tcase stopModName:\r\n//\t\t\t\tevt.cancelBubble = true;\r\n\t\t\t\tevt.stopPropagation();\r\n\t\t\t\tcontinue;\r\n\t\t\tcase selfModName:\r\n\t\t\t\tif (evt.target === $src) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\tcase \"ctrl\":\r\n\t\t\t\tif (evt.ctrlKey) {\r\n\t\t\t\t\tactions.add(\"ctrl\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\tcase \"alt\":\r\n\t\t\t\tif (evt.altKey) {\r\n\t\t\t\t\tactions.add(\"alt\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\tcase \"shift\":\r\n\t\t\t\tif (evt.shiftKey) {\r\n\t\t\t\t\tactions.add(\"shift\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\tcase \"meta\":\r\n\t\t\t\tif (evt.metaKey) {\r\n\t\t\t\t\tactions.add(\"meat\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\tcase exactModName:\r\n\t\t\t\tfor (const i of holdsKeys) {\r\n\t\t\t\t\tif (actions.has(i)) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tswitch (i) {\r\n\t\t\t\t\t\tcase \"ctrl\":\r\n\t\t\t\t\t\t\tif (evt.ctrlKey) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\tcase \"alt\":\r\n\t\t\t\t\t\t\tif (evt.altKey) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\tcase \"shift\":\r\n\t\t\t\t\t\t\tif (evt.shiftKey) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\tcase \"meta\":\r\n\t\t\t\t\t\t\tif (evt.metaKey) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t}\r\n\t\tif (evt.type === \"input\") {\r\n\t\t\tif (evt.data !== null && mod === evt.data.toLowerCase()) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n//https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/code\r\n//https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key\r\n//https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/button\r\n//console.log(mod)\r\n\t\tif (evt.type.indexOf(\"key\") === 0) {\r\n\t\t\tif (mod === evt.key.toLowerCase()) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (evt.type.indexOf(\"mouse\") === 0 && !isNaN(mod)) {\r\n\t\t\tif (Number(mod) === evt.button) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\tconst src = my.env.srcBy$src.get($src),\r\n\t\ts = src.scopeCache;\r\n\ts[p_target][eventScopeName] = evt;\r\n\tsrc.cache.value = type_cacheValue();\r\n\teval2(type_req($src, req.str, req.expr, s, null), $src, false);\r\n}\r\nfunction type_listenerOptions() {\r\n\treturn {\r\n\t\tcapture: false,\r\n\t\tonce: false,\r\n\t\tpassive: false\r\n\t};\r\n}\r\n","﻿import {p_target} from \"../../config/config.js\";\r\nimport {getErr} from \"../../err/err.js\";\r\nimport {kebabToCamelCase} from \"../../str/str.js\";\r\nimport {type_cmd} from \"../type.js\";\r\n\r\nexport default type_cmd(cmd_render, cmd_q_render, null, null, false, false);\r\n\r\nfunction cmd_render(req) {\r\n\treq.scope[p_target][getName(req)] = req.scope;\r\n\treturn null;\r\n}\r\nfunction cmd_q_render(req, arr, isLast) {\r\n\tconst n = getName(req),\r\n\t\tarrLen = arr.length;\r\n\tfor (let i = 0; i < arrLen; i++) {\r\n\t\tif (!isLast.has(i)) {\r\n\t\t\tarr[i].scope[p_target][n] = arr[i].scope;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n/*\r\nexport default {\r\n\trender(req) {\r\n\t\treq.scope[p_target][getName(req)] = req.scope;\r\n\t\treturn null;\r\n\t},\r\n\tq_render(req, arr, isLast) {\r\n\t\tconst n = getName(req),\r\n\t\t\tarrLen = arr.length;\r\n\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\tarr[i].scope[p_target][n] = arr[i].scope;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n};*/\r\nfunction getName(req) {\r\n\tconst n = req.reqCmd.args[0];\r\n\tif (n !== undefined && n !== \"\") {\r\n\t\treturn kebabToCamelCase(n);\r\n\t}\r\n\tthrow getErr(new Error(\">>>mw scope:render: Need set scope name\"), req.$src, req);\r\n}\r\n","﻿import {eval2} from \"../../eval2/eval2.js\";\r\nimport {showLoading} from \"../../loading/loading.js\";\r\nimport {type_cmd} from \"../type.js\";\r\n\r\nexport default type_cmd(cmd_render, null, null, null, false, false);\r\n\r\nfunction cmd_render(req) {\r\n\treturn showLoading(req.$src, () => eval2(req, req.$src, true), req.reqCmd.args[0], req.reqCmd.args[1])\r\n\t\t.then(() => null);\r\n}\r\n/*\r\nexport default {\r\n\trender(req) {\r\n\t\treturn showLoading(req.$src, () => eval2(req, req.$src, true), req.reqCmd.args[0], req.reqCmd.args[1])\r\n\t\t\t.then(() => null);\r\n\t}\r\n};*/\r\n","﻿import {type_renderRes} from \"../../render/type.js\";\r\nimport {p_target} from \"../../config/config.js\";\r\nimport {get$els} from \"../../descr/descr.js\";\r\nimport {eval2, q_eval2} from \"../../eval2/eval2.js\";\r\nimport {getProxy} from \"../../proxy/proxy.js\";\r\nimport {kebabToCamelCase} from \"../../str/str.js\";\r\nimport {type_cmd} from \"../type.js\";\r\n\r\nexport default type_cmd(cmd_render, cmd_q_render, null, null, false, false);\r\n\r\nfunction cmd_render(req) {\r\n\treturn eval2(req, req.$src, true)\r\n\t\t.then(val => watch_render(req, req.scope, getName(req), val));\r\n}\r\nfunction cmd_q_render(req, arr, isLast) {\r\n\treturn q_eval2(req, arr, isLast)\r\n\t\t.then(vals => {\r\n\t\t\tconst n = getName(req),\r\n\t\t\t\tarrLen = arr.length,\r\n\t\t\t\tres = new Array(arrLen);\r\n\t\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\t\tres[i] = watch_render(req, arr[i].scope, n, vals[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn res;\r\n\t\t});\r\n}\r\n/*\r\nexport default {\r\n\trender(req) {\r\n\t\treturn eval2(req, req.$src, true)\r\n\t\t\t.then(val => watch_render(req, req.scope, getName(req), val));\r\n\t},\r\n\tq_render(req, arr, isLast) {\r\n\t\treturn q_eval2(req, arr, isLast)\r\n\t\t\t.then(vals => {\r\n\t\t\t\tconst n = getName(req),\r\n\t\t\t\t\tarrLen = arr.length,\r\n\t\t\t\t\tres = new Array(arrLen);\r\n\t\t\t\tfor (let i = 0; i < arrLen; i++) {\r\n\t\t\t\t\tif (!isLast.has(i)) {\r\n\t\t\t\t\t\tres[i] = watch_render(req, arr[i].scope, n, vals[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn res;\r\n\t\t\t});\r\n\t}\r\n};*/\r\nfunction getName(req) {\r\n\tconst n = req.reqCmd.args[0];\r\n\tif (n !== undefined && n !== \"\") {\r\n\t\treturn kebabToCamelCase(n);\r\n\t}\r\n}\r\nfunction watch_render(req, scope, n, val) {\r\n//\tconst c = getCacheBySrcId(req.$src[p_srcId]),\r\n\tconst src = my.env.srcBy$src.get(req.$src),\r\n\t\tc = src.cache;\r\n\tif (!c.current.has(req.str)) {\r\n\t\tc.current.set(req.str, type_watchCur());\r\n\t}\r\n\tconst cur = c.current.get(req.str);\r\n\tif (req.sync.renderParam.isLinking) {\r\n\t\tc.isInits.add(req.str);\r\n\t\tcur.watch = val;\r\n\t\treturn type_renderRes(true);\r\n\t}\r\n\tif (c.isInits.has(req.str)) {\r\n\t\tif (val === cur.watch) {\r\n\t\t\tconst get$elsByStr = src.descr.get$elsByStr;\r\n\t\t\tif (get$elsByStr === null) {\r\n\t\t\t\treturn type_renderRes(true);\r\n\t\t\t}\r\n\t\t\tconst $els = get$els(req.$src, src.descr.get$elsByStr, req.str);\r\n\t\t\treturn type_renderRes(true, $els[$els.length - 1]);\r\n\t\t}\r\n\t\treq.sync.onreadies.add(() => {\r\n\t\t\tcur.watch = val;\r\n\t\t});\r\n\t} else {\r\n\t\treq.sync.onreadies.add(() => {\r\n\t\t\tc.isInits.add(req.str);\r\n\t\t\tcur.watch = val;\r\n\t\t});\r\n\t}\r\n\tif (n !== undefined) {\r\n\t\tscope[p_target][n] = getProxy(val);\r\n\t}\r\n\treturn null;\r\n}\r\nfunction type_watchCur() {\r\n\treturn {\r\n\t\twatch: undefined\r\n\t};\r\n}\r\n","﻿/*!\r\n * myweb 0.9.2\r\n * (c) 2019-2021 Aleksey Zobnev\r\n * Released under the MIT License.\r\n * https://github.com/mywebengine/myweb\r\n */\r\nimport {render, setDelay, renderLoop, addAnimation, checkScrollAnimations} from \"./render/algo.js\";\r\nimport \"./addons/addons.js\";\r\nimport \"./api/api.js\";\r\nimport {globVarName, locVarName, viewVarName} from \"./config/config.js\";\r\nimport {type_env} from \"./env/type.js\";\r\nimport {isAnimationVisible} from \"./dom/dom.js\";\r\nimport {getLoc, setLoc} from \"./loc/loc.js\";\r\nimport {getProxy} from \"./proxy/proxy.js\";\r\nimport {getView, setView} from \"./view/view.js\";\r\n\r\nimport {attrCmdName, execCmdName, fetchCmdName, foreachCmdName, htmlCmdName,\r\n\tifCmdName, elseifCmdName, elseCmdName,\r\n\tswitchCmdName, caseCmdName, defaultCmdName,\r\n\tincCmdName, onCmdName, scopeCmdName, fillingCmdName, watchCmdName} from \"./config/config.js\";\r\n\r\nimport {addCommand} from \"./cmd/cmd.js\";\r\nimport attrCmd from \"./cmd/attr/attr.js\";\r\nimport execCmd from \"./cmd/exec/exec.js\";\r\nimport fetchCmd from \"./cmd/fetch/fetch.js\";\r\nimport foreachCmd from \"./cmd/foreach/foreach.js\";\r\nimport htmlCmd from \"./cmd/html/html.js\";\r\nimport {ifCmd, switchCmd} from \"./cmd/if/if.js\";\r\nimport incCmd from \"./cmd/inc/inc.js\";\r\nimport onCmd from \"./cmd/on/on.js\";\r\nimport scopeCmd from \"./cmd/scope/scope.js\";\r\nimport fillingCmd from \"./cmd/filling/filling.js\";\r\nimport watchCmd from \"./cmd/watch/watch.js\";\r\n\r\n//self.onerror = function(errorMsg, url, lineNumber) {\r\n//\talert(errorMsg);\r\n//\treturn false;\r\n//}\r\n//\r\nfunction clientInit() {\r\n\tif (!self.my) {\r\n\t\tself.my = {};\r\n\t}\r\n\tmy.document = document;\r\n\tmy.rootElement = document.documentElement;\r\n\tmy.env = type_env();\r\n\r\n\r\naddCommand(attrCmdName, attrCmd);\r\naddCommand(execCmdName, execCmd);\r\naddCommand(fetchCmdName, fetchCmd);\r\naddCommand(foreachCmdName, foreachCmd);\r\naddCommand(htmlCmdName, htmlCmd);\r\n\r\naddCommand(ifCmdName, ifCmd);\r\naddCommand(elseifCmdName, ifCmd);\r\naddCommand(elseCmdName, ifCmd);\r\n\r\naddCommand(switchCmdName, switchCmd);\r\naddCommand(caseCmdName, switchCmd);\r\naddCommand(defaultCmdName, switchCmd);\r\n\r\naddCommand(incCmdName, incCmd);\r\naddCommand(onCmdName, onCmd);\r\naddCommand(scopeCmdName, scopeCmd);\r\naddCommand(fillingCmdName, fillingCmd);\r\naddCommand(watchCmdName, watchCmd);\r\n//ssr\r\n//for (const [str, r] of my.env.reqCmd) {\r\n//\tr.cmd = my.env.cmd.get(str.substr(0, str.indexOf(cmdArgsDiv)));\r\n//}\r\n\r\n\r\n\tconst mwUrl = import.meta.url;\r\n\tmy.debugLevel = mwUrl.indexOf(\"debug=1\") !== -1 ? 1 : (mwUrl.indexOf(\"debug=2\") !== -1 ? 2 : 0);\r\n\tself[globVarName] = getProxy(self[globVarName] || {});\r\n\tself[locVarName] = getProxy(getLoc(location.href));\r\n\tself[viewVarName] = getProxy(getView(document));\r\n\tif (mwUrl.indexOf(\"load=skip\") !== -1) {\r\n\t\tif (my.debugLevel !== 0) {\r\n\t\t\timport(mwUrl.replace(/([^\\/]+?\\.js)/, \"getlineno.js\"));\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\tconst ready = () => {\r\n\t\tif (mwUrl.indexOf(\"line=1\") === -1) {\r\n\t\t\trender(undefined, undefined, undefined, mwUrl.indexOf(\"linking=1\") !== -1);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\timport(mwUrl.replace(/([^\\/]+?\\.js)/, \"getlineno.js\"))\r\n\t\t\t.then(m => m.default)\r\n\t\t\t.then(() => render(undefined, undefined, undefined, mwUrl.indexOf(\"linking=1\") !== -1));\r\n\t}\r\n\tif (mwUrl.indexOf(\"load=onload\") === -1) {\r\n//\t\tif (document.readyState !== \"loading\") {\r\n\t\tif (document.readyState === \"interactive\" || document.readyState === \"complete\") {\r\n\t\t\tready();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tdocument.addEventListener(\"DOMContentLoaded\", ready, {\r\n\t\t\tonce: true\r\n\t\t});\r\n\t\treturn;\r\n\t}\r\n\tif (document.readyState === \"complete\") {\r\n\t\tready();\r\n\t\treturn;\r\n\t}\r\n\tself.addEventListener(\"load\", ready, {\r\n\t\tonce: true\r\n\t});\r\n\r\n\r\n//\t\r\n\tconst view = self[viewVarName],\r\n\t\t$scroll = document.scrollingElement,\r\n\t\tevtOpt = {\r\n\t\t\tpassive: true\r\n\t\t};\r\n//todo ios default\r\n\tif ($scroll.clientWidth === 980) {\r\n\t\tsetTimeout(() => setView(document), 500);\r\n\t}\r\n\tself.addEventListener(\"scroll\", () => {\r\n\t\tcheckScrollAnimations();\r\n\t\tsetDelay(10, () => {\r\n\t\t\tview.scrollTop = $scroll.scrollTop;\r\n\t\t\tview.scrollLeft = $scroll.scrollLeft;\r\n\t\t});\r\n\t}, evtOpt);\r\n\tself.addEventListener(\"resize\", () => {\r\n//console.log(\"resize\");\r\n\t\tsetDelay(10, () => setView(document));\r\n\t}, evtOpt);\r\n\tself.addEventListener(\"popstate\", () => {\r\n//console.log(\"popstate\", location.href, location.hash);\r\n\t\tsetLoc(location.href);\r\n\t}, evtOpt);\r\n}\r\n//if (true) {\r\n\tclientInit();\r\n//}\r\n","export function type_env() {\n\treturn {\n\t\tcmd: new Map(),\n\t\treqCmd: new Map(),\n\n\t\t$srcById: new Map(),\n\t\tsrcById: new Map(),\n\t\tsrcBy$src: new WeakMap(),\n\t\tdescrById: new Map(),\n\t\tidCurVal: 0,\n\n\t\tvarIdByVar: new Map(),\n\t\tvarById: new Map(),\n\t\tvarIdByVarIdByProp: new Map(),\n\t\tsrcIdsByVarId: new Map(),\n\n\t\t_func: new Map()\n\t};\n}\n"],"names":["p_target","Symbol","p_topUrl","defIdleCallbackOpt","timeout","viewVarName","defEventInit","bubbles","cancelable","composed","lazyRenderName","cmdArgsDiv","cmdArgsDivLen","length","descrIdName","hideName","asOneIdxName","idxName","isFillingName","pushModName","replaceModName","foreachCmdName","cmdPref","defRequestInit","headers","htmlCmdName","textCmdName","ifCmdName","elseifCmdName","elseCmdName","switchCmdName","caseCmdName","defaultCmdName","incCmdName","onCmdName","preventDefaultModName","stopModName","selfModName","exactModName","getNewId","my","env","idCurVal","getSrcId","local","sId","srcById","has","l","get","undefined","newSrcId","get$els","$e","get$elsByStr","str","attrIt","srcBy$src","descr","attr","keys","i","next","done","value","n","get$e","reqCmd","cmd","expr","pos","get$first","getNextStr","src","getAttrAfter","name","a","Map","getAttrItAfter","entries","set","isValues","type_req","$src","scope","sync","type_isLast","Set","type_q_arr","type_animation","handler","viewedSrcId","p","values","animationsCount","type_renderRes","isLast","$last","$attr","attrStr","type_renderParam","isLinking","isLazyRender","srcIds","$els","type_sync","syncId","renderParam","resolve","promise","Promise","res","beforeAnimations","animations","afterAnimations","scrollAnimations","onreadies","idleCallback","animationFrame","stat","type_cache","isInits","current","type_cacheCurrent","type_cacheValue","attrSyncCur","type_cmd","render","q_render","isCustomHtml","isAsOne","addCommand","cmdName","setReqCmd","already","indexOf","substr","args","type_reqCmd","split","FormData","prototype","Document","DocumentFragment","HTMLElement","Text","Date","Request","Response","self","_testVars","v","Array","from","varIdByVar","vId","srcIdsByVarId","$srcById","console","log","f","vvId","vIdByProp","varIdByVarIdByProp","pId","s","propS","isSkipNameType","isSkipValueType","isScalarType","cur$src","setCur$src","proxyStat","getProxy","t","isArray","len","push","Proxy","changeArrFuncHandler","unshift","shift","pop","splice","sort","reverse","proxyHandler","clear","vv","add","getEntriesFuncHandler","addFuncHandler","hasFuncHandler","delete","deleteSetMapFuncHandler","clearFuncHandler","kk","getFuncHandler","setFuncHandler","val","d","Object","getOwnPropertyDescriptor","writable","vType","iterator","addVar","getTarget","r","vTarget","oldVTarget","setVal","deleteProperty","oldV","apply","thisValue","warn","oldLen","isEntries","iteratorFuncHandler","k","getIteratorFuncHandler","isSet","oldSize","size","tId","id","varIds","propId","newPropId","nId","varById","newValId","oldScalarId","oId","envdebugLevel","info","toRender","toClear","$i","iDescr","asOnes","setInnerSrcIdSetBy$src","j","$j","jSrc","deletedVarId","cache","decVar","requestIdleCallback","descrById","srcs","renderParams","tryRender","mw_delay","renderBySrcIds","$parent","parentNode","iSrc","isCmd","firstChild","nextSibling","delVar","type_src","isHide","asOneIdx","idx","save","scopeCache","isMounted","type_descr","type_get$elsByStrI","type_asOneIdx","type_idx","type_save","type_saveI","createSrc","getAttribute","createDescr","attrs","attributes","attrsLen","createAttr","rc","getErr","err","req","fileName","lineNum","colNum","errMsg","getLineNo","toString","params","debugLevel","Error","loadingCount","async","showLoading","testFunc","type","waitTime","amount","iId","iL","toggleLoading","decLoading","ll","createLoading","setTimeout","is$hide","lName","removeAttribute","content","c","setAttribute","type_q$i","type_cloneNodeOn","preRender","$p","idAlias","nodeName","_preRenderCreate","nodeType","text","textContent","previousSibling","$t","document","createElement","replaceChild","replaceTextBlocks","dId","_preRenderGetSrc","aIdx","nIdx","isNaN","Number","removeChild","dispatchEvent","CustomEvent","rem","clearTag","vIds","sIds","pName","clearVars","q_cloneNodeCreateChildren","$arr","$arrLen","asOneVal","$tP","q_cloneNodeCreate","isNotHide","baseAsOne","appendChild","cloneNode","q_cloneNodeChangeAsOne","curIdx","setAsOneIdx","setAttributeValue","activeElement","setSelectionRange","selectionStart","checked","show","$new","moveProps","_show","hide","_hide","$from","fromSrc","$to","rootElement","isAnimationVisible","animate","is$visible","$scroll","scrollingElement","left","clientWidth","right","top","clientHeight","bottom","b","getBoundingClientRect","height","width","getIdx","setIdx","getAttrTopUrl","nattr","topUrl","oset","o","oLen","vLen","osetArray","Reflect","osetSet","key","iVal","osetMap","osetObject","ocopy","cpy","srcSetScope","srcScope","srcScopeT","scopeT","renderTag","renderChildren","attrRender","then","$ret","addScrollAnimationsEvent","testLocalEventsBySrcId","q_renderTag","arr","arrLen","aI","ctx","q_execRender","lastCount","resI","arrI","q_addAfterAttr","byAttr","afterByDescrByAttr","attrKey","strByAttrKey","q_attrRender","_q_renderTag","$first","iArr","q_renderFlow","q_renderChildren","getAttrKey","byD","isFirst","byDescr","q_nextGroupByDescr","pSet","dArr","all","dispatchLocalEvents","dispatchLocalEventsBySrcId","mw_delayId","mw_syncId","__oldLocHash","delayParams","syncInRender","curRender","delay","setDelay","cb","old","delayId","reject","type_delayParam","delayP","toCancleSync","prepareRenderParam","repeatByD","toRemByD","curStat","checkSync","_render","_tryRender","catch","infoBySrcIds","syncInThisRender","$sync","_q_renderPack","renderLoop","h","location","hash","$h","getElementById","scrollIntoView","nows","deferreds","ricResolve","ricId","animation","aArr","addAnimation","repeatSyncs","alert","rafResolve","rafId","requestAnimationFrame","checkScrollAnimations","scrollSync","addEventListener","passive","rr","$parents","jId","prpDeleteDescrId","$elsLen","iDId","mergeByD","$top","mI","firstAsOneIdx","descrId","byDArr","byDArrLen","$l","jDId","mJ","lLen","lId","newRenderParam","syncSrcId","getPosStat","cancelSync","cancelIdleCallback","cancelAnimationFrame","startTime","now","didTimeout","timeRemaining","Math","max","func","getPrototypeOf","constructor","eval2","isReactive","cacheSrcId","nStr","getCacheSrcId","getEval2Func","q_eval2","cacheKey","trim","_f","_func","ff","isNeedRet","fBody","q_getEval2Func","vals","_e","clearBlock","begin","end","strLen","count","getRequest","getUrl","reHost","reSlash","reUp","reThis","url","pathname","isUri","normalizeUrl","u","normalizeUrl_get","endsWith","lastIndexOf","search","origin","trimLeft","lastSlashIdx","re","replace","waitingStack","incCache","incScriptCache","incCmd","inc_render","inc_get$first","inc_get$els","include","method","inc","type_include","getTopUrl","getIncude","oldVal","renderI","renderInc","readyInc","readyState","getNewInc","loading","a0","a1","isShow","type_incLoading","fetch","html","$fr","createDocumentFragment","$div","innerHTML","createLineNo","$next","joinText","$tags","$links","querySelectorAll","$linksLen","uri","$styles","$stylesLen","$scripts","$sLen","scripts","createIncScript","createIncScripts","head","createIncFragment","w","origUrl","import","m","incToScope","checkScript","uurl","URL","createObjectURL","Blob","revokeObjectURL","runIncScript","ok","status","eval","lineNumber","columnNumber","line","numIdx","curAttr","isR","on","skipAttrs","lCount","saveI","onLen","nn","iAttrs","iAttrsLen","newAttr","curAttrIt","nSet","isHas$e","$slots","$slotsLen","$freeSlot","$s","makeSlots","insertBefore","createComment","cloneIncFragment","lastChild","$lastNext","getNewIncInsert","scopeToInc","renderNewInc","isRenderdInc","getIncCount","dispatchCustomEvent","evtName","detail","setLoc","getLoc","query","searchParams","href","path","type_loc","kebabToCamelCase","words","wordsLen","toUpperCase","typedefCheck","this","setView","doc","getView","scrollTop","scrollLeft","eq","of","ins","elsOf","propsOf","array","object","bool","number","string","null","notNull","undef","notUndef","test","getCurRender","del","obj","prop","copyToClipboard","$f","execCommand","typedef","attrCmd","attr_render","getName$3","getName","toggleVal","isInit","tagName","toLowerCase","target","evt","ctrlKey","metaKey","preventDefault","mode","history","pushState","replaceState","setClick","curVal","aCache","aCurVal","execCmd","getName$2","fetchCmd","getRes","clearFetch","getFetch","det","type_fetchDetailEvent","foreachCmd","foreach_render","foreach_get$first","foreach_get$els","$iLen","valName","keyName","type_ctx","getCtx","elsLen","els","keysLen","show$first","$elsI","$e0","q_forRender","q_add","toRem","showFunc","first$els","first$elsLen","from$elsLen","viewSize","offsetHeight","step","ceil","q_addInsert","q_addDeferred","newEls","beginIdx","fSrc","fDescr","aIt","$jArr","q_cloneNode","$elsILen","q_addI","newElsLen","lastIdx","get$last","q_forRenderI","newElsLast$els","addF","elsI","scopeI","htmlCmd","html_render","ifCmd","make$first","if_render","reqI","if_get$first","if_get$els","switchCmd","expression","pSrc","pScope","isTrue","makeShow","beforeAttrCount","isSingle","firstStr","isStrIf","forIdx","incCount","forBefore","forStr","forBeforeLen","jdx","if_getNextStr","$maybe","$iEls","$maybeLen","isNotAnimations","onCmd","on_render","WeakMap","ii","capture","once","opt","argsLen","actions","mod","stopPropagation","altKey","shiftKey","holdsKeys","data","button","listen","scopeCmd","getName$1","fillingCmd","watchCmd","watch_render","watch","cur","documentElement","mwUrl","currentScript","baseURI","ready","default","view","evtOpt","clientInit"],"mappings":"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"}